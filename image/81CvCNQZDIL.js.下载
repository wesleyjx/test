(function(n){var l=window.AmazonUIPageJS||window.P,C=l._namespace||l.attributeErrors,h=C?C("GoldboxMobileAssets",""):l;h.guardFatal?h.guardFatal(n)(h,window):h.execute(function(){n(h,window)})})(function(n,l,C){"object"!==typeof JSON&&(JSON={});(function(){function h(a){return 10>a?"0"+a:a}function r(c){a.lastIndex=0;return a.test(c)?'"'+c.replace(a,function(a){var c=e[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function g(a,b){var e,y,h=c,
l,n=b[a];n&&"object"===typeof n&&"function"===typeof n.toJSON&&(n=n.toJSON(a));"function"===typeof f&&(n=f.call(b,a,n));switch(typeof n){case "string":return r(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);case "object":if(!n)return"null";c+=d;l=[];if("[object Array]"===Object.prototype.toString.apply(n)){y=n.length;for(a=0;a<y;a+=1)l[a]=g(a,n)||"null";b=0===l.length?"[]":c?"[\n"+c+l.join(",\n"+c)+"\n"+h+"]":"["+l.join(",")+"]";c=h;return b}if(f&&
"object"===typeof f)for(y=f.length,a=0;a<y;a+=1)"string"===typeof f[a]&&(e=f[a],(b=g(e,n))&&l.push(r(e)+(c?": ":":")+b));else for(e in n)Object.prototype.hasOwnProperty.call(n,e)&&(b=g(e,n))&&l.push(r(e)+(c?": ":":")+b);b=0===l.length?"{}":c?"{\n"+c+l.join(",\n"+c)+"\n"+h+"}":"{"+l.join(",")+"}";c=h;return b}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+
":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var b,a,c,d,e,f;"function"!==typeof JSON.stringify&&(a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,e){var y;d=c="";if("number"===typeof e)for(y=
0;y<e;y+=1)d+=" ";else"string"===typeof e&&(d=e);if((f=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return g("",{"":a})});"function"!==typeof JSON.parse&&(b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(a,c){function d(a,b){var e,f,k=a[b];if(k&&"object"===typeof k)for(e in k)Object.prototype.hasOwnProperty.call(k,e)&&(f=d(k,e),void 0!==f?k[e]=f:delete k[e]);
return c.call(a,b,k)}a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+a+")"),"function"===typeof c?d({"":a},""):a;throw new SyntaxError("JSON.parse");})})();(function(){var h=this,r=h._,g={},b=Array.prototype,a=Object.prototype,
c=b.push,d=b.slice,e=b.concat,f=a.toString,k=a.hasOwnProperty,m=b.forEach,q=b.map,y=b.reduce,l=b.reduceRight,n=b.filter,u=b.every,v=b.some,x=b.indexOf,z=b.lastIndexOf,a=Array.isArray,B=Object.keys,A=Function.prototype.bind,p=function(a){if(a instanceof p)return a;if(!(this instanceof p))return new p(a);this._wrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=p),exports._=p):h._=p;p.VERSION="1.5.2";var w=p.each=p.forEach=function(a,c,d){if(null!=
a)if(m&&a.forEach===m)a.forEach(c,d);else if(a.length===+a.length)for(var b=0,e=a.length;b<e&&c.call(d,a[b],b,a)!==g;b++);else for(var f=p.keys(a),b=0,e=f.length;b<e&&c.call(d,a[f[b]],f[b],a)!==g;b++);};p.map=p.collect=function(a,c,d){var b=[];if(null==a)return b;if(q&&a.map===q)return a.map(c,d);w(a,function(a,e,f){b.push(c.call(d,a,e,f))});return b};p.reduce=p.foldl=p.inject=function(a,c,d,b){var e=2<arguments.length;null==a&&(a=[]);if(y&&a.reduce===y)return b&&(c=p.bind(c,b)),e?a.reduce(c,d):a.reduce(c);
w(a,function(a,f,k){e?d=c.call(b,d,a,f,k):(d=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return d};p.reduceRight=p.foldr=function(a,c,d,b){var e=2<arguments.length;null==a&&(a=[]);if(l&&a.reduceRight===l)return b&&(c=p.bind(c,b)),e?a.reduceRight(c,d):a.reduceRight(c);var f=a.length;if(f!==+f)var k=p.keys(a),f=k.length;w(a,function(m,q,g){q=k?k[--f]:--f;e?d=c.call(b,d,a[q],q,g):(d=a[q],e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");
return d};p.find=p.detect=function(a,c,d){var b;N(a,function(a,e,f){if(c.call(d,a,e,f))return b=a,!0});return b};p.filter=p.select=function(a,c,d){var b=[];if(null==a)return b;if(n&&a.filter===n)return a.filter(c,d);w(a,function(a,e,f){c.call(d,a,e,f)&&b.push(a)});return b};p.reject=function(a,c,d){return p.filter(a,function(a,b,e){return!c.call(d,a,b,e)},d)};p.every=p.all=function(a,c,d){c||(c=p.identity);var b=!0;if(null==a)return b;if(u&&a.every===u)return a.every(c,d);w(a,function(a,e,f){if(!(b=
b&&c.call(d,a,e,f)))return g});return!!b};var N=p.some=p.any=function(a,c,d){c||(c=p.identity);var b=!1;if(null==a)return b;if(v&&a.some===v)return a.some(c,d);w(a,function(a,e,f){if(b||(b=c.call(d,a,e,f)))return g});return!!b};p.contains=p.include=function(a,c){return null==a?!1:x&&a.indexOf===x?-1!=a.indexOf(c):N(a,function(a){return a===c})};p.invoke=function(a,c){var b=d.call(arguments,2),e=p.isFunction(c);return p.map(a,function(a){return(e?c:a[c]).apply(a,b)})};p.pluck=function(a,c){return p.map(a,
function(a){return a[c]})};p.where=function(a,c,d){return p.isEmpty(c)?d?void 0:[]:p[d?"find":"filter"](a,function(a){for(var d in c)if(c[d]!==a[d])return!1;return!0})};p.findWhere=function(a,c){return p.where(a,c,!0)};p.max=function(a,c,d){if(!c&&p.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!c&&p.isEmpty(a))return-Infinity;var b={computed:-Infinity,value:-Infinity};w(a,function(a,e,f){e=c?c.call(d,a,e,f):a;e>b.computed&&(b={value:a,computed:e})});return b.value};p.min=
function(a,c,d){if(!c&&p.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!c&&p.isEmpty(a))return Infinity;var b={computed:Infinity,value:Infinity};w(a,function(a,e,f){e=c?c.call(d,a,e,f):a;e<b.computed&&(b={value:a,computed:e})});return b.value};p.shuffle=function(a){var c,d=0,b=[];w(a,function(a){c=p.random(d++);b[d-1]=b[c];b[c]=a});return b};p.sample=function(a,c,d){return 2>arguments.length||d?a[p.random(a.length-1)]:p.shuffle(a).slice(0,Math.max(0,c))};var F=function(a){return p.isFunction(a)?
a:function(c){return c[a]}};p.sortBy=function(a,c,d){var b=F(c);return p.pluck(p.map(a,function(a,c,e){return{value:a,index:c,criteria:b.call(d,a,c,e)}}).sort(function(a,c){var d=a.criteria,b=c.criteria;if(d!==b){if(d>b||void 0===d)return 1;if(d<b||void 0===b)return-1}return a.index-c.index}),"value")};var G=function(a){return function(c,d,b){var e={},f=null==d?p.identity:F(d);w(c,function(d,k){k=f.call(b,d,k,c);a(e,k,d)});return e}};p.groupBy=G(function(a,c,d){(p.has(a,c)?a[c]:a[c]=[]).push(d)});
p.indexBy=G(function(a,c,d){a[c]=d});p.countBy=G(function(a,c){p.has(a,c)?a[c]++:a[c]=1});p.sortedIndex=function(a,c,d,b){d=null==d?p.identity:F(d);c=d.call(b,c);for(var e=0,f=a.length;e<f;){var k=e+f>>>1;d.call(b,a[k])<c?e=k+1:f=k}return e};p.toArray=function(a){return a?p.isArray(a)?d.call(a):a.length===+a.length?p.map(a,p.identity):p.values(a):[]};p.size=function(a){return null==a?0:a.length===+a.length?a.length:p.keys(a).length};p.first=p.head=p.take=function(a,c,b){return null==a?void 0:null==
c||b?a[0]:d.call(a,0,c)};p.initial=function(a,c,b){return d.call(a,0,a.length-(null==c||b?1:c))};p.last=function(a,c,b){return null==a?void 0:null==c||b?a[a.length-1]:d.call(a,Math.max(a.length-c,0))};p.rest=p.tail=p.drop=function(a,c,b){return d.call(a,null==c||b?1:c)};p.compact=function(a){return p.filter(a,p.identity)};var J=function(a,d,b){if(d&&p.every(a,p.isArray))return e.apply(b,a);w(a,function(a){p.isArray(a)||p.isArguments(a)?d?c.apply(b,a):J(a,d,b):b.push(a)});return b};p.flatten=function(a,
c){return J(a,c,[])};p.without=function(a){return p.difference(a,d.call(arguments,1))};p.uniq=p.unique=function(a,c,d,b){p.isFunction(c)&&(b=d,d=c,c=!1);d=d?p.map(a,d,b):a;var e=[],f=[];w(d,function(d,b){(c?b&&f[f.length-1]===d:p.contains(f,d))||(f.push(d),e.push(a[b]))});return e};p.union=function(){return p.uniq(p.flatten(arguments,!0))};p.intersection=function(a){var c=d.call(arguments,1);return p.filter(p.uniq(a),function(a){return p.every(c,function(c){return 0<=p.indexOf(c,a)})})};p.difference=
function(a){var c=e.apply(b,d.call(arguments,1));return p.filter(a,function(a){return!p.contains(c,a)})};p.zip=function(){for(var a=p.max(p.pluck(arguments,"length").concat(0)),c=Array(a),d=0;d<a;d++)c[d]=p.pluck(arguments,""+d);return c};p.object=function(a,c){if(null==a)return{};for(var d={},b=0,e=a.length;b<e;b++)c?d[a[b]]=c[b]:d[a[b][0]]=a[b][1];return d};p.indexOf=function(a,c,d){if(null==a)return-1;var b=0,e=a.length;if(d)if("number"==typeof d)b=0>d?Math.max(0,e+d):d;else return b=p.sortedIndex(a,
c),a[b]===c?b:-1;if(x&&a.indexOf===x)return a.indexOf(c,d);for(;b<e;b++)if(a[b]===c)return b;return-1};p.lastIndexOf=function(a,c,d){if(null==a)return-1;var b=null!=d;if(z&&a.lastIndexOf===z)return b?a.lastIndexOf(c,d):a.lastIndexOf(c);for(d=b?d:a.length;d--;)if(a[d]===c)return d;return-1};p.range=function(a,c,d){1>=arguments.length&&(c=a||0,a=0);d=arguments[2]||1;for(var b=Math.max(Math.ceil((c-a)/d),0),e=0,f=Array(b);e<b;)f[e++]=a,a+=d;return f};var K=function(){};p.bind=function(a,c){var b,e;if(A&&
a.bind===A)return A.apply(a,d.call(arguments,1));if(!p.isFunction(a))throw new TypeError;b=d.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(c,b.concat(d.call(arguments)));var f=new K;K.prototype=null;var k=a.apply(f,b.concat(d.call(arguments)));return Object(k)===k?k:f}};p.partial=function(a){var c=d.call(arguments,1);return function(){return a.apply(this,c.concat(d.call(arguments)))}};p.bindAll=function(a){var c=d.call(arguments,1);if(0===c.length)throw Error("bindAll must be passed function names");
w(c,function(c){a[c]=p.bind(a[c],a)});return a};p.memoize=function(a,c){var d={};c||(c=p.identity);return function(){var b=c.apply(this,arguments);return p.has(d,b)?d[b]:d[b]=a.apply(this,arguments)}};p.delay=function(a,c){var b=d.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},c)};p.defer=function(a){return p.delay.apply(p,[a,1].concat(d.call(arguments,1)))};p.throttle=function(a,c,d){var b,e,f,k=null,m=0;d||(d={});var q=function(){m=!1===d.leading?0:new Date;k=null;f=a.apply(b,
e)};return function(){var g=new Date;m||!1!==d.leading||(m=g);var y=c-(g-m);b=this;e=arguments;0>=y?(clearTimeout(k),k=null,m=g,f=a.apply(b,e)):k||!1===d.trailing||(k=setTimeout(q,y));return f}};p.debounce=function(a,c,d){var b,e,f,k,m;return function(){f=this;e=arguments;k=new Date;var q=function(){var g=new Date-k;g<c?b=setTimeout(q,c-g):(b=null,d||(m=a.apply(f,e)))},g=d&&!b;b||(b=setTimeout(q,c));g&&(m=a.apply(f,e));return m}};p.once=function(a){var c=!1,d;return function(){if(c)return d;c=!0;
d=a.apply(this,arguments);a=null;return d}};p.wrap=function(a,d){return function(){var b=[a];c.apply(b,arguments);return d.apply(this,b)}};p.compose=function(){var a=arguments;return function(){for(var c=arguments,d=a.length-1;0<=d;d--)c=[a[d].apply(this,c)];return c[0]}};p.after=function(a,c){return function(){if(1>--a)return c.apply(this,arguments)}};p.keys=B||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],d;for(d in a)p.has(a,d)&&c.push(d);return c};p.values=function(a){for(var c=
p.keys(a),d=c.length,b=Array(d),e=0;e<d;e++)b[e]=a[c[e]];return b};p.pairs=function(a){for(var c=p.keys(a),d=c.length,b=Array(d),e=0;e<d;e++)b[e]=[c[e],a[c[e]]];return b};p.invert=function(a){for(var c={},d=p.keys(a),b=0,e=d.length;b<e;b++)c[a[d[b]]]=d[b];return c};p.functions=p.methods=function(a){var c=[],d;for(d in a)p.isFunction(a[d])&&c.push(d);return c.sort()};p.extend=function(a){w(d.call(arguments,1),function(c){if(c)for(var d in c)a[d]=c[d]});return a};p.pick=function(a){var c={},f=e.apply(b,
d.call(arguments,1));w(f,function(d){d in a&&(c[d]=a[d])});return c};p.omit=function(a){var c={},f=e.apply(b,d.call(arguments,1)),k;for(k in a)p.contains(f,k)||(c[k]=a[k]);return c};p.defaults=function(a){w(d.call(arguments,1),function(c){if(c)for(var d in c)void 0===a[d]&&(a[d]=c[d])});return a};p.clone=function(a){return p.isObject(a)?p.isArray(a)?a.slice():p.extend({},a):a};p.tap=function(a,c){c(a);return a};var H=function(a,c,d,b){if(a===c)return 0!==a||1/a==1/c;if(null==a||null==c)return a===
c;a instanceof p&&(a=a._wrapped);c instanceof p&&(c=c._wrapped);var e=f.call(a);if(e!=f.call(c))return!1;switch(e){case "[object String]":return a==String(c);case "[object Number]":return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case "[object Date]":case "[object Boolean]":return+a==+c;case "[object RegExp]":return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return!1;for(var k=d.length;k--;)if(d[k]==a)return b[k]==c;
var k=a.constructor,m=c.constructor;if(k!==m&&!(p.isFunction(k)&&k instanceof k&&p.isFunction(m)&&m instanceof m))return!1;d.push(a);b.push(c);k=0;m=!0;if("[object Array]"==e){if(k=a.length,m=k==c.length)for(;k--&&(m=H(a[k],c[k],d,b)););}else{for(var q in a)if(p.has(a,q)&&(k++,!(m=p.has(c,q)&&H(a[q],c[q],d,b))))break;if(m){for(q in c)if(p.has(c,q)&&!k--)break;m=!k}}d.pop();b.pop();return m};p.isEqual=function(a,c){return H(a,c,[],[])};p.isEmpty=function(a){if(null==a)return!0;if(p.isArray(a)||p.isString(a))return 0===
a.length;for(var c in a)if(p.has(a,c))return!1;return!0};p.isElement=function(a){return!(!a||1!==a.nodeType)};p.isArray=a||function(a){return"[object Array]"==f.call(a)};p.isObject=function(a){return a===Object(a)};w("Arguments Function String Number Date RegExp".split(" "),function(a){p["is"+a]=function(c){return f.call(c)=="[object "+a+"]"}});p.isArguments(arguments)||(p.isArguments=function(a){return!(!a||!p.has(a,"callee"))});"function"!==typeof/./&&(p.isFunction=function(a){return"function"===
typeof a});p.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};p.isNaN=function(a){return p.isNumber(a)&&a!=+a};p.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==f.call(a)};p.isNull=function(a){return null===a};p.isUndefined=function(a){return void 0===a};p.has=function(a,c){return k.call(a,c)};p.noConflict=function(){h._=r;return this};p.identity=function(a){return a};p.times=function(a,c,d){for(var b=Array(Math.max(0,a)),e=0;e<a;e++)b[e]=c.call(d,e);return b};p.random=
function(a,c){null==c&&(c=a,a=0);return a+Math.floor(Math.random()*(c-a+1))};var D={escape:{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}};D.unescape=p.invert(D.escape);var C={escape:new RegExp("["+p.keys(D.escape).join("")+"]","g"),unescape:new RegExp("("+p.keys(D.unescape).join("|")+")","g")};p.each(["escape","unescape"],function(a){p[a]=function(c){return null==c?"":(""+c).replace(C[a],function(c){return D[a][c]})}});p.result=function(a,c){if(null!=a)return c=
a[c],p.isFunction(c)?c.call(a):c};p.mixin=function(a){w(p.functions(a),function(d){var b=p[d]=a[d];p.prototype[d]=function(){var a=[this._wrapped];c.apply(a,arguments);return L.call(this,b.apply(p,a))}})};var M=0;p.uniqueId=function(a){var c=++M+"";return a?a+c:c};p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var t=/(.)^/,Q={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t"},R=/\\|'|\r|\n|\t/g,O=["u2028","u2029"];p.template=function(a,c,d){var b;
d=p.defaults({},d,p.templateSettings);var e=new RegExp([(d.escape||t).source,(d.interpolate||t).source,(d.evaluate||t).source].join("|")+"|$","g"),f=0,k="__p+\x3d'";a.replace(e,function(c,d,b,e,m){k+=a.slice(f,m).replace(R,function(a){return"\\"+Q[a]}).replace(/\u2028/g,"\\"+O[0]).replace(/\u2029/g,"\\"+O[1]);d&&(k+="'+\n((__t\x3d("+d+"))\x3d\x3dnull?'':_.escape(__t))+\n'");b&&(k+="'+\n((__t\x3d("+b+"))\x3d\x3dnull?'':__t)+\n'");e&&(k+="';\n"+e+"\n__p+\x3d'");f=m+c.length;return c});k+="';\n";d.variable||
(k="with(obj||{}){\n"+k+"}\n");k="var __t,__p\x3d'',__j\x3dArray.prototype.join,print\x3dfunction(){__p+\x3d__j.call(arguments,'');};\n"+k+"return __p;\n";try{b=new Function(d.variable||"obj","_",k)}catch(m){throw m.source=k,m;}if(c)return b(c,p);c=function(a){return b.call(this,a,p)};c.source="function("+(d.variable||"obj")+"){\n"+k+"}";return c};p.chain=function(a){return p(a).chain()};var L=function(a){return this._chain?p(a).chain():a};p.mixin(p);w("pop push reverse shift sort splice unshift".split(" "),
function(a){var c=b[a];p.prototype[a]=function(){var d=this._wrapped;c.apply(d,arguments);"shift"!=a&&"splice"!=a||0!==d.length||delete d[0];return L.call(this,d)}});w(["concat","join","slice"],function(a){var c=b[a];p.prototype[a]=function(){return L.call(this,c.apply(this._wrapped,arguments))}});p.extend(p.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}})}).call(this);n.register("gb-csm",function(){function h(a,c){if(a&&l.ue&&ue.count)return ue.count(a,
c)}function r(a){var c;c=a&&l.ue&&ue.count?ue.count(a)||0:void 0;h(a,c+1)}function g(a,c){h(a+":time",c)}var b={};return{incrementCounter:r,recordLatency:g,recordImageMetricMarker:function(a,c,d){var b="ImgLoad";d&&(b+=":"+d);switch(a){case "load":r(b+":success");if(a=parseInt(c.getAttribute("data-render-start"),10))a=(new Date).getTime()-a,g(b,a);break;case "error":r(b+":error")}},recordMaxPageDepthReached:function(a,c){var d="widgetPageDepth";gb.widgets&&a&&gb.widgets[a]&&gb.widgets[a].viewPortManager&&
!isNaN(gb.widgets[a].viewPortManager.subnavPage)&&(d+=":SN:"+gb.widgets[a].viewPortManager.subnavPage);b[d]&&b[d]>=c||(b[d]=c,h(d,c))}}});n.when("A").register("gb-event-emitter",function(h){return h.createClass({init:function(){this._events=this._events||{};this._tasks=this._tasks||{completed:{},waiting:{}}},on:function(h,g){this._events[h]=this._events[h]||[];this._events[h].push(g)},off:function(h,g){!1!==h in this._events&&this._events[h].splice(this._events[h].indexOf(g),1)},trigger:function(h){if(!1!==
h in this._events)for(var g=0;g<this._events[h].length;g++)this._events[h][g].apply(this,Array.prototype.slice.call(arguments,1))},when:function(h){var g=this;return{execute:function(b){g._tasks.completed[h]?b():(g._tasks.waiting[h]||(g._tasks.waiting[h]=[]),10>g._tasks.waiting[h].length&&g._tasks.waiting[h].push(b))}}},register:function(h){if(!this._tasks.completed[h])for(this._tasks.completed[h]=!0,h=this._tasks.waiting[h];h&&h.length;){var g=h.pop();"function"===typeof g&&g()}}})});n.when("GoldboxMobile3PAssets").register("gb-enums",
function(h){var l=h._;h={StatusFilters:{AVAILABLE:"available",UPCOMING:"upcoming",MISSED:"missed",ACTIVE:"active"},Realms:{CA:"CA",CN:"CN",DE:"DE",ES:"ES",FR:"FR",IT:"IT",IN:"IN",JP:"JP",US:"US",UK:"UK",MX:"MX",BR:"BR",AU:"AU",TR:"TR"},CategoryFilters:{ALL:"all"},DealTypes:{DOTD:"DEAL_OF_THE_DAY",LD:"LIGHTNING_DEAL",BD:"BEST_DEAL",LOCAL:"LOCAL_DEAL",COUPON:"COUPON_DEAL",EVENT:"EVENT_DEAL"},DealStates:{LOADING:"LOADING",COMINGSOON:"COMINGSOON",AVAILABLE:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"SOLDOUT",
UPCOMING:"UPCOMING",WAITLIST:"WAITLIST",WAITLISTFULL:"WAITLISTFULL"},FilterStates:{ACTIVE:"ACTIVE",MISSED:"MISSED",UPCOMING:"UPCOMING"},FilterConstants:{CUSTOM_FILTER:"customFilter"},DealStateToTemplateMap:{LOADING:"LOADING",AVAILABLE:"AVAILABLE",WAITLIST:"AVAILABLE",WAITLISTFULL:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"SOLDOUT",UPCOMING:"UPCOMING",COMINGSOON:"COMINGSOON"},WatchedDealStateMap:{AVAILABLE:"AVAILABLE",WAITLIST:"AVAILABLE",WAITLISTFULL:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"EXPIRED",UPCOMING:"UPCOMING",
COMINGSOON:"UPCOMING",LOADING:"AVAILABLE"},WatchDealActions:{ADD:"ADD",REMOVE:"REMOVE"},WatchDealPopoverActions:{SHOW_WATCH_POPUP:"SHOW",HIDE_WATCH_POPUP:"HIDE",UPDATE_WATCH_POPUP:"UPDATE"},SembuActions:{GET_COOKIE:"getValue",SET_COOKIE:"setValue"},WatchDealViewKeys:{GOLDBOX_DOMAIN:"goldbox",DISMISS_WATCHPOPUP_KEY:"dismissed_watch_popup"},AnimationDurations:{WATCH_DEAL:200,SCROLL_WIDGET_TO_TOP:500},Timeouts:{WIDGET_LOAD_WAIT_TIME:800},StateTemplates:{LOADING:"loading",AVAILABLE:"available",WAITLIST:"available",
WAITLISTFULL:"available",COMINGSOON:"comingSoon",UPCOMING:"upcoming",SOLDOUT:"soldout",EXPIRED:"expired"},PurchaseStates:{ADD_TO_CART:"AddToCart",LEARN_MORE:"LearnMore",SEE_DEAL:"SeeDeal",JOIN_WAITLIST:"JoinWaitlist",WAITLIST_FULL:"WaitlistFull",CHOOSE_OPTIONS:"ChooseOptions",PENDINGATC:"PendingAddToCart",CLAIMED:"Claimed",INWAITLIST:"InWaitlist",INCART:"InCart"},DataTypes:{STRING:"string",BOOL:"bool"},CustomerStates:{NONE:"NONE",INCART:"INCART",CLAIMED:"CLAIMED",INWAITLIST:"INWAITLIST",PENDINGATC:"PENDINGATC",
EXPIRED:"EXPIRED"},AppStoreLink:{iOS:"itms-apps://itunes.apple.com/us/app/pages/id297606951?mt\x3d8\x26uo\x3d4",android:"market://details?id\x3dcom.amazon.mShop.android.shopping"},ButtonActions:{ATC:"gbdeal-addtocart",JW:"gbdeal-joinwaitlist",SO:"gbdeal-seeoptions",WTD:"gbdeal-watchdeal"},priceKind:{LIST_PRICE:"LP",OUR_PRICE:"OP",PRINT_LIST_PRICE:"PLP",DIGITAL_LIST_PRICE:"DLP"},merchantName:{US:"Amazon.com",IT:"Amazon.it",ES:"Amazon.es",DE:"Amazon.de"},WidgetViewIDs:{A_POPOVER:"#a-popover-",CANCEL:"widgetRefineCancel",
CART_ERROR:"cartError",CATEGORY_REFINE_CONTENT:"categoryRefineContent",CONTENT:"widgetContent",CONTENTROW:"widgetContentRow--LowEndDevice",FILTER_BUTTON:"filterButton",FILTER_CONTENT:"filterContent",FILTERS:"widgetFilters",HERO_HEADER:"heroHeader",LAUNCH_CELL:"launchCell",LOADING:"widgetLoading",SCROLL_CONTENT_LOADER:"scrollContentLoader",MINI_DP_MODAL:"mini_dp_modal_",NEXT_SHOVL_BUTTON:"nextShovlButton",PAGINATION_ROW:"paginationRow",PRIME:"prime_",PREV_SHOVL_BUTTON:"previousShovlButton",REFINE:"widgetRefine",
REFINE_POPOVER_NAME:"refine",SCROLL:"widgetScroll",SHOVL_PAGINATION:"shovlPagination",SHOVL_STATE_HEADER:"shovlStateHeader",SHOVL_FILTER:"shovlFilter",SORT_BUTTON:"sortButton"},WidgetViewSelectors:{NAV:"#a-page \x3e nav",HEADER:"#heroHeader",DIVIDER:".dealDivider",REFINESTATE:".dealDivider + div",PAGINATION_ROW:".paginationRow",FILTER_BOX:".filterBox",TRIANGLE:".triangle",PADCENTER:".padCenter"},dealViewIDs:{TITLE:"dealTitle",DESC_ABBR:"dealDescShort",DESC_REST:"dealDescRest",DUMMY_ELEMENT:"dummyElement",
DEALCLOCK:"_dealClock",INCARTCLOCK:"_incartClock",PENDINGATCCLOCK:"_pendingATCClock",OPT_HEADER:"dealOptionsHeader",IMAGE:"dealImage",OPT_CONTENT:"dealOptionsContent",OPT_FOOTER:"dealOptionsFooter",SHARE:"dealShare",SHIP_SOLD:"shipSoldInfo"},dealViewClasses:{DESC_EXPANDER:"dealDescExpander",FOOTER:"footerElm--LowEndDevice"},ShovlConstants:{DISABLED:"disabled",SHOVL_NEXT:"shovelNext",SHOVL_PREVIOUS:"shovelPrevious",SHOVL_STATE_TAB:"widgetCurrentTab"},WatchDealViewIDs:{WATCH_POPOVER:"watchDealPopover",
WATCHING_IMAGE:"watchingImageDiv_",WATCH_BUTTON:"watchButton_",WATCH_BUTTON_TEXT:"watchButtonText_",WATCH_WARNING_TEXT:"watchWarningText_",MINI_DP_WATCH_BUTTON_MAPPING:{"GB-SUPPLE":"miniDPSuppleWatchButton"}},MobileClients:{AW:"aw",APP:"app",PC:"pc"},RedirectionLinks:{app:{ALL_DEALS:"/gp/mobile/deals/all-deals",BEST_DEAL:"/gp/mobile/deals/best-deals",DEAL_OF_THE_DAY:"/gp/mobile/deals/dotds",GATEWAY_PAGE:"/gp/mobile/deals",LIGHTNING_DEAL:"/gp/mobile/deals/lightning-deals"},aw:{ALL_DEALS:"/gp/aw/gb/alldeals",
BEST_DEAL:"/gp/aw/gb/bd",DEAL_OF_THE_DAY:"/gp/aw/gb/dotds",GATEWAY_PAGE:"/gp/aw/gb",LIGHTNING_DEAL:"/gp/aw/gb/ld"},pc:{ALL_DEALS:"/gp/goldbox/all-deals"}},ReviewsPageURL:{app:"/gp/mobile/reviews/",aw:"/gp/mobile/reviews/",pc:"/gp/product-reviews/"},SponsoredDealURL:{picassoRedirect:"/gp/slredirect/picassoRedirect.html"},Cookies:{apnPrivacy:"apn-privacy"},AJAXLinks:{CDS:"/gp/mobile/deals/ajax/impressionTrackerV2.html",ADD_TO_CART:"/gp/deal/ajax/addToCart.html",WATCH_DEAL:{V1:"/gp/deal/ajax/watchDeal.html/ref\x3d",
V2:"/gp/deal/ajax/v2/watchDeal.html/ref\x3d"},GET_WATCHED:"/gp/deal/ajax/getWatchedDeals.html/ref\x3d",GDM:"/xa/dealcontent/v2/GetDealMetadata",GD:"/xa/dealcontent/v2/GetDeals",GDS:"/xa/dealcontent/v2/GetDealStatus",CD:{V1:"/gp/deal/ajax/claimDeal.html/ref\x3d",V2:"/gp/deal/ajax/v2/claimDeal.html/ref\x3d"},UPDATE_EMBU:"/gp/mobile/deals/ajax/modifyEmbuData.html",SUBSCRIBE_MNSS:"/gp/deal/ajax/registerForNotifications.html/ref\x3d",PICASSO_CLICKS:"/gp/slredirect/picassoRedirect.html",FWC:"/gp/deal/ajax/fetchWidgetConfig.html"},
MiscLinks:{CART_URL:"/gp/cart/view.html",CART_URL_AW:"/gp/aw/c",LOCAL_URL:"/local",PURCHASE_URL:"/gp/goldbox/purchase"},WidgetNames:{M_HERO:"GB-M-HERO",M_SUPPLE:"GB-M-SUPPLE",MG_HERO:"GB-M-GRID-HERO",ML_HERO:"GB-M-LIST-HERO",PC_FACEOUT:"GB-PC-FACEOUT",PC_SUPPLE:"GB-SUPPLE",PC_SHOVELER:"GB-SHOVELER",TAB_HERO:"GB-TAB-HERO",TAB_GRID_HERO:"GB-TAB-GRID-HERO",TAB_SUPPLE:"GB-TAB-SUPPLE"},WidgetConstants:{CURRENT_TAB:"widgetCurrentTab"},ChangeoverID:{AddedToCart:"gb_in_cart_co",Waitlisted:"gb_waitlisted_co",
Subnav:"gb_subnav_change_hover"},ClientOrientation:{LANDSCAPE:"landscape",PORTRAIT:"portrait"},MashNavButtons:{LEFT:"navButtonLeft",RIGHT:"navButtonRight"},BottomSheetActions:{StopWatching:{label:"gb_m_stop_watching_deal",actionName:"gbdeal-watchdeal"},ShareDeal:{label:"gb_share_deal",actionName:"gbdeal-mashshare"}},Direction:{UP:"up",DOWN:"down"},Constants:{MAX_TIMEOUT:2147483647,SECURE_IMAGES_URL_DEFAULT:"images-na.ssl-images-amazon.com",SECURE_IMAGES_URL_CN:"images-cn.ssl-images-amazon.com",MIN_DEAL_VIEW_WIDTH:200,
MIN_TABLET_VIEW_WIDTH:200,MIN_PC_VIEW_WIDTH:250,SUPPLE_FILTER_COLUMN_WIDTH:235,MIN_NAV_WIDTH:1E3,MIN_TAB_WIDTH:735,PHONE_LANDSCAPE_COLUMN_COUNT:3,PHONE_PORTRAIT_COLUMN_COUNT:2,LOWER_END_IOS_MIN_HEIGHT:500,EGRESS_URL_UNSUPPORTED_REGEX:/\/dp\/|\/gp\/product\//,EXTRACT_ASIN_URL_REGEX:/(\/dp\/|\/gp\/product\/)([^\/]+)/,MAX_SUPPLE_DEALS_TO_DISPLAY:2,GET_DEALS_MAX_JITTER:2,HI_RES_SCALING_FACTOR:2,AJAX_ENDPOINT:"/xa/dealcontent/v2/",PAGINATED_METADATA_VERSION:"V2.2",NON_RETRYABLE_QUANTITY_RESTRICTION_VIOLATION_ERROR:"4002",
MAX_DISPLAYABLE_VALUES_IN_UNEXPANDED_FILTER:12,ALL:"ALL",X_DIRECTION:"xDirection",Y_DIRECTION:"yDirection",SECOND_IN_MILLIS:1E3,MINUTE_IN_MILLIS:6E4,HOUR_IN_MILLIS:36E5,DAY_IN_MILLIS:864E5},DeviceNames:{IPHONE:"iPhone",IPAD:"iPad",WIN_PHONE:"winPhone",ANDROID_PHONE:"androidPhone",ANDROID_TAB:"androidTab"},Weblabs:{TREATMENTS:{C:0,T1:1,T2:2,T3:3,T4:4}},ItemTypes:{NONE:"NONE",SINGLE:"SINGLE_ITEM",MULTI:"MULTI_ITEM",VARIATION:"VARIATION_ITEM"},DealAccessTypes:{PRIME_EARLY_ACCESS:"PRIME_EARLY_ACCESS",
PRIME_ONLY_BD:"PRIME_ONLY_BD",PRIME_ONLY_DOTD:"PRIME_ONLY_DOTD",PRIME_ONLY_LD:"PRIME_ONLY_LD",APP_EARLY_ACCESS:"APP_EARLY_ACCESS",APP_ONLY_LD:"APP_ONLY_LD",GIVEAWAY_DEAL:"GIVEAWAY_DEAL"},PrimeSignUpURL:{PRIME_EARLY_ACCESS:"prime_signup_redirect",PRIME_ONLY_BD:"exclusive_bd_prime_signup_redirect",PRIME_ONLY_DOTD:"exclusive_dotd_prime_signup_redirect",PRIME_ONLY_LD:"exclusive_access_prime_signup_redirect"},appDownloadURL:"http://www.amazon.in/b/ref\x3daeaodeals?node\x3d6967393031",Platforms:{TAB:"tablet",
PC:"pc",PHONE:"phone"},ClientIDPrefix:"goldbox_mobile",SortOrders:{BY_SCORE:"BY_SCORE",BY_RELEVANCE:"BY_RELEVANCE",BY_BEST_SELLING:"BY_BEST_SELLING",BY_PRICE_ASCENDING:"BY_PRICE_ASCENDING",BY_PRICE_DESCENDING:"BY_PRICE_DESCENDING",BY_DISCOUNT_ASCENDING:"BY_DISCOUNT_ASCENDING",BY_DISCOUNT_DESCENDING:"BY_DISCOUNT_DESCENDING",BY_START_TIME:"BY_START_TIME"},SortOrdersToStringsMap:{BY_SCORE:"gb_sort_score",BY_RELEVANCE:"gb_sort_relevant",BY_BEST_SELLING:"gb_sort_bestselling",BY_PRICE_ASCENDING:"gb_sort_price_up",
BY_PRICE_DESCENDING:"gb_sort_price_down",BY_DISCOUNT_ASCENDING:"gb_sort_discount_up",BY_DISCOUNT_DESCENDING:"gb_sort_discount_down",BY_START_TIME:"gb_sort_start_time"},RankingStrategies:{PERSONALIZED:"PERSONALIZED",CLAIMED_RATE:"CLAIMED_RATE",TRENDING:"TRENDING",NEW_TO_GL_EXCLUSIVE:"NEW_TO_GL_EXCLUSIVE",NEW_TO_GL_INCLUSIVE:"NEW_TO_GL_INCLUSIVE",BY_CUSTOM_CRITERION:"BY_CUSTOM_CRITERION"},PaginationDummyURLs:{PREV:"PREV",NEXT:"NEXT"},primeIconPositions:{RIGHT:"right",LEFT:"left"},ViewPortPresence:{ABSENT:"absent",
FULL:"full",FULL_HORIZONTAL_CONTENT:"horizontal",FULL_VERTICAL_CONTENT:"vertical",PARTIAL_TOP:"top",PARTIAL_BOTTOM:"bottom",PARTIAL_LEFT:"left",PARTIAL_RIGHT:"right",PARTIAL_TOP_LEFT:"top_left",PARTIAL_TOP_RIGHT:"top_right",PARTIAL_BOTTOM_LEFT:"bottom_left",PARTIAL_BOTTOM_RIGHT:"bottom_right"},WidgetHeaderIDs:{WidgetHeader:"widgetHeaderContent_"},GiveawayUrlParams:{returnToUrlPc:"/gp/goldbox/ref\x3dgagb",returnToUrlMob:"/gp/mobile/deals/ref\x3dgagb",client:"gbga",nav:"amz"},FilterAttrToStrings:{ACTIVE:"gb_active",
APP_EARLY_ACCESS:"gb_app_early_access",APP_ONLY_LD:"gb_app_only_access",BEST_DEAL:"gb_best_deal",COUPON_DEAL:"gb_coupon_deal",DEAL_OF_THE_DAY:"gb_deal_of_the_day",DISCOUNT:"gb_discount_range",DISCOUNT_START:"gb_discount_range_start",DISCOUNT_END:"gb_discount_range_end",FREE_SHIPPING_ELIGIBLE_ONLY:"gb_free_shipping_eligible",GIFT_WRAPPABLE:"gb_gift_wrappable",GLOBAL_ELIGIBLE_ONLY:"gb_global_eligible",LIGHTNING_DEAL:"gb_lightning_deal",MISSED:"gb_missed",NEW_RELEASES:"gb_new_release",PRICE:"gb_price_range",
PRICE_START:"gb_price_range_start",PRICE_END:"gb_price_range_end",PRIME:"gb_prime_eligible",PRIME_EARLY_ACCESS:"gb_prime_early_access",PRIME_ONLY_LD:"gb_prime_only_ld",PRIME_ONLY_DOTD:"gb_prime_only_dotd",PRIME_SUMMARY:"gb_prime_summary",REVIEW_RATING:"gb_x_stars_and_up",UPCOMING:"gb_upcoming",CASH_ON_DELIVERY:"gb-is-cod-allowed",FULLFILLED_BY_AMAZON:"gb-fullfilled-by-amazon"},DealStatesToFilterStates:{AVAILABLE:"ACTIVE",EXPIRED:"MISSED",UPCOMING:"UPCOMING",SOLDOUT:"MISSED",WAITLIST:"ACTIVE",WAITLISTFULL:"ACTIVE"},
DCSQueryParams:{ACCESS_TYPE:"enforcedAccessTypes",BRANDS:"brands",CATEGORIES:"enforcedCategories",DEAL_STATE:"dealStates",DEAL_TYPE:"dealTypes",DISCOUNT_RANGE:"discountRanges",EXCLUDED_ACCESS_TYPE:"excludedAccessTypes",FREE_SHIPPING_ELIGIBLE_ONLY:"freeShippingEligibleOnly",GLOBAL_ELIGIBLE_ONLY:"globalEligibleOnly",INCLUDED_ACCESS_TYPE:"includedAccessTypes",MAX_PERCENT_OFF:"maxPercentOff",MAX_PRICE:"maxPrice",MIN_PERCENT_OFF:"minPercentOff",MIN_PRICE:"minPrice",MIN_RATING:"minRating",PAGE:"page",PRICE_RANGE:"priceRanges",
PRIME_ELIGIBLE_ONLY:"primeEligibleOnly",PRIME_ACCESS_TYPE:"primeAccessType",SORT_ORDER:"sortOrder",INTERESTS:"interests",ENFORCED_CATEGORIES:"enforcedCategories"},BinNames:{BRANDS:"brands",CATEGORIES:"whitelist_categories",DISCOUNT:"discount_range",FREE_SHIPPING_ELIGIBLE_ONLY:"is_eligible_for_free_shipping",INCLUDED_DEAL_TARGETS:"included_deal_targets",GLOBAL_ELIGIBLE_ONLY:"is_global_eligible",PRIME_ELIGIBLE_ONLY:"is_prime",PRICE:"price_range",INTERESTS:"interests"},IncludedDealTargetsSupported:{MARKETING_ID:"MARKETING_ID",
MARKETING_ID_ONLY_SUMMARY:"marketing_id"},BinCounts:{BRANDS:100,CATEGORIES:100,DISCOUNT:20,FREE_SHIPPING_ELIGIBLE_ONLY:2,INCLUDED_DEAL_TARGETS:1E3,GLOBAL_ELIGIBLE_ONLY:2,PRIME_ELIGIBLE_ONLY:2,PRICE:20,INTERESTS:50},CustomerAppliedFilters:{PAGE:"p",CATEGORY:"c",STATUS:"s"},BrowserHistory:{STATE_KEY:"gb_hero_f_",ATTRIBUTION:"GoldBox"},DefaultPollingIntervals:{LD:12E3},RoundedReviewStarsThresholds:{LOW:.3,HIGH:.7},CellSizeClasses:{SINGLE:"singleCell",DOUBLE:"doubleCell"},WidgetActions:{Faceout:{SHOVEL:"gbshovel-pagination-faceout",
TILE_SELECTED:"gbselect-tile-faceout"},Filter:{CLEAR_ALL:"gbfilter-clear-all"},Shoveler:{SHOVEL:"gbshovel-pagination-shoveler"}},AGSMerchantsID:{MX_DEVO:"A2WNUS5VO5EKRE",MX_PROD:"A3BWELMBWVCY9T",IN_DEVO:"A04207613O5XXZD1VFTMS",IN_PROD:"AYAZOP86CGXY9",UK_DEVO:"A1SC7XIBTEUTGP",UK_PROD:"A2KVF7QXNCLV8H"},WidgetsAllowedAsScrollSource:["GB-PC-FACEOUT"]};var g=h.DCSQueryParams;h.BinningParams={BRANDS:{key:"brands",dcsKey:g.BRANDS},CATEGORIES:{key:"whitelist_categories",dcsKey:g.CATEGORIES},DEAL_STATE:{key:"deal_state",
dcsKey:g.DEAL_STATE},DEAL_TYPE:{key:"deal_type",dcsKey:g.DEAL_TYPE},DISCOUNT:{key:"discount_range",dcsKey:[g.MIN_PERCENT_OFF,g.MAX_PERCENT_OFF]},FREE_SHIPPING_ELIGIBLE_ONLY:{key:"is_eligible_for_free_shipping",dcsKey:g.FREE_SHIPPING_ELIGIBLE_ONLY},PRICE:{key:"price_range",dcsKey:[g.MIN_PRICE,g.MAX_PRICE]},REVIEW_RATING:{key:"reviews",dcsKey:g.MIN_RATING},GLOBAL_ELIGIBLE_ONLY:{key:"is_global_eligible",dcsKey:g.GLOBAL_ELIGIBLE_ONLY},PAGE:{key:"page",dcsKey:g.PAGE},PRIME_ELIGIBLE_ONLY:{key:"is_prime",
dcsKey:g.PRIME_ELIGIBLE_ONLY},PRIME_ACCESS_TYPE:{key:"prime_access_type",dcsKey:g.PRIME_ACCESS_TYPE},SORT_ORDER:{key:"sortOrder",dcsKey:g.SORT_ORDER},CASH_ON_DELIVERY:{key:"isCODAllowed",dcsKey:null},FULLFILLED_BY_AMAZON:{key:"isFulfilledByAmazon",dcsKey:null},NEW_RELEASES:{key:"newReleases",dcsKey:null},GIFT_WRAPPABLE:{key:"giftWrappable",dcsKey:null},ACCESS_TYPE:{key:"access_type",dcsKey:g.ACCESS_TYPE},EXCLUDED_ACCESS_TYPE:{key:"excluded_access_type",dcsKey:g.EXCLUDED_ACCESS_TYPE},INCLUDED_ACCESS_TYPE:{key:"included_access_type",
dcsKey:g.INCLUDED_ACCESS_TYPE},INTERESTS:{key:"interests",dcsKey:g.INTERESTS},ENFORCED_CATEGORIES:{key:"enforcedCategories",dcsKey:g.ENFORCED_CATEGORIES}};g=h.BinningParams;h.excludeBinningParamsForEvents=[g.PRICE.key,g.DISCOUNT.key];g=h.SortOrders;h.SortOrderLists={Events:[g.BY_RELEVANCE,g.BY_BEST_SELLING,g.BY_PRICE_ASCENDING,g.BY_PRICE_DESCENDING],Deals:[g.BY_SCORE,g.BY_BEST_SELLING,g.BY_PRICE_ASCENDING,g.BY_PRICE_DESCENDING,g.BY_DISCOUNT_ASCENDING,g.BY_DISCOUNT_DESCENDING]};(function(b){b.BinningKeyToDCSQueryParamMap=
{};l.each(b.BinningParams,function(a){b.BinningKeyToDCSQueryParamMap[a.key]=a.dcsKey});b.FilterAttrToBinName={};l.each(l.keys(b.BinningParams),function(a){var c=b.BinningParams[a].key;b.FilterAttrToBinName[c]=c===b.BinningParams.NEW_RELEASES.key||c===b.BinningParams.GIFT_WRAPPABLE.key?b.BinNames.INCLUDED_DEAL_TARGETS:b.BinNames[a]||null});b.BinNamesToCount=l.object(l.values(b.BinNames),l.values(b.BinCounts));b.FilterStatesToDealStates={};l.each(l.keys(b.DealStatesToFilterStates),function(a){var c=
b.DealStatesToFilterStates[a];b.FilterStatesToDealStates[c]=b.FilterStatesToDealStates[c]?b.FilterStatesToDealStates[c].concat([a]):[a]})})(h);return h});n.when("A","gb-enums").register("gb-base-utils",function(h,r){return{locale:null,checkAndSetSSLImageUrl:function(g){if("https:"===l.location.protocol&&g&&-1!==g.indexOf("http://")){var b=r.Constants.SECURE_IMAGES_URL_DEFAULT;gb.resources&&gb.resources.customerData&&"CN"===gb.resources.customerData.realm&&(b=r.Constants.SECURE_IMAGES_URL_CN);var a=
document.createElement("a");a.href=g;a.protocol="https:";a.hostname=b;g=a.href}return g}}});n.when("A","GoldboxMobile3PAssets","gb-base-utils","gb-event-emitter","gb-config-manager","gb-template-manager","gb-utilities").register("gb-resources",function(h,r,g,b,a,c,d){l.gb.baseUtils=l.gb.baseUtils||g;var e=r._;return new (b.extend({strings:{},images:{},features:{},customerData:{},categories:[],marketingIDs:[],deviceInfo:{},urls:{},whitelistedCategoryList:[],whitelistedCategoryNames:{},whitelistedCategoryNamesParsed:{},
whitelistedMarketingIDList:[],whitelistedMarketingIDNames:{},whitelistedMarketingIDNamesParsed:{},apiConfigs:{},interests:{},hasResourceFetchInitiated:{},registerResources:function(b,k){var m=this;e.extend(b,{widgetName:k});this.registerStrings(b.strings);this.registerFeatures(b.weblabs);this.registerCustomerData(b.customerData);e.isEmpty(b.categories)||this.registerCategories(b.categories);e.isEmpty(b.marketingIDs)||this.registerMarketingIDs(b.marketingIDs);this.registerDeviceInfo(b.deviceInfo);
e.isEmpty(this.urls)&&this.registerUrls(b.urls);this.registerImages(b.images);this.registerAPIConfigs(b.apiConfigs);this.registerInterests(b.interests);a.registerConfigs(b);c.registerTemplates(k,b.templates);this.hasResourceFetchInitiated[k]=!0;d.updateRedirectUrls(function(){m.register("gbResources");m.register(b.widget)})},registerStrings:function(a){this.updateResourceStore(this.strings,a)},getString:function(a,c){a=this.strings[a]||"";if(c)for(var d in c)c.hasOwnProperty(d)&&(a=a.replace(new RegExp("\\${"+
d+"}","g"),c[d]));return a},getCategoryName:function(a,c){return c?this.whitelistedCategoryNamesParsed[a]:this.whitelistedCategoryNames[a]||null},registerImages:function(a){e.each(a,function(c,d){a[d]=gb.baseUtils.checkAndSetSSLImageUrl(c)});this.updateResourceStore(this.images,a)},getImage:function(a){return this.images[a]},registerFeatures:function(a){this.updateResourceStore(this.features,a)},registerInterests:function(a){this.updateResourceStore(this.interests,a)},getFeature:function(a){return this.features[a]},
registerCustomerData:function(a){this.updateResourceStore(this.customerData,a)},getCustomerData:function(a){return this.customerData[a]},registerCategories:e.once(function(a){var c=this;this.updateResourceStore(this.categories,a);e.each(this.categories,function(a){c.whitelistedCategoryList.push(a.nodeId);c.whitelistedCategoryNames[a.nodeId]=a.category;c.whitelistedCategoryNamesParsed[a.nodeId]=e.unescape(a.category)})}),registerMarketingIDs:e.once(function(a){var c=this;this.updateResourceStore(this.marketingIDs,
a);e.each(this.marketingIDs,function(a){c.whitelistedMarketingIDList.push(a.marketingID);c.whitelistedMarketingIDNames[a.marketingID]=a.string;c.whitelistedMarketingIDNamesParsed[a.marketingID]=e.unescape(a.string)})}),getCategories:function(){return this.categories},registerDeviceInfo:function(a){this.updateResourceStore(this.deviceInfo,a);gb.clientName="pc";this.deviceInfo.isApp?gb.clientName="app":this.deviceInfo.isPhone&&!this.deviceInfo.isAWDesktopViewEnforced&&(gb.clientName="aw")},getDeviceInfo:function(){return this.deviceInfo},
registerUrls:function(a){this.updateResourceStore(this.urls,a)},getUrl:function(a){return this.urls[a]},updateResourceStore:function(a,c){if(c&&a)for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])},registerAPIConfigs:function(a){this.updateResourceStore(this.apiConfigs,a)},getAPIConfigs:function(){return this.apiConfigs},getInterests:function(){return e.values(this.interests)}}))});n.when("A","GoldboxMobile3PAssets","gb-csm").register("gb-utilities",function(h,r,g){var b=r._;return{digitalCategories:{US:"16261631 2350149011 154606011 163856011 979455011 1233514011 2402172011".split(" ")},
digitalGlProductGroup:"gl_digital_book_service gl_digital_ebook_purchase gl_digital_music_purchase gl_digital_video_download gl_downloadable_software gl_ebooks gl_digital_video_games gl_mobile_apps gl_digital_software".split(" "),defaultImageScaling:"AA",detailPageUrlPrefix:{pc:"/dp/",aw:"/gp/aw/d/",app:"/gp/aw/d/",tablet:"/gp/mobile/dp/"},requestObjSortBy:{includedBins:"name",dealGroups:"keys",excludedExtendedFilters:"keys",extendedFilters:"keys",exclusiveTargetValues:"name",inclusiveTargetValues:"name",
dealTargets:"dealID"},stateToDealViewTemplates:{PRIME_EARLY_ACCESS:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType primeEarlyAccess couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),
UPCOMING:"image title time description reviewStars primeEarlyAccess primeBadge shipSold dealType primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
APP_EARLY_ACCESS:{LOADING:[],AVAILABLE:"appEarlyAccess image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"appEarlyAccess image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},PRIME_ONLY_LD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
PRIME_ONLY_DOTD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),
UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
PRIME_ONLY_BD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),
UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
APP_ONLY_LD:{LOADING:[],AVAILABLE:"appOnlyAccess image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"appOnlyAccess image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},GIVEAWAY_DEAL:{LOADING:[],AVAILABLE:"image title description priceBlock ifdMessage button giveaway dealType merchant selector dealAction widgetErrorAlert secondaryBadge".split(" "),
COMINGSOON:[],UPCOMING:[],SOLDOUT:[],EXPIRED:"image title description priceBlock button giveaway dealType merchant selector dealAction widgetErrorAlert".split(" ")},NONE:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")}},
picassoClickAttributes:["qualifier","id","adId","widgetName"],price:{CA:{currency:"CAD",decimal:2,thousandSeparator:"",decimalSeparator:".",format:function(a){return"C$"+a}},US:{currency:"USD",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"$"+a}},UK:{currency:"GBP",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26pound;"+a}},DE:{currency:"EUR",decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" \x26euro;"}},
FR:{currency:"EUR",decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" \x26euro;"}},JP:{currency:"JPY",decimal:0,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26yen; "+a}},CN:{currency:"CNY",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26yen;"+a}},IN:{currency:"INR",decimals:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26#8377;"+a}},IT:{currency:"EUR",decimal:2,thousandSeparator:".",
decimalSeparator:",",format:function(a){return a+" \x26euro;"}},ES:{currency:"EUR",decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" \x26euro;"}},MX:{currency:"MXN",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"$"+a}},BR:{currency:"BRL",thousandSeparator:".",decimalSeparator:",",decimal:2,format:function(a){return"R$ "+a}},AU:{currency:"AUD",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"$"+a}},TR:{currency:"TRY",
decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" TL"}}},ppuRealms:["UK","DE","FR","ES","IT"],getAppStoreURL:function(){var a="";gb.resources.deviceInfo.isApp&&(gb.resources.deviceInfo.isIOS?a=gb.enums.AppStoreLink.iOS:gb.resources.deviceInfo.isAndroid&&(a=gb.enums.AppStoreLink.android));return a},_formatPrice:function(a,c){a=parseFloat(a);a=void 0!==c.decimal||null!==c.decimal?a.toFixed(c.decimal):a.toString();a=a.split(".");for(var d=a[0],b=d.length-3;0<b;b-=3)d=
d.substr(0,b)+c.thousandSeparator+d.substr(b,d.length-b);return c.format(2===a.length?d+c.decimalSeparator+a[1]:d)},getFormattedPrice:function(a){var c=gb.resources.getCustomerData("realm"),c=this.price[c],d=document.createElement("span");h.$(d).html(this._formatPrice(a,c));return d.innerHTML},getPriceRange:function(a){var c=null;a.max.value>a.min.value&&(c=a.min.formattedValue+" - "+a.max.formattedValue);return c},getSubnavPageElementFromDomID:function(a){return h.$("#"+h.$("#"+a).parent().parent().prop("id"))},
getSubnavSlotID:function(a,c){return gb.subnavController.SubnavIDs.SubnavPage+a+"slot"+c},parseBool:function(a){return!0===a||1===a||"1"===a},getDealViewID:function(a,c){return a+"_dealView_"+c},getAdRowID:function(a,c){return a+"_adSlot_"+c},getPageID:function(a,c){return a+"_page_"+c},getFilterItemViewID:function(a,c){return"FilterItemView_"+a.join("-")+"_"+c},resizeImage:function(a,c,d){a=a||gb.resources.getImage("goldbox_upcoming");a.substring(a.lastIndexOf(".")+1).toLowerCase()in{jpg:!0,jpeg:!0,
png:!0,gif:!0,tif:!0}||(a=gb.resources.getImage("goldbox_upcoming"));if(void 0===c||null===c)return a;if(void 0===d||null===d)d=this.defaultImageScaling;return a.replace(/\.((_.*_)\.)?(\w+)$/,".$2_"+d+c+"_.$3")},getViewTemplatesForState:function(a){var c=gb.enums.DealStateToTemplateMap[a.dealState];return a.dealType===gb.enums.DealTypes.EVENT?c===gb.enums.DealStates.LOADING?this.stateToDealViewTemplates.NONE.LOADING:this.stateToDealViewTemplates.NONE.AVAILABLE:a.detail.isPrimeOnly&&!gb.utils.isPODealForNonPrimeUser(a)||
!a.detail.accessType?this.stateToDealViewTemplates.NONE[c]||[]:this.stateToDealViewTemplates[a.detail.accessType][c]||[]},getStateTemplateName:function(a,c){return c===gb.enums.DealTypes.EVENT?a===gb.enums.DealStates.LOADING?gb.enums.StateTemplates.LOADING:gb.enums.StateTemplates.AVAILABLE:gb.enums.StateTemplates[a]},calculatePercentOff:function(a,c){if(null===a||void 0===a||null===c||void 0===c||"number"!==typeof a||"number"!==typeof c||0===a)return null;var d=a-c;if(0>=d)return null;c=0;"CN"===
gb.resources.getCustomerData("realm")?(c=1,a=10*(1-d/a)):a=d/a*100;return Math.round(a*Math.pow(10,c))/Math.pow(10,c)},getDisplayablePercentOff:function(a){return a&&"number"===typeof a?"CN"===gb.resources.getCustomerData("realm")?(100-a)/10:a:null},heroTimer:function(a,c,d,b){a={dealDate:a,viewElement:c,spanID:d,update:function(){var a=this,k=a.dealDate.getTime()-(new Date).getTime();0>k&&(k=0);var m=Math.floor(k/gb.enums.Constants.HOUR_IN_MILLIS),q=Math.floor(k/gb.enums.Constants.MINUTE_IN_MILLIS%
60),k=Math.floor(k/gb.enums.Constants.SECOND_IN_MILLIS%60);if(b)10>k&&(k="0"+k),10>q&&(q="0"+q),a.timeString=0!==m?m+":"+q+":"+k:q+":"+k;else{10>m&&(m="0"+m);10>q&&!a.noHours&&(q="0"+q);10>k&&(k="0"+k);var g=gb.resources.getString("gbd_hour_separator")+" ",r=gb.resources.getString("gbd_minute_separator")+" ",n=gb.resources.getString("gbd_seconds_separator")+" ";a.timeString=m+g+q+r+k+n;gb.accessibility.trigger("AccessibilityAction","updateHeroTimer",{viewElement:c,spanID:d,timerInfo:{hours:m,minutes:q,
seconds:k}})}h.$(c).find("#"+d).html(a.timeString);a.timeout&&l.clearTimeout(a.timeout);a.timeout=l.setTimeout(function(){a.update()},500)}};a.update();return a},formatDate:function(a){var c=gb.resources.getString("gb_month_"+a.getMonth());a=a.getDate();10>a&&(a="0"+a);return gb.resources.getString("gb_date_format",{month:c,day:a,date_suffix:gb.resources.getString("gb_date")})},formatTime:function(a,c){var d="";if(24<a)return d;var d=gb.resources.getCustomerData("realm"),e=12<=a?gb.resources.getString("gb_pm"):
gb.resources.getString("gb_am"),f=b.contains([gb.enums.Realms.US,gb.enums.Realms.UK,gb.enums.Realms.IN,gb.enums.Realms.MX],d)?!1:!0;10>c&&(c="0"+c);f?(10>a&&(d===gb.enums.Realms.DE||d===gb.enums.Realms.FR)&&(a="0"+a),e=""):a=a%12||12;return d=gb.resources.getString("gb_time",{hours:a,minutes:c,period:e})},ellipsify:function(a){var c=a.el,d=a.jQuery,b=a.wordsIntact;a=a.removeDots;var f=c.clone().empty().css({display:"none",height:"auto"}).width(c.width());c.width(c.width());d(c).after(f);var k=d.trim(c.html());
f.html(k);if(!(f.height()<=c.height())){f.empty();for(var m=0,q=0,g=k.length;m<k.length&&q<g;)m=Math.floor((q+g)/2),a?f.html(k.substr(0,m)):f.html(k.substr(0,m)+"..."),f.height()<=c.height()?q=m+1:g=m-1;k=k.substr(0,q-1);b&&(b=k.lastIndexOf(" "),k=k.substr(0,b));a||(k+="...");c.html(k)}d(f).remove()},setUrlParam:function(a,c,d){var b=a.indexOf("#"),f=-1===b?"":a.substr(b);a=-1===b?a:a.substr(0,b);c=encodeURIComponent(c);var b=new RegExp("([?\x26])"+c+"\x3d.*?(\x26|$)","i"),k=-1!==a.indexOf("?")?"\x26":
"?";a=a.match(b)?a.replace(b,"$1"+c+"\x3d"+d+"$2"):a+k+c+"\x3d"+d;return a+f},clearUrlParam:function(a,c){var d=a.indexOf("#"),b=-1===d?"":a.substr(d);a=-1===d?a:a.substr(0,d);c=encodeURIComponent(c);c=new RegExp("([?\x26])"+c+"\x3d.*?(\x26|$)","gi");a.match(c)&&(a=a.replace(c,"$1"),a=a.replace(/[?&]$/,""));return a+b},enforceUTFEncodingInUrl:function(a){a=this.clearUrlParam(a,"ie");return this.setUrlParam(a,"ie","UTF8")},setUrlHash:function(a,c){var d=a.indexOf("#");a=-1===d?a:a.substr(0,d);return c?
a+"#"+c:a},setSafeTimeout:function(a,c){if(0<c&&c<gb.enums.Constants.MAX_TIMEOUT)return l.setTimeout(a,c)},getDetailPageURL:function(a,c){c=this.detailPageUrlPrefix[c]+a;gb.resources.deviceInfo.isApp&&!gb.resources.deviceInfo.isIPhone&&(c=gb.utils.setUrlParam(c,"app-action","detail"),c=gb.utils.setUrlParam(c,"asin",a));return c},hasConflictingDpParams:function(a){var c=!1;a=a.split("?")[1]?"\x26"+a.split("?")[1]:null;var d=["smid","m","me"];if(a)for(var b=0;b<d.length;b++)if(0<=a.indexOf("\x26"+d[b]+
"\x3d")){c=!0;break}return c},getSponsoredDealUrl:function(a,c){for(var d=gb.enums.SponsoredDealURL.picassoRedirect,b=this.picassoClickAttributes,f=0;f<b.length;f++)a[b[f]]&&(d=this.setUrlParam(d,b[f],a[b[f]]));a=encodeURIComponent(c);return d=this.setUrlParam(d,"url",a)},isSponsoredDeal:function(a,c){return b.isEmpty(c)?!1:(c=c.dealsWithBids)&&c[a]?!0:!1},getCookie:function(a){return(a=document.cookie.match(new RegExp("(^| )"+a+"\x3d([^;]+)")))?a[2]:""},getReviewsPageURL:function(a,c){return gb.enums.ReviewsPageURL[gb.clientName]+
a},getShovelerWidth:function(a){var c=gb.configManager.getDealViewConfig(a.widgetID),d=gb.configManager.getWidgetViewConfig(a.widgetID),b=parseInt(c.dealsLimit,10),f=parseInt(c.imageSize,10),k=parseInt(c.dealsMargin,10),c=parseInt(d.redirectDivWidth,10),m=parseInt(d.redirectDivLeftMargin,10),q=parseInt(d.redirectDivRightMargin,10),d=0;a.totalDealsToShowCount>b?(a=b-6,f=(f+k)*a+m+c+q,d=1):(a=a.totalDealsToShowCount,f=(f+k)*a);return{redirectDivWidth:c,showRedirectDiv:d,shovelerDealsToShow:a,shovelerWidth:f}},
pushAddressInBrowserHistory:function(a,c,d){return l.history&&"function"===typeof history.pushState&&"function"===typeof history.replaceState?(d=d||{},d.attribution=gb.enums.BrowserHistory.ATTRIBUTION,c?(b.isEmpty(l.history.state)&&l.history.replaceState({state:"initialLoad",attribution:gb.enums.BrowserHistory.ATTRIBUTION},"",l.location.href),l.history.pushState(d,"",a)):l.history.state&&l.history.state.bottom_sheet_open?l.setTimeout(function(){l.history.replaceState(d,"",a)},1E3):l.history.replaceState(d,
"",a),gb.metrics.recordRefViaAjax(this.extractRefFromUrl(a)),!0):!1},updateAddressBarUrl:function(a,c,d){this.pushAddressInBrowserHistory(a,c,d)?this.updateRedirectUrls():l.location.href=a},getCurrentRelativeURL:function(){return l.location.pathname+l.location.search},updateRedirectUrls:function(a){var c=this;n.when("gb-config-manager").execute("gb-utilities-updateRedirectUrls",function(d){try{var e=d.redirectURLConfigs,f={},k=c.getCurrentRelativeURL(),m=l.escape(l.btoa(k));b.each(e.base64encodedUrls,
function(a){var c=gb.resources.getUrl(a);c&&(f[a]=c.replace(c.match(/redirectURL=([^&?]*)/)[1],m))});b.each(e.encodedURIComponents,function(a){var c=gb.resources.getUrl(a);if(c){var d=c.match(/query=([^&?]*)/)[1];if(d){var b=decodeURIComponent(d);b&&(k=encodeURIComponent(k),b=b.replace(b.match(/dest=([^&?]*)/)[1],k),f[a]=c.replace(d,encodeURIComponent(b)))}}});gb.resources.registerUrls(f);a&&a()}catch(q){a&&a(),n.log("GBUtilities - Redirection url updates failed","ERROR","GoldboxMobileAssets")}})},
getParamValueFromUrl:function(a,c){c=c.replace(/[\[]/,"[").replace(/[\]]/,"]");return(a=(new RegExp("[\\?\x26]"+c+"\x3d([^\x26#]*)")).exec(a))?l.decodeURIComponent(a[1].replace(/\+/g," ")):""},getHashOfAppliedFilters:function(a){var c={};a=a.split(",");for(var d=0;d<a.length;d++){var b=a[d].split(":");c[b[0]]=b[1]}return c},_getFiltersAppliedUrl:function(a,c,d,b){return this.setUrlParam(l.location.href,gb.enums.BrowserHistory.STATE_KEY+a,gb.enums.CustomerAppliedFilters.PAGE+":"+c+","+gb.enums.CustomerAppliedFilters.CATEGORY+
":"+d+","+gb.enums.CustomerAppliedFilters.STATUS+":"+b)},updateFiltersInAddressBar:function(a,c,d,b){a=this._getFiltersAppliedUrl(a,c,d,b);this.updateAddressBarUrl(a)},getWidgetLandingPageUrl:function(a){return this.getParamValueFromUrl(l.location.href,gb.enums.BrowserHistory.STATE_KEY+a)?this._getFiltersAppliedUrl(a,1,gb.enums.CategoryFilters.ALL,gb.enums.StatusFilters.AVAILABLE):l.location.href},getCustomerActionTemplateInfo:function(a,c){var d=a.dealState,b=a.detail.itemType,f=a.status.percentClaimed,
k=a.customerState,m=a.dealType,q={},g=!0,h=!0,l=!0,r=!1,n=gb.resources.deviceInfo,x=gb.configManager.getDealViewConfig(c);q.showWatchDealButton=!1;gb.controller.schedulingParams[c]&&gb.controller.schedulingParams[c].fetchWatchedDeals&&m===gb.enums.DealTypes.LD&&(q.showWatchDealButton=!0);if(b===gb.enums.ItemTypes.SINGLE)if(m===gb.enums.DealTypes.LD)switch(r=this._shouldShowWaitlistFeatures(n),d===gb.enums.DealStates.AVAILABLE?(q.purchaseState=gb.enums.PurchaseStates.ADD_TO_CART,q.buttonText=gb.resources.getString("gb_add_to_cart")):
(q.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,q.buttonText=gb.resources.getString("gb_view_deal")),r&&(d===gb.enums.DealStates.WAITLIST?(q.purchaseState=gb.enums.PurchaseStates.JOIN_WAITLIST,q.buttonText=gb.resources.getString("gbd_join_waitlist")):d===gb.enums.DealStates.WAITLISTFULL&&(q.purchaseState=gb.enums.PurchaseStates.WAITLIST_FULL,g=null),k===gb.enums.CustomerStates.INWAITLIST&&(q.purchaseState=gb.enums.PurchaseStates.INWAITLIST,q.buttonText=gb.resources.getString("gb_add_to_cart"),g=
null,l=!this.isTablet(gb.clientName))),k){case gb.enums.CustomerStates.INCART:q.purchaseState=gb.enums.PurchaseStates.INCART;g=null;l=!this.isTablet(gb.clientName);h=null;break;case gb.enums.CustomerStates.CLAIMED:q.purchaseState=gb.enums.PurchaseStates.CLAIMED;g=null;l=!this.isTablet(gb.clientName);h=null;break;case gb.enums.CustomerStates.PENDINGATC:q.purchaseState=gb.enums.PurchaseStates.PENDINGATC,q.buttonText=gb.resources.getString("gb_add_to_cart"),l=!this.isTablet(gb.clientName),h=null}else l=
!this.isTablet(gb.clientName),q.purchaseState=gb.enums.PurchaseStates.ADD_TO_CART,q.buttonText=gb.resources.getString("gb_add_to_cart");else if(b===gb.enums.ItemTypes.VARIATION){if(l=!0,c=gb.resources.deviceInfo.isPhone,d=gb.utils.isTablet(gb.clientName),q.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,q.buttonText=gb.resources.getString("gb_see_options"),c||d&&gb.resources.deviceInfo.isApp)q.buttonText=gb.resources.getString("gb_view_deal")}else b===gb.enums.ItemTypes.MULTI?(l=!this.isTablet(gb.clientName),
q.buttonText=gb.resources.getString("gb_view_deal")):(q.buttonText=m===gb.enums.DealTypes.COUPON?gb.resources.getString("gb_clip_coupon"):gb.resources.getString("gb_view_deal"),l=!this.isTablet(gb.clientName)),q.purchaseState=gb.enums.PurchaseStates.SEE_DEAL;q.showButton=g;q.showTime=h;q.showPercentClaimed=l;q.showWaitlistFeatures=r;b===gb.enums.ItemTypes.SINGLE&&a.isDigital&&(q.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,q.buttonText=gb.resources.getString("gb_view_deal"));if(this._isPurchaseStateOverrideRequiredForAppDeals(a,
k)||this._isPurchaseStateOverrideRequiredForPrimeDeals(a))q.purchaseState=gb.enums.PurchaseStates.LEARN_MORE,q.buttonText=gb.resources.getString("gb_learn_more"),q.showButton=!0,q.showTime=!0,q.showPercentClaimed=a.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&a.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_BD?!0:!1;q.primeSignUpUrl=this.getPrimeSignUpUrlForAccessType(a);q.appDownloadUrl=gb.enums.appDownloadURL;q.showPercentClaimed=q.showPercentClaimed&&this._shouldShowPercentClaimed(f,
x);this._setTemplateDataForMetroApp(q);q.shouldDisplayIFDMessage=this.shouldDisplayIFDMessage(a);return q},_shouldShowWaitlistFeatures:function(a){var c=a.isIOS,d=a.isAndroid||a.isAndroidUserAgent,b=a.isFirePhone,f=a.isPhone,k=this.isTablet(gb.clientName);a=a.isAppVersionHigher;var m=gb.resources.getFeature("waitlist_feature_mobile_IOS"),q=gb.resources.getFeature("waitlist_feature_tablet_IOS"),g=gb.resources.getFeature("waitlist_feature_mobile_Android"),h=gb.resources.getFeature("waitlist_feature_tablet_Android");
return gb.clientName===gb.enums.MobileClients.PC?!0:b&&a&&h||k&&a&&(c&&q||d&&h)||f&&(c&&m||d&&g)},_isPurchaseStateOverrideRequiredForAppDeals:function(a,c){return(a.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&this.isDealInEarlyAccessWindow(a)||a.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)&&c!==gb.enums.CustomerStates.INCART&&c!==gb.enums.CustomerStates.CLAIMED?!0:!1},_isPurchaseStateOverrideRequiredForPrimeDeals:function(a){return(this.isDealInEarlyAccessWindow(a)&&
a.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a.detail.isPrimeOnly)&&!gb.resources.customerData.hasEarlyAccessBenefit?!0:!1},getVariationCustomerActionTemplateInfo:function(a,c){var d=a.deal,b=d.detail.itemType,f=d.dealState,f=c?c.status.itemState:f,k=c?c.status.percentClaimed:d.status.percentClaimed;c=c?c.status.customerState:d.customerState;var m={},q=!0,g=!0,h=!0,l=!1;a=a.widgetView.widgetID;var r=gb.configManager.getDealViewConfig(a);if(d.dealType===gb.enums.DealTypes.LD&&
b===gb.enums.ItemTypes.VARIATION){if(gb.clientName===gb.enums.MobileClients.PC||gb.widgets[a].widgetName===gb.enums.WidgetNames.ML_HERO)l=!0;m.showWatchDealButton=!1;gb.controller.schedulingParams[a]&&gb.controller.schedulingParams[a].fetchWatchedDeals&&(m.showWatchDealButton=!0);if(f===gb.enums.DealStates.AVAILABLE||f===gb.enums.DealStates.SOLDOUT)m.purchaseState=gb.enums.PurchaseStates.ADD_TO_CART,m.buttonText=gb.resources.getString("gb_add_to_cart");l&&(f===gb.enums.DealStates.WAITLIST?(m.purchaseState=
gb.enums.PurchaseStates.JOIN_WAITLIST,m.buttonText=gb.resources.getString("gbd_join_waitlist")):f===gb.enums.DealStates.WAITLISTFULL&&(m.purchaseState=gb.enums.PurchaseStates.WAITLIST_FULL,q=null),c===gb.enums.CustomerStates.INWAITLIST&&(m.purchaseState=gb.enums.PurchaseStates.INWAITLIST,m.buttonText=gb.resources.getString("gb_add_to_cart"),q=null,h=!this.isTablet(gb.clientName)));c===gb.enums.CustomerStates.INCART?(m.purchaseState=gb.enums.PurchaseStates.INCART,q=null,h=!this.isTablet(gb.clientName),
g=null):c===gb.enums.CustomerStates.CLAIMED?(m.purchaseState=gb.enums.PurchaseStates.CLAIMED,q=null,h=!this.isTablet(gb.clientName),g=null):c===gb.enums.CustomerStates.PENDINGATC&&(m.purchaseState=gb.enums.PurchaseStates.PENDINGATC,m.buttonText=gb.resources.getString("gb_add_to_cart"),h=!this.isTablet(gb.clientName),g=null)}m.showButton=q;m.showTime=g;m.showPercentClaimed=h;m.showWaitlistFeatures=l;if(d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&this.isDealInEarlyAccessWindow(d)||
d.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD||(this.isDealInEarlyAccessWindow(d)||d.detail.isPrimeOnly)&&!gb.resources.customerData.hasEarlyAccessBenefit)if(m.purchaseState=gb.enums.PurchaseStates.LEARN_MORE,m.buttonText=gb.resources.getString("gb_learn_more"),m.showButton=!0,m.showTime=!0,m.showPercentClaimed=!0,d.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||d.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_BD)m.showPercentClaimed=!1;m.primeSignUpUrl=this.getPrimeSignUpUrlForAccessType(d);
m.appDownloadUrl=gb.enums.appDownloadURL;m.showPercentClaimed=m.showPercentClaimed&&this._shouldShowPercentClaimed(k,r);this._setTemplateDataForMetroApp(m);m.shouldDisplayIFDMessage=this.shouldDisplayIFDMessage(d);return m},getPrimeSignUpUrlForAccessType:function(a){return(a=gb.enums.PrimeSignUpURL[a.detail.accessType])?gb.resources.getUrl(a):null},isShowPercentageOffEnabled:function(){return gb.resources.getCustomerData("realm")===gb.enums.Realms.CN?!1:!0},isSpecialPricingStyleEnabled:function(){var a=
gb.resources.getFeature("gb_cn_ld_m_price_style"),c=gb.resources.getCustomerData("realm"),d=!1;gb.enums.Realms.CN===c&&gb.enums.Weblabs.TREATMENTS.T1===a&&(d=!0);return d},getRandomNumber:function(a,c){return Math.floor(Math.random()*(c-a+1))+a},isDealInEarlyAccessWindow:function(a){var c=!1;a.status.dates.end.getTime();(new Date).getTime();var d=a.status.dates.start.getTime()-(new Date).getTime();(a.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS)&&
0>=d&&-d<a.detail.accessDurationInMs&&(c=!0);return c},isPrimeSignupRedirectSupported:function(){var a=!0;gb.resources.deviceInfo.isIOS&&gb.resources.deviceInfo.isApp&&"CN"!==gb.resources.getCustomerData("realm")&&(a=!1);return a},isPEADealForNonPrimeUser:function(a){return a.detail.isPrimeEarlyAccessDeal&&gb.utils.isDealInEarlyAccessWindow(a)&&!gb.resources.getCustomerData("isPrimeMember")?!0:!1},isPODealForNonPrimeUser:function(a){return a.detail.isPrimeOnly&&!gb.resources.getCustomerData("isPrimeMember")?
!0:!1},isTablet:function(a){return gb.resources.deviceInfo.isApp&&!gb.resources.deviceInfo.isPhone||a===gb.enums.Platforms.TAB?!0:!1},isDOTDDeal:function(a){return a.dealType===gb.enums.DealTypes.DOTD||a.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD},getDealsPerRow:function(a,c,d,b,f){a=this.getWindowWidth(a,{hasMargin:d});a=Math.floor(a/c);b?a-=a%2:f||(5===a?a=4:6<=a&&(a=6));return a},getWindowWidth:function(a,c){if(c)for(var d in c)c.hasOwnProperty(d)&&"hasMargin"===d&&c[d]&&(a*=
.9);return a},getWindowLocationOrigin:function(){l.location.origin||(l.location.origin=l.location.protocol+"//"+l.location.hostname+(l.location.port?":"+l.location.port:""));var a=l.location.origin;a||(a=l.location.protocol+"//"+l.location.hostname,l.location.port&&(a=l.location.origin+":"+l.location.port));return a},isUnsupportedEgressURL:function(a){var c=!1,d=gb.enums.Constants.EGRESS_URL_UNSUPPORTED_REGEX;(a.itemType===gb.enums.ItemTypes.MULTI||a.type===gb.enums.DealTypes.BD&&a.itemType===gb.enums.ItemTypes.NONE)&&
d.test(a.egressUrl)&&(c=!0);return c},getAsinFromURL:function(a){var c=document.createElement("a");c.href=a;return(a=c.pathname.match(gb.enums.Constants.EXTRACT_ASIN_URL_REGEX))&&2<a.length?a[2]:""},getReviewStars:function(a){if(null===a||void 0===a||0>a||5<a)a=0;var c=Math.floor(a);a=parseFloat(a-c).toFixed(1);var d=!1;a>gb.enums.RoundedReviewStarsThresholds.HIGH?c+=1:a>=gb.enums.RoundedReviewStarsThresholds.LOW&&(d=!0);return{fullStars:c,hasHalfStar:d}},sendLogData:function(a,c){l.navigator&&navigator.sendBeacon?
navigator.sendBeacon(a,c):h.$.ajax({url:a,data:c,async:!1})},getFilterViewIDs:function(a){var c=this,d={};b.each(a,function(a){var f=b.map(a.attr.split(","),h.$.trim);d[f.join("_")]=c.getFilterItemViewID(f,a.type)});return d},getExtendedArray:function(a,c,d,b){a=void 0!==b?this.getExtendedArray(a,b):Array(a);void 0===d&&(d=0);Array.prototype.splice.apply(a,[d,c.length].concat(c));return a},getFilterAttributesList:function(a){return b.flatten(b.map(a,function(a){return b.map(a.attr.split(","),function(a){return a.trim()})}))},
getIncludedBins:function(a){a=this.getFilterAttributesList(a);a=b.filter(b.map(a,function(a){return gb.enums.FilterAttrToBinName[a]}),function(a){if(a)return a});a=b.uniq(a);return b.map(a,function(a){return{name:a,count:gb.enums.BinNamesToCount[a]}})},getBoundingRect:function(a){if(!a)return!1;a=document.getElementById(a);if(!a||"none"===h.$(a).css("display"))return!1;a=a.getBoundingClientRect();return!a||0===a.top&&0===a.bottom&&0===a.left&&0===a.right?!1:a},filterDealsByViewport:function(a){var c=
{},d=this;b.each(gb.watcher.dealsInView,function(a,e){b.each(a,function(a,b){a=d.getDealViewID(b,a);c[a]=e})});var e=gb.utils.getDealViewsInViewport(c,1);return b.intersection(a,e)},getDealViewsInViewport:function(a,c){var d=this,e=h.$(l).height(),f=h.$(l).width(),k=[];b.each(a,function(a,b){(b=d.getBoundingRect(b))&&b.top>=-1*c*e&&b.top<=(1+c)*e&&b.bottom>=-1*c*e&&b.bottom<=(1+c)*e&&b.left>=-1*c*f&&b.left<=(1+c)*f&&b.right>=-1*c*f&&b.right<=(1+c)*f&&k.push(a)});return k},hasPricingDetails:function(a){var c=
!1;a=a.pricingData.prices.dealPrice;void 0!==a&&null!==a&&(c=!0);return c},isElementInViewPort:function(a){a=this.getBoundingRect(a);if(!1===a)return gb.enums.ViewPortPresence.ABSENT;var c=a.top,d=a.bottom,b=a.left,f=a.right,k=h.$(l).height(),m=h.$(l).width();a=0<=c&&c<=k;var c=0>c,q=0<=d&&d<=k,d=d>k,k=0<=b&&b<=m,b=0>b,g=0<=f&&f<=m,f=f>m;if(a&&q&&k&&g)return gb.enums.ViewPortPresence.FULL;if(k&&g){if(c&&d)return gb.enums.ViewPortPresence.FULL_VERTICAL_CONTENT;if(a&&d)return gb.enums.ViewPortPresence.PARTIAL_TOP;
if(c&&q)return gb.enums.ViewPortPresence.PARTIAL_BOTTOM}if(a&&q){if(b&&f)return gb.enums.ViewPortPresence.FULL_HORIZONTAL_CONTENT;if(k&&f)return gb.enums.ViewPortPresence.PARTIAL_LEFT;if(b&&g)return gb.enums.ViewPortPresence.PARTIAL_RIGHT}return a&&d&&k&&f?gb.enums.ViewPortPresence.PARTIAL_TOP_LEFT:a&&d&&b&&g?gb.enums.ViewPortPresence.PARTIAL_TOP_RIGHT:c&&q&&k&&f?gb.enums.ViewPortPresence.PARTIAL_BOTTOM_LEFT:c&&q&&b&&g?gb.enums.ViewPortPresence.PARTIAL_BOTTOM_RIGHT:gb.enums.ViewPortPresence.ABSENT},
removeImage:function(a){var c=a.find(".dealViewImage");c.length||(c=a.find("img"));if(c.size())return a={imageContent:c.parent().html(),imageContainer:c.parent()},c.remove(),a},isWidgetWithStatusFilter:function(a){var c=!0;b.contains([gb.enums.WidgetNames.M_HERO,gb.enums.WidgetNames.M_SUPPLE,gb.enums.WidgetNames.TAB_SUPPLE],a)&&(c=!1);return c},shouldShowMiniDetailPageModal:function(a){var c=!1,d=a.deal;a=gb.controller.schedulingParams[a.widgetView.widgetID];var b=a.disableMiniDP;!a.showShortCellView||
b||d.dealState!==gb.enums.DealStates.UPCOMING&&d.detail.itemType!==gb.enums.ItemTypes.SINGLE&&d.detail.itemType!==gb.enums.ItemTypes.VARIATION||(c=!0);return c},isTouchDevice:function(){return"ontouchstart"in l||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},invokeWatchDealStateTransitions:function(a){var c=gb.controller.dealDAOs[a];c.isDealWatched&&(b.each(gb.metadata.watchedDeals,function(d,e){if(e!==gb.enums.Constants.ALL){d=b.indexOf(d,a);var f=gb.enums.WatchedDealStateMap[c.dealState];
-1<d&&f!==e?gb.metadata.watchedDeals[e].splice(d,1):-1===d&&f===e&&gb.metadata.watchedDeals[e].unshift(a)}}),gb.metadata.trigger("RefreshWatchedDealWidgets",b.keys(gb.widgets),c.dealID))},getWatchedDealStates:function(a){return a?b.map(a,function(a){return gb.enums.WatchedDealStateMap[a]}):b.uniq(b.values(gb.enums.WatchedDealStateMap))},getWatchedDealWidgetData:function(a){var c=this.getWatchedDealStates(a),d={},e=[],f=gb.enums.DealStates.AVAILABLE;b.each(gb.metadata.watchedDeals,function(a,m){-1!==
b.indexOf(c,m)&&(d[f]=a,e=b.union(e,a))});return{selectedDealsCount:e.length,sortedDealIDs:e,dealsByState:d}},isDealActionable:function(a){if(!a)return!1;a=gb.controller.getDealDAO(a);return!a||a.dealState!==gb.enums.DealStates.AVAILABLE&&a.dealState!==gb.enums.DealStates.WAITLIST?!1:a.detail.isPrimeOnly?gb.resources.customerData.isPrimeMember:a.detail.isPrimeEarlyAccessDeal&&this.isDealInEarlyAccessWindow(a)?gb.resources.customerData.hasEarlyAccessBenefit:!0},callAsyncAjax:function(a,c){l.navigator&&
navigator.sendBeacon?navigator.sendBeacon(a,c):h.$.ajax({url:a,data:c,async:!1})},logRedirectPurchaseAttributes:function(a,c,d){if(a&&c&&(d||a.impressionAsin)){d||(d=a.impressionAsin);c="/gp/deal/ajax/logPurchaseAttributes.html?asin\x3d"+d+"\x26et\x3d"+c+"\x26ht\x3dredirect";a.parentAsin&&(c+="\x26ca\x3d"+a.parentAsin);a.merchantID&&(c+="\x26mt\x3d"+a.merchantID);var b=gb.resources.getCustomerData("realm"),b=this.price[b].currency,f=null;a.itemType===gb.enums.ItemTypes.VARIATION&&(f=a.getAsinDAO(d).dealPrice);
a.dealAsinsHash[d]&&a.dealAsinsHash[d].dealPrice&&(f=a.dealAsinsHash[d].dealPrice.price,b=a.dealAsinsHash[d].dealPrice.currency);null!==f&&null!==b&&(c+="\x26pr\x3d"+this.getCrypticPrice(f),c+="\x26cu\x3d"+b);h.$.ajax({url:c,async:!1})}},getCrypticPrice:function(a){return b.isNumber(a)?a.toString().split("").map(function(a){return String.fromCharCode(a.charCodeAt(0)+17).replace("?","X")}).join(""):null},areNestedKeysPresent:function(a,c){if(!b.isObject(a)||!b.isString(c))return!1;c=c.split(".");for(var d=
0;d<c.length;d++){if(!a||!a.hasOwnProperty(c[d]))return!1;a=a[c[d]]}return!0},showPPU:function(a){var c=gb.resources.getCustomerData("realm");return b.contains(this.ppuRealms,c)&&a?(a=gb.controller.getDealDAO(a))?a.pricingData.unitPrice&&a.pricingData.baseUnit?!0:!1:!1:!1},hasDigitalCategory:function(a){return b.intersection(a,gb.utils.digitalCategories[gb.resources.customerData.realm]).length?!0:!1},_setTemplateDataForMetroApp:function(a){var c=gb.resources.deviceInfo;c.isApp&&c.isMetro&&c.isWin&&
(a.showButton=!1)},removeNulls:function(a){if(b.isObject(a)){var c,d,e;a instanceof Array?(c=[],d=!0,e=0):(c={},d=!1);for(var f in a)if(a.hasOwnProperty(f)){var k=this.removeNulls(a[f]);k&&(c[d?e++:f]=k)}return b.isEmpty(c)?null:c}return a?a:null},sortRequestObj:function(a,c){if(b.isObject(c)&&!b.isEmpty(c))if(c instanceof Array)if(b.isObject(c[0])){var d=this.requestObjSortBy[a];d&&c.sort(function(a,c){return(a[d]>c[d])-(a[d]<c[d])})}else c.sort();else if(c instanceof Object){for(var e in c)c.hasOwnProperty(e)&&
(c[e]=this.sortRequestObj(e,c[e]));if(this.requestObjSortBy[a]){a={};var f=Object.keys(c);f.sort();for(e=0;e<f.length;e++)a[f[e]]=c[f[e]];c=a}}return c},isOfferingRestrictionViolated:function(a){for(var c in a)if("quantityRestriction"===a[c].category)return!0;return!1},isDefinedAndNonNull:function(a){return null!==a&&void 0!==a?!0:!1},extractRefFromUrl:function(a){var c=a.indexOf("/ref\x3d");if(-1===c)return"";a=a.substr(c+5);c=a.indexOf("?");-1!==c&&(a=a.substr(0,c));return a},getDeviceOrientation:function(a){a=
gb.configManager.getWidgetViewConfig(a);a=parseInt(a.minLandscapeWidth,10);return h.$(l).width()>a&&h.$(l).width()>h.$(l).height()?gb.enums.ClientOrientation.LANDSCAPE:gb.enums.ClientOrientation.PORTRAIT},setDealViewHeightToOriginal:function(a,c){c="#"+gb.utils.getDealViewID(a,c);a=gb.widgets[a].skinDomElement.find(c);a.height("auto");c=a.find("."+gb.enums.dealViewClasses.FOOTER);0<c.length&&a.height(a.height()+c.height())},setDealViewHeightToDealRowHeight:function(a,c){c="#"+gb.utils.getDealViewID(a,
c);a=gb.widgets[a].skinDomElement.find(c);c=a.closest("."+gb.enums.WidgetViewIDs.CONTENTROW);a.height(c.height())},getCSStransitionTime:function(a){var c=a+"ms ease-in-out";0===a&&(c="");return{"-webkit-transition":c,"-moz-transition":c,"-o-transition":c,transition:c}},getCSStransformDistance:function(a,c){if(c===gb.enums.Constants.X_DIRECTION)a="translate3d("+a+"px,0px,0px)";else if(c===gb.enums.Constants.Y_DIRECTION)a="translate3d(0px,"+a+"px,0px)";else return{};return{"-webkit-transform":a,"-moz-transform":a,
"-o-transform":a,transform:a}},convertToRequesterDomainUrl:function(a){return void 0===a||null===a?null:a.replace(/^https?:\/\/([a-z0-9\.\-]*\.)?amazon\.[a-z]{2,3}(\.[a-z]{2})?\//i,this._getProtocol()+"//"+this._getHost()+"/")},_getProtocol:function(){return l.location.protocol},_getHost:function(){return l.location.host},getDealsInternalUrl:function(a){var c;gb.resources.urls.deals_internal_website&&(c=gb.resources.urls.deals_internal_website+a);return c},getmarketingIDsToKeep:function(a){return b.filter(a[gb.enums.IncludedDealTargetsSupported.MARKETING_ID],
function(a){return!b.contains(gb.resources.whitelistedMarketingIDList,a)})},getPriceTextForBasisKind:function(a){var c=gb.resources.getString("gb-price");if(a){var d=!1,b=gb.resources.getCustomerData("realm");0<=[gb.enums.Realms.BR].indexOf(b)&&(d=!0);a===gb.enums.priceKind.LIST_PRICE?c=gb.resources.getString("gb-list"):a===gb.enums.priceKind.PRINT_LIST_PRICE&&d?c=gb.resources.getString("fiona_list_price_35050"):a===gb.enums.priceKind.DIGITAL_LIST_PRICE&&d&&(c=gb.resources.getString("fiona_digital_price_42515"))}return c},
reloadPage:function(a,c){c.isInstanceOfWidgetView(a)?gb.subnavController&&!gb.subnavController.isWidgetExistinCurrentPageRefreshList(a)||a.refreshWidget(!0):a.reload()},isLaunchCellPage:function(a){var c=!1,d=gb.controller.schedulingParams[a],b=gb.controller.widgetCurrentPage[a];a=gb.metadata.selectedDealsCount[a];var f=d.widgetTabConfig[d.widgetCurrentTab],f=f?f.launchCellIndex:0,d=d.pageSize;0<f&&0<d&&(c=a<b*d?!0:f>=(b-1)*d&&f<b*d?!0:!1);return c},isWatchedDealsTab:function(a){var c=!1,d=gb.controller.schedulingParams[a];
a=d.widgetCurrentTab;d=d.watchedDealsTab;null!==d&&a===d&&(c=!0);return c},getComputedDealWidthForFlexWidget:function(a,c){a=c?a-a%2:a;return(100-5*(a-1))/a},validateFetchParam:function(a,c){var d=gb.controller.schedulingParams[a],e=function(a){if(a){for(var c={};Math.floor(d.maxLimitDeals/a)*a!==d.maxLimitDeals;)++a;c.page=Math.ceil(d.maxLimitDeals/a);c.dealsPerPage=a;return c}};c=b.extend(c,function(b){var e={};e.page=b.page?b.page:d.page;e.dealsPerPage=d.pageSize;if(b.dealsPerPage){var f=Math.ceil(((e.page-
1)*d.pageSize+1)/b.dealsPerPage);if(!c.isLazyLoadPageCall)for(;gb.metadata.isCurrentWindowFull(a,f,c.dealsPerPage);)f++;e.page=f;e.dealsPerPage=b.dealsPerPage}return e}(c));if(d.maxLimitDeals){var f=b.compact(gb.metadata.sortedDealIDs[a]),f=f.indexOf(b.last(f))+1,k=(c.page-1)*c.dealsPerPage,f=f>k?f:k;c.dealsPerPage*c.page<d.maxLimitDeals?gb.widgets[a].isMaxDealLimitReached=!1:(f>=d.maxLimitDeals||gb.widgets[a].isMaxDealLimitReached?c.dealsPerPage=0:f+c.dealsPerPage>d.maxLimitDeals&&(e=e(d.maxLimitDeals-
f))&&(c=b.extend(c,e)),gb.widgets[a].isMaxDealLimitReached=!0)}return c},deduceAccessTypeInfoFromGetDealResponse:function(a,c,d){var b,f;f=a.accessBehavior.accesslogic[0][0];a=gb.enums.DealAccessTypes[f.type];a===gb.enums.DealAccessTypes.GIVEAWAY_DEAL?d?b=0:a=null:b=f.duration;c.dealState!==gb.enums.DealStates.AVAILABLE||a!==gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&a!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||0>=parseInt(c.msToStart,10)+parseInt(b,10)*gb.enums.Constants.MINUTE_IN_MILLIS&&(a=
null);return{accessType:a,accessTypeDuration:b}},mergeGiveawayWithGdmResponse:function(a,c,d,b,f){var k=d.giveawaySlots,m=c.length<k.length?c.length:k.length,g=f&&f.dealsPerPage?f.dealsPerPage:d.pageSize;f=((f&&f.page?f.page:d.page)-1)*g;if(!this._checkFiltersApplied(b,d))for(b=f+g,g=0;g<m;g++)d=f<a.sortedDealIDs.length,!1===d?d=k[g]>=f&&k[g]<b:f=0,d&&k[g]-f<a.sortedDealIDs.length&&(a.sortedDealIDs.splice(k[g]-f,0,c[g]),a.selectedDealsCount++)},_checkFiltersApplied:function(a,c){a=gb.widgets[a];a=
gb.filterControllerFactory.getFilterController(a.widgetName).models[a.widgetGroupID];var d=c.campaignSchedulingParams,e=!1;b.each(a._selectedFilterValues,function(a,k){if(k===gb.enums.DCSQueryParams.PAGE){if(1!==a&&!0===c.fetchSinglePage)return e=!0,!1}else if(k===gb.enums.DCSQueryParams.DEAL_STATE)b.each(d[k],function(c){if(!b.contains(a,gb.enums.DealStatesToFilterStates[c]))return e=!0,!1});else if(!b.isEqual(d[k],a))return e=!0,!1});return e},_shouldShowPercentClaimed:function(a,c){var d=gb.resources.getFeature("scarcity_messaging"),
b=gb.enums.Weblabs.TREATMENTS,f=!0;c.enableHidingClaimedBar&&(b.T1===d&&30>a||b.T2===d&&80>a||b.T3===d)&&(f=!1);return f},_isAGSMerchant:function(a){return Object.keys(gb.enums.AGSMerchantsID).some(function(c){return gb.enums.AGSMerchantsID[c]===a})},shouldDisplayIFDMessage:function(a){var c=gb.resources.getFeature("gb_ifd_message"),d=gb.resources.getFeature("gb_ifd_message_ags_in"),b=!1;a&&a.merchantID&&this._isAGSMerchant(a.merchantID)&&(b=c===gb.enums.Weblabs.TREATMENTS.T1||d===gb.enums.Weblabs.TREATMENTS.T1);
return b},getDealViewStyleInformation:function(a,c,d){var b={},f=gb.resources.getFeature("scarcity_messaging"),k=a.dealType===gb.enums.DealTypes.LD,f=null!==f&&f!==gb.enums.Weblabs.TREATMENTS.C;a=a.dealState===gb.enums.DealStates.SOLDOUT||a.dealState===gb.enums.DealStates.EXPIRED;c=c.timerPrefix===gb.resources.getString("gb_ends_in");var m=this.isTablet(gb.clientName),g=gb.clientName===gb.enums.MobileClients.AW&&gb.resources.deviceInfo.isPhone;b.shouldStyleTimerMessaging=!1;b.shouldStyleScarcityMessaging=
!1;d.enableTimerStyling&&(b.shouldStyleTimerMessaging=k&&!m&&!g&&f&&!a&&c);d.enableClaimedStyling&&(b.shouldStyleScarcityMessaging=k&&!m&&!g&&f&&!a);return b},encodeSpaces:function(a){return a.replace(/ /g,encodeURIComponent(" "))},generateInterestRedirectLink:function(a,c,d){a=gb.filterUtils.setUrlFilterParam(a,gb.enums.DCSQueryParams.INTERESTS,c.value,"gb_f_"+d);d="gb_ttl_"+d;c=gb.resources.getString("gb_interest_title",{title:c.title});return a=this.setUrlParam(a,d,encodeURIComponent(encodeURIComponent(c)))},
fetchFaceoutConfigFromWhitelistedInterests:function(a,c,d){var e=[],f=gb.resources.getInterests(),k=gb.configManager.getDealViewConfig(a),m=this;c.showAllDealsFaceout&&(a={title:gb.resources.getString("gb_all_interest_title"),imageURL:m.resizeImage(gb.resources.getImage("all_interest"),k.imageSize)},c.redirectLink&&(a.redirectLink=c.redirectLink),e.push(a));b.isEmpty(f)||b.each(f,function(a){if(d.binning[gb.enums.BinNames.INTERESTS]&&d.binning[gb.enums.BinNames.INTERESTS][a.value]){if(c.redirectLink){var f=
m.generateInterestRedirectLink(c.redirectLink,a,c.widgetGroupID);b.extend(a,{redirectLink:f})}a.imageURL=m.resizeImage(a.imageURL,k.imageSize);e.push(a)}});return e},isWatchButtonEnabled:function(a,c){var d=!0,b=gb.resources.getFeature("gb_watching_button_state");if(b===gb.enums.Weblabs.TREATMENTS.T1||b===gb.enums.Weblabs.TREATMENTS.T2)b=new Date,c=gb.controller.schedulingParams[c].disableWatchingBufferMillis,gb.resources.customerData.hasEarlyAccessBenefit?a.status.dates.start.getTime()-b.getTime()<=
c&&(d=!1):a.status.dates.startForNonPrimeCustomer.getTime()-b.getTime()<=c&&(d=!1);return d}}});n.when("A").register("gb-prime-utils",function(h){return{prime:{iconStyleByRealm:{FR:"premium",ES:"premium",JP:"prime-jp",DEFAULT:"prime"},realmsWithLogoOnRight:["IT"]},getPrimeIconType:function(){var h=gb.resources.customerData.realm;return this.prime.iconStyleByRealm[h]?this.prime.iconStyleByRealm[h]:this.prime.iconStyleByRealm.DEFAULT},getPrimeLogoPosition:function(){return-1!==this.prime.realmsWithLogoOnRight.indexOf(gb.resources.customerData.realm)?
gb.enums.primeIconPositions.RIGHT:gb.enums.primeIconPositions.LEFT}}});n.when("A","gb-resources").register("gb-badge-utils",function(h,l){return{generateBadgeProperties:function(g){var b,a=g.deal.dealType;g=g.deal.detail.accessType;var c,d,e;g?(d=gb.resources.getFeature("prime_day_badging_2016"),null===d&&(d=0),gb.resources.deviceInfo.isPhone?c=gb.enums.Platforms.PHONE:gb.utils.isTablet(gb.clientName)?c=gb.enums.Platforms.TAB:gb.clientName===gb.enums.Platforms.PC&&(c=gb.enums.Platforms.PC),e=gb.configManager.getBadgeConfig(),
(a=e.accessTypeBadge[g])&&a[c]&&((b=a[c][d])&&g===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&void 0!==e.accessTypeBadge.Overrides[g][gb.resources.customerData.realm]&&(b=e.accessTypeBadge.Overrides[g][gb.resources.customerData.realm][c][d]),b&&(b.primeBadgingWeblab=d))):(e=gb.configManager.getBadgeConfig(),(b=e.dealTypeBadge[a])&&void 0!==e.dealTypeBadge.Overrides[a][gb.resources.customerData.realm]&&(b=e.dealTypeBadge.Overrides[a][gb.resources.customerData.realm]));return b}}});n.when("A","GoldboxMobile3PAssets").register("gb-metrics",
function(h,l){var g=l._;return h.createClass({widgetMetricsParams:{},widgetRefTags:{"GB-M-FACEOUT":"gbmp","GB-M-GRID-HERO":"gbmg","GB-M-HERO":"gbmh","GB-M-HERO-CN":"cnm_ldw_card_atc","GB-M-LIST-HERO":"gbml","GB-M-SUPPLE":"gbms","GB-M-SUBNAV":"gbmu","GB-TAB-FACEOUT":"gbtp","GB-TAB-HERO":"gbth","GB-TAB-GRID-HERO":"gbtg","GB-TAB-SUPPLE":"gbts","GB-FILTER-HERO":"gbpf","GB-GRID-HERO":"gbpg","GB-PC-FACEOUT":"gbpp","GB-SUPPLE":"gbps","GB-SHOVELER":"gbph"},refTags:{addToCart:"atc",adSlot:"ads",app:"app",
clearFilter:"fcr",dpLink:"dpl",filter:"ftr",getWatchedDeals:"gwd",giveawayDesktop:"gva",giveawayMobile:"gvm",helpLink:"hlp",image:"img",interest:"itr",joinWaitlist:"jwl",miniDpPopOver:"mdp",mobile:"mob",recLearnMore:"rlm",restrictionsApply:"rsa",reviews:"rvw",seeAllDeals:"sad",seeAllLocalDeals:"sal",subnavTabRefresh:"str",swipe:"swp",tab:"tab",title:"tit",unrecLearnMore:"ulm",unWatchDeal:"uwd",watchDeal:"wtd"},adRowRefTags:{rowNumber:"r"},init:function(){this.reverseMapAmabotParams=g.invert(this.amabotParams)},
amabotParams:{pf_rd_p:"placementID",pf_rd_s:"slotName",pf_rd_t:"pageType",pf_rd_i:"pageIndent",pf_rd_m:"merchantID",pf_rd_r:"requestID"},registerWidgetMetricParams:function(b,a){a=h.$("#"+a+"-amabot").html().split("?");if(1<a.length){a=a[1].split("\x26amp;");for(var c,d={},e=0;e<a.length;e++)c=a[e].split("\x3d"),1>=c.length||!this.amabotParams[c[0]]||(d[this.amabotParams[c[0]]]=h.$.trim(c[1]));this.widgetMetricsParams[b]=d}},_addAmabotClickParameters:function(b,a){b&&a&&g.each(this.amabotParams,function(c){a[c]&&
(b=gb.utils.setUrlParam(b,this.reverseMapAmabotParams[c],a[c]))},this);return b},addMetricsParams:function(b,a,c,d){if(!b)return"";if(!g.isEmpty(gb.widgets[a])){if(gb.resources.urls.deals_internal_website)return b;var e=this.widgetMetricsParams[a]||{};a=this.creatRefTag(a,c,d,e);gb.resources.deviceInfo.isWindowsPhone||(b=this._addRefTag(b,a),b=this._addAmabotClickParameters(b,e));return b}},creatRefTag:function(b,a,c,d){b=this.widgetRefTags[gb.widgets[b].widgetName]||"--";a=a||"---";var e=this._getSlotRefTag(d);
d=this._getPlacementID(d);c=g.map(c,function(a){return((a||"")+"").replace(/[_ ]/g,"")});c=g.filter(c,function(a){return!!a});c=g.map(c,function(a){return a.substring(0,8)}).join("_");return[b,a,e,d,c].join("_")},partiallyAppliedReffedURLFunction:function(b){var a=this;return function(c,d){return a.addMetricsParams(c,b.widgetID,d,b.data)}},_getSlotRefTag:function(b){if(!b||!b.slotName)return"";b=b.slotName;return 4>b.length?b:b.substring(0,1)+b.substring(b.length-2,b.length)},_getPlacementID:function(b){return b&&
b.placementID?g.last(b.placementID,4).join(""):""},_addRefTag:function(b,a){var c,d;c=b.indexOf("#");-1===c?d="":(d=b.substring(c),b=b.substring(0,c));var e=b.indexOf("?");-1===e?c="":(c=b.substring(e),b=b.substring(0,e));"/"===b[b.length-1]&&(b=b.substring(0,b.length-1));b=b.split("/");0===g.last(b).indexOf("ref\x3d")&&(b=g.initial(b));a=a.replace(/%/g,"");c=gb.utils.clearUrlParam(c,"ref_");b.push("ref\x3d"+a);return b.join("/")+c+d},generateRef:function(b,a,c){return this.creatRefTag(b,a,c,this.widgetMetricsParams[b]||
{})},recordRefViaAjax:function(b){b&&h.$.ajax({type:"POST",url:"/gp/deal/ajax/record-ref.html/ref\x3d"+b,aysnc:!0})},getReftagFromUrl:function(b){var a="";b=(b||"").split("/");b=(g.last(b)||"").split("?")[0];0===b.indexOf("ref")&&(a=b.split("\x3d")[1]||"");return a}})});n.when("A","GoldboxMobile3PAssets").register("gb-link-generator",function(h,l){var g=l._;return h.createClass({redirectionLink:null,init:function(b){this.redirectionLink=this._populateRedirectionBaseUrl(b)},_populateRedirectionBaseUrl:function(b){var a;
"pc"===b&&(a=gb.resources.getString("gb_app_all_deals_url"),a=a.trim());return a=a||gb.enums.RedirectionLinks[b].ALL_DEALS},generateRedirectLink:function(b,a){var c=this;if(!g.isEmpty(b.dealDisplay)){var d=[];g.map(b.dealDisplay,function(a){d.push(g.keys(a))});b.dealTypes=d}var e,f={brands:"gb_bnd",dealGroups:"gb_dgp",dealStates:"gb_dst",dealTypes:"gb_dtp",enforcedCategories:"gb_cat",enforcedDealIDs:"gb_edi",enforcedMerchantIDs:"gb_emi",excludedCategories:"gb_exc",excludedDealIDs:"gb_exd",excludedExtendedFilters:"gb_exf",
exclusiveTargetKeys:"gb_exk",exclusiveTargetValues:"gb_exv",expiringWithin:"gb_exp",extendedFilters:"gb_ext",fromTime:"gb_frt",freeShippingEligibleOnly:"gb_fso",globalEligibleOnly:"gb_geo",inclusiveTargetKeys:"gb_tgk",inclusiveTargetValues:"gb_tgv",minRating:"gb_mnr",primeEligibleOnly:"gb_peo",prioritizedDealIDs:"gb_pdi",redirectPageTitle:"gb_ttl",sortOrder:"gb_srt",toTime:"gb_tot"};g.each(f,function(d,m){if(a!==gb.enums.Constants.PAGINATED_METADATA_VERSION||d!==f.dealGroups)if(e=b[m],!g.isEmpty(e)){switch(d){case f.exclusiveTargetValues:case f.inclusiveTargetValues:var q=
"";g.each(e,function(a){q+="["+a.join()+"],"});e=q.slice(0,-1);break;case f.extendedFilters:case f.excludedExtendedFilters:e=JSON.stringify(e);break;default:"string"!==typeof e&&(e=e.join())}c.redirectionLink=gb.utils.setUrlParam(c.redirectionLink,d,encodeURIComponent(e))}},a);return c.redirectionLink}})});n.when("A","GoldboxMobile3PAssets").register("gb-metrics-manager",function(h,r){var g=r._;return h.createClass({asinImpressionsHash:{},ClientActions:{ADD_TO_CART:"A",JOIN_WAITLIST:"J",WATCH_DEAL:"W",
SEE_MORE:"M",TITLE:"T",REVIEWS:"R",SHARE_DEAL:"S",IMAGE:"I",DEAL_CLICK:"D",LEARN_MORE:"L",TRY_PRIME:"P",GC_RENDER:"G"},cdsCallIntervalRef:null,cdsPollInterval:3E5,init:function(){var b=this;h.$(l).unload(function(){l.clearInterval(b.cdsCallIntervalRef);b.cdsCallIntervalRef=null;b.reportImpression()});b.cdsCallIntervalRef=l.setInterval(function(){b.reportImpression()},b.cdsPollInterval)},recordRender:function(b,a,c){if(!b||!a)return null;c=this.getMetricsLogPosition(b,a,c);if(!c)return null;this.asinImpressionsHash[b]||
(this.asinImpressionsHash[b]={});this.asinImpressionsHash[b][a]||(this.asinImpressionsHash[b][a]={});this.asinImpressionsHash[b][a][c]||(this.asinImpressionsHash[b][a][c]={});return c},recordAction:function(b,a,c,d){b&&a&&c&&g.contains(g.keys(this.ClientActions),c)&&(d=this.recordRender(b,a,d))&&(this.asinImpressionsHash[b][a][d][this.ClientActions[c]]||(this.asinImpressionsHash[b][a][d][this.ClientActions[c]]=0),this.asinImpressionsHash[b][a][d][this.ClientActions[c]]++)},reportImpression:function(){var b=
this,a={};g.each(this.asinImpressionsHash,function(c,d){if(d=b.getImpressionRef(d)){var e=[];g.each(c,function(a,c){var d=gb.controller.getDealDAO(c);if(d){var b=d.detail.impressionAsin;if(b){var h=[b,c];gb.utils.isDealActionable(c)&&h.push("Y");c=d.status.percentClaimed;g.isNumber(c)&&0<c&&h.push(c);g.each(a,function(a,c){h.push(c);var d=[];g.each(a,function(a,c){d.push(c,a)});d.length&&h.push(d.join(""))});e.push(h.join("-"))}}});e.length&&(a[d]=e.join())}});this.splitCallClickStream(a);this.asinImpressionsHash=
{}},splitCallClickStream:function(b){if(!g.isEmpty(b)){var a=gb.utils.setUrlParam(gb.enums.AJAXLinks.CDS,"sID",gb.resources.getCustomerData("sessionId")),a=gb.utils.setUrlParam(a,"oID",gb.controller.contentMetadata.originRID),c=JSON.stringify(b),a=gb.utils.setUrlParam(a,"imp",c),a=l.encodeURI(a);if(2E3>=a.length)gb.utils.callAsyncAjax(a);else if(a=g.keys(b),a.length){var d={},e={};if(1===a.length){var f=b[a[0]].split(",");if(1>=f.length)return;c=f.slice(0,Math.ceil(f.length/2));f=f.slice(Math.ceil(f.length/
2),f.length);d[a[0]]=c.join();e[a[0]]=f.join()}else c=a.slice(0,Math.ceil(a.length/2)),a=a.slice(Math.ceil(a.length/2),a.length),g.each(c,function(a){d[a]=b[a]}),g.each(a,function(a){e[a]=b[a]});this.splitCallClickStream(d);this.splitCallClickStream(e)}}},getImpressionRef:function(b){if(b){var a=gb.configManager.getWidgetViewConfig(b).clickStreamRefMarker,c=gb.metrics.widgetMetricsParams[b],a=[a,c.slotName,c.placementID];gb.controller.schedulingParams[b].enforceLimitedDeals&&a.push("Y");return a.join(".")}},
getMetricsLogPosition:function(b,a,c){if(!(b&&a&&gb.widgets[b]&&gb.widgets[b].dealViews[a]))return null;var d=gb.widgets[b];a=d.dealViews[a][c];c=gb.controller.widgetCurrentPage[b]-1;var e=a.position,d=d.dealsPerRow,f=0,k=e;void 0!==a.row&&void 0!==a.column?(f=a.row,k=a.column):gb.controller.schedulingParams[b].enforceLimitedDeals||(f=Math.floor(e/d),k=e%d);if(gb.controller.schedulingParams[b].enforceLimitedDeals||!gb.controller.schedulingParams[b].enablePagination)c=0;b=[f,k,c];!0===a.isDoubleCell&&
b.push("Y");return b.join(".")}})});n.when("A","GoldboxMobile3PAssets").register("gb-widget-clientside-helper",function(h,l){var g=l._;return h.createClass({callBins:{},callDataArray:{},callID:{},previousDeficit:{},allDealsFetched:{},shouldReduceDeals:{},registerWidgetData:function(b,a){this.callBins[b]=[];this.callID[b]=0;this.allDealsFetched[b]=!1;this.previousDeficit[b]=0;this.shouldReduceDeals[b]=!0;var c=gb.widgets[b],d=gb.controller.schedulingParams[b],e=gb.configManager.getWidgetViewConfig(b),
f=d.dealDisplay;if(g.isEmpty(f))if(f=e.defaultNumberOfRows,d.dealTypes){var k=d.dealTypes.join(","),m={};m[k]={rows:f};f=[m]}else f=[{"":{rows:f}}];else k=f[f.length-1],m=g.keys(k),k=k[m[0]],k.deals?this.shouldReduceDeals[b]=!1:k.rows&&(this.shouldReduceDeals[b]=!0);d.dealDisplay=f;c=c.dealsPerRow;e=this.callDataArray[b]=(0,this[e.callDataBuilder])(f,c);!g.isEmpty(d.dealGroups)&&d.enforceLimitedDeals?this.previousDeficit[b]=this.calculatePreviousDeficit(a.sortedDealIDs,c,d.showDoubleCellDOTD):d.isCritical||
(f=e[0].dealsPerPage,this.callID[b]++,d.enforceLimitedDeals?(e=e[0].scheduledDealData,!g.isEmpty(a)&&e.rows&&e.rows&&(a.sortedDealIDs=this.filterDisplayableDealsArray(a.sortedDealIDs,e.rows*c,d.showDoubleCellDOTD)),this.previousDeficit[b]=this.calculatePreviousDeficit(a.sortedDealIDs,c,d.showDoubleCellDOTD)):d.fetchSinglePage||(d.pageSize=f))},getGBSuppleCallDataArray:function(b,a){var c=[],d=!0;g.each(b,function(b){g.each(b,function(b,e){var m={};m.dealTypes=e&&"ALL"!==e?e.split(","):[];b.deals?
m.dealsPerPage=b.deals:b.rows&&(m.dealsPerPage=b.rows*a,d||(m.dealsPerPage+=a));m.dealStates=[];b.dealStates&&(m.dealStates=b.dealStates.split(","));m.scheduledDealData=b;m.dealsPerPage&&(c.push(m),d=!1)})});return c},fetchCallDataArrayDeals:function(b){var a=this.callID[b],c=this.callDataArray[b];if(c.length>a){var d=gb.controller.schedulingParams[b],e=c[a];d.page=1;d.pageSize=e.dealsPerPage;d.dealTypes=e.dealTypes;d.dealStatesDD=e.dealStates;d={metaParams:{}};d.metaParams.callDataArray=c;d.metaParams.callID=
a;gb.service.fetchDealWithData(b,d,gb.controller.updatePage)}else this.allDealsFetched[b]=!0,"function"===typeof gb.widgets[b].renderLaunchCell&&gb.widgets[b].renderLaunchCell()},buildSortedDealsArray:function(b,a){var c=gb.widgetHelper.callID[b],d=this.callBins[b][c],e=gb.metadata.sortedDealIDs[b],f=this.callDataArray[b][c].scheduledDealData,c=gb.controller.schedulingParams[b];if(f.rows){var k=d.length;c.showDoubleCellDOTD&&(k=k+g.intersection(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],d).length+
g.intersection(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],d).length);f=f.rows*a;f+=this.previousDeficit[b];d=this.filterDisplayableDealsArray(d,k>=f?f:k,c.showDoubleCellDOTD)}e=g.union(e,d);this.previousDeficit[b]=this.calculatePreviousDeficit(e,a,c.showDoubleCellDOTD);return e},filterDisplayableDealsArray:function(b,a,c){var d=[];g.each(b,function(b){if(0<a){var f=c?g.contains(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],b)||g.contains(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],
b):!1;1===a&&f||(d.push(b),f?a-=2:a--)}else return!1});return d},calculatePreviousDeficit:function(b,a,c){var d=0;c=c?gb.metadata.getDOTDCount(b):0;b=b.length+c;0!==b%a&&(d=a-b%a);return d}})});n.when("A","GoldboxMobile3PAssets","gb-metrics","gb-enums").register("gb-filter-metrics",function(h,l,g,b){var a=l._;return g.extend({_filterRefTags:{CATEGORIES:"wht",DEAL_STATE:"dls",DEAL_TYPE:"dlt",DISCOUNT:"dct",PRICE:"prc",REVIEW_RATING:"acr",PAGE:"page",PRIME_ELIGIBLE_ONLY:"prm",PRIME_ACCESS_TYPE:"dlt",
SORT_ORDER:"sort",INTERESTS:"int",ENFORCED_CATEGORIES:"enf"},_filterAttrToHandlers:{CATEGORIES:"_getCategoriesMetric",DEAL_STATE:"_getDealStateMetric",DEAL_TYPE:"_getDealTypeMetric",DISCOUNT:"_getDiscountMetric",PRICE:"_getPriceMetric",REVIEW_RATING:"_getReviewRatingMetric",PAGE:"_getPageMetric",PRIME_ELIGIBLE_ONLY:"_getPrimeEligibleMetric",PRIME_ACCESS_TYPE:"_getDealTypeMetric",SORT_ORDER:"_getSortOrderMetric",INTERESTS:"_getInterestsMetric",ENFORCED_CATEGORIES:"_getEnforcedCategories"},_dealStateRefTags:{ACTIVE:"ACTV",
MISSED:"MISD",UPCOMING:"UPCM"},_dealTypeRefTags:{BEST_DEAL:"BD",COUPON_DEAL:"CPN",DEAL_OF_THE_DAY:"DOTD",LIGHTNING_DEAL:"LD",PRIME_EARLY_ACCESS:"PEA"},_sortOrderRefTags:{BY_BEST_SELLING:"BSEL",BY_DISCOUNT_ASCENDING:"DCTA",BY_DISCOUNT_DESCENDING:"DCTD",BY_PRICE_ASCENDING:"PRCA",BY_PRICE_DESCENDING:"PRCD",BY_RELEVANCE:"FEAT",BY_SCORE:"RELV",BY_START_TIME:"STRT"},_primeEligibleRefTag:{ISPM:"ISPM"},init:function(){this._super();var c=this;this._binningParamsWithHandlersToAttr={};a.each(a.keys(this._filterAttrToHandlers),
function(a){c._binningParamsWithHandlersToAttr[b.BinningParams[a].key]=a});this._getCategoriesMetric=a.wrap(void 0,this._metricsChangeWrapper);this._getDealStateMetric=a.wrap(this._transformDealStateValue,this._metricsChangeWrapper);this._getDealTypeMetric=a.wrap(this._transformDealTypeValue,this._metricsChangeWrapper);this._getDiscountMetric=a.wrap(this._transformDiscountValue,this._metricsChangeWrapper);this._getPriceMetric=a.wrap(void 0,this._metricsChangeWrapper);this._getReviewRatingMetric=a.wrap(void 0,
this._metricsChangeWrapper);this._getPageMetric=a.wrap(void 0,this._metricsChangeWrapper);this._getPrimeEligibleMetric=a.wrap(this._transformPrimeEligibleValue,this._metricsChangeWrapper);this._getSortOrderMetric=a.wrap(this._transformSortOrderValue,this._metricsChangeWrapper);this._getInterestsMetric=a.wrap(void 0,this._metricsChangeWrapper);this._getEnforcedCategories=a.wrap(void 0,this._metricsChangeWrapper)},appendFilterMetricParams:function(a,d,b,f){return f instanceof Array&&3===f.length?(f=
this._getFilterMetricData(f),this.addMetricsParams(a,d,b,f)):a},_getFilterMetricData:function(a){var d=this._binningParamsWithHandlersToAttr[a[1]];if(d)return this[this._filterAttrToHandlers[d]](a,d);d=a[1];a[0]&&d&&a.shift();return a},_metricsChangeWrapper:function(c){var d=a.tail(arguments),b=d[0],f=b[1],b=b[2],d=d[1];c&&(b=c.call(this,b));if(f&&b)return[this._filterRefTags[d],b]},_transformDealStateValue:function(c){if(c===parseInt(c,10)&&gb.widgets[c]&&gb.widgets[c].widgetName===b.WidgetNames.PC_SHOVELER){var d=
gb.controller.schedulingParams[c],d=d.widgetTabConfig[d.widgetCurrentTab].dealStates,d=a.flatten(d);a.contains(d,b.FilterStates.ACTIVE)?c=b.FilterStates.ACTIVE:a.contains(d,b.FilterStates.UPCOMING)?c=b.FilterStates.UPCOMING:a.contains(d,b.FilterStates.MISSED)&&(c=b.FilterStates.MISSED)}return this._dealStateRefTags[c]},_transformDealTypeValue:function(a){return this._dealTypeRefTags[a]},_transformDiscountValue:function(a){return a.substring(0,a.indexOf("-")+1)},_transformPrimeEligibleValue:function(a){return a?
this._primeEligibleRefTag.ISPM:""},_transformSortOrderValue:function(a){return this._sortOrderRefTags[a]}})});n.when("A").register("gb-config-manager",function(h){return{init:function(){this.dealViewConfigs={};this.widgetViewConfigs={};this.redirectURLConfigs={base64encodedUrls:["prime_signup_redirect","exclusive_access_prime_signup_redirect","exclusive_dotd_prime_signup_redirect","exclusive_bd_prime_signup_redirect"],encodedURIComponents:["watching_login_redirect"]};this.badgeConfig={};this.badgeConfig.accessTypeBadge=
{PRIME_EARLY_ACCESS:{phone:{0:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal Badge274",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},1:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal solidTransparentBadge",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},2:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal solidTransparentBadge",skewElmStyleRule:"primeSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},
1:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},2:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"}},tablet:{0:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},1:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},2:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"}}},PRIME_ONLY_DOTD:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],
badgeStyleRule:"DOTD Badge162",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},
2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},PRIME_ONLY_LD:{phone:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeDeal Badge234",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},
1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge largeTextPrimeBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge largeTextPrimeBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeBadge poBadge"},1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"},
2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"}},tablet:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeBadge poBadge"},1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"}}},PRIME_ONLY_BD:{phone:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],
badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0}},pc:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},APP_EARLY_ACCESS:{phone:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0},1:{tagList:["gb_app_early_access_caps"],
badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0},2:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},1:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},2:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"}},tablet:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},
1:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},2:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"}}},APP_ONLY_LD:{phone:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",isPrimeBadge:!0},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",isPrimeBadge:!0},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",
isPrimeBadge:!0}},pc:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"}},tablet:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"}}}};this.badgeConfig.dealTypeBadge=
{DEAL_OF_THE_DAY:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge160",skewElmStyleRule:"DOTDSlide"}};this.badgeConfig.accessTypeBadge.Overrides={PRIME_ONLY_DOTD:{IT:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",
skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},
2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},BR:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},
pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}}}};
this.badgeConfig.dealTypeBadge.Overrides={DEAL_OF_THE_DAY:{IT:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"DOTDSlide"},BR:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"DOTDSlide"}}};return this},registerConfigs:function(h){this.registerDealViewConfigs(h.widgetName,h.dealViewConfig);this.registerWidgetViewConfigs(h.widgetName,h.widgetViewConfig)},registerDealViewConfigs:function(h,g){this.dealViewConfigs[h]=this.dealViewConfigs[h]||
g},registerWidgetViewConfigs:function(h,g){this.widgetViewConfigs[h]=this.widgetViewConfigs[h]||g},getDealViewConfig:function(h){return(h=gb.controller.widgetName[h])?this.dealViewConfigs[h]||null:null},getWidgetViewConfig:function(h){return(h=gb.controller.widgetName[h])?this.widgetViewConfigs[h]||null:null},getBadgeConfig:function(){return this.badgeConfig}}.init()});n.when("A","GoldboxMobile3PAssets").register("gb-template-manager",function(h,l){var g=l._;return{templates:{},TemplateGroups:{DEAL_SHARE:"dealShare",
DEAL_STATE:"dealState",DEAL_VIEW:"dealView",FILTER_VIEW:"filterView",MINI_DP_DEAL_STATE:"miniDPDealState",MINI_DP_DEAL_VIEW:"miniDPDealView",WIDGET_VIEW:"widgetView"},templateSettings:{evaluate:/<~([\s\S]+?)~>/g,interpolate:/\{\{([\s\S]+?)\}\}/g,escape:/~\{\{([\s\S]+?)\}\}/g},registerTemplates:function(b,a){if(!this.templates[b]){this.templates[b]={};var c=this,d={};a&&g.each(g.values(this.TemplateGroups),function(b){a[b]&&(d[b]=c._fetchTemplates(a[b]))});g.isEmpty(d)||(this.templates[b]=d)}},_fetchTemplates:function(b){var a=
{},c=this;g.each(b,function(d){a[d.name]=g.template(d.template,!1,c.templateSettings)});return g.isEmpty(a)?null:a},hasTemplate:function(b){var a=b.widgetID,c=b.templateGroup;b=b.templateName;if(!a||!c||null===b||""===b)return!1;a=gb.controller.widgetName[a];if(!a||!g.contains(g.values(this.TemplateGroups),c))return!1;c=[a,c];void 0!==b&&c.push(b);return gb.utils.areNestedKeysPresent(this.templates,c.join("."))?!0:!1},getWidgetHTML:function(b){var a=b.widgetID,c=b.templateGroup,d=b.templateName,e=
b.templateNames,f=b.data;if(!this.hasTemplate({widgetID:a,templateGroup:c,templateName:d}))return"";b=gb.controller.widgetName[a];if(d)return this.generateTemplate(this.templates[b][c][d],f);g.isArray(e)||(e=g.keys(this.templates[b][c]));var k={},m=this;g.each(e,function(d){k[d]=m.getWidgetHTML({widgetID:a,templateGroup:c,templateName:d,data:f})});return k},generateTemplate:function(b,a){return b?g.isFunction(b)?b({data:a||{}}):g.isString(b)?g.template(b,{data:a||{}},this.templateSettings):"":""}}});
n.when("A","gb-event-emitter").register("gb-deal-dao",function(h,l){return l.extend({init:function(g){this._super();this.dealID=g;this.dealType=this.offerID=this.legacyDealID=null;this.dealState=gb.enums.DealStates.LOADING;this.checkingDealStatus=!1;this.merchantID=null;this.processWatchAction=this.isDealWatched=this.isDigital=!1;this.customerState=null;this.detail={title:null,imageAsin:null,URL:null,itemType:null,buyAsin:null,impressionAsin:null,marketingMessage:null,isPrimeOnly:null,isPrimeEarlyAccessDeal:null,
isGiveawayDeal:null,isFulfilledByAmazon:null,accessType:null,accessDurationInMs:null,isAppDeal:!1,giveawayValue:null};this.reviews={URL:null,total:null,rating:null};this.teaser={teaserLine:null,teaserImage:null,teaserURL:null};this.auxiliaryData={breaksMAP:null,isPrimeEligible:null};this.pricingData={prices:{dealPrice:null,basisPrice:null},percentOff:null,bKind:null,unitPrice:null,baseUnit:null};this.status={percentClaimed:null,isValidDeal:1,dates:{end:null,start:null,incartEnds:null,cacheExpires:null,
startForNonPrimeCustomer:null,pendingATCEnds:null},timeouts:{end:null,start:null,incartEnds:null,cacheExpires:null,earlyAccessExpires:null,pendingATCEnds:null},cache:{lastMsCacheTtl:null}};this.couponCounts={total:null};this.extendedAttributes={hideAddToCart:!1};this.registerConnections();this.items={};this.selectorData={}},registerConnections:function(){this.on("RefreshView",this.changeView);this.on("RefreshMiniDetailPageView",this.changeMiniDetailPageView)},calculatePercentOff:function(){var g=
this.pricingData.prices.dealPrice,b=this.pricingData.prices.basisPrice;g&&b&&g.max.value===g.min.value&&b.max.value===b.min.value&&(this.pricingData.percentOff=gb.utils.calculatePercentOff(b.max.value,g.max.value))},changeView:function(){gb.controller.refreshDealView(this.dealID)},changeMiniDetailPageView:function(){gb.controller.refreshMiniDetailPageView(this.dealID)},getAsinDAO:function(g){return this.items[g]},getVariationAsin:function(g){var b=null;h.each(this.items,function(a){h.equals(a.variationDimensions,
g)&&(b=a)});return b}})});n.when("A").register("gb-deal-asin-dao",function(h){return h.createClass({init:function(h){if(!h.itemID)throw Error("Cannot create a GBDealAsinDAO object with undefined asin");this.asinID=h.itemID;this.dealID=h.dealID;this.parentDealDAO=null;h.parentItemID&&(this.parentDealDAO=gb.controller.getDealDAO(h.parentItemID));this.marketplaceID=gb.resources.customerData.marketplaceId;this.dealPriceFormatted=gb.utils.getFormattedPrice(h.dealPrice);this.bKind=h.bKind;this.percentOff=
h.percentOff;this.basisPriceFormatted=gb.utils.getFormattedPrice(h.bAmount);this.imageURL=gb.baseUtils.checkAndSetSSLImageUrl(h.primaryImage);this.status={itemState:null,customerState:null,percentClaimed:null,dates:{incartEnds:null,pendingATCEnds:null},timeouts:{incartEnds:null,pendingATCEnds:null}};this.variationDimensions=h.variationDimensions;this.auxiliaryData={isPrimeEligible:h.isPrimeEligible,breaksMAP:null,merchantDetails:{merchantID:h.merchantID,merchantName:h.merchantName}}}})});n.when("A",
"GoldboxMobile3PAssets").register("gb-filter-model",function(h,r){var g=r._;return h.createClass({init:function(b){this.widgetGroupID=b.widgetGroupID;this.widgetID=b.widgetID;this.widgetName=gb.widgets[this.widgetID].widgetName;this._selectedFilterValues={};this.availableFilterOptions={};this.hasPageChanged=!1;this.filterPlurals={};this.redirectURL=this.widgetGroupAnchor=null;this.doPageRefresh=!1;this.filterConfigValuesHash={};this.attributesList=[];this.attributesWithDisabledValues=[];this.selectedFiltersCount=
0;this.customFilter=null;this.targetedWidget={ID:0,title:null,savedTitle:null,clearTitle:!1};this.setFilterValue=g.wrap(this._setFilterValue,this._filterChangeWrapper);this.addFilterValue=g.wrap(this._addFilterValue,this._filterChangeWrapper);this.removeFilterValue=g.wrap(this._removeFilterValue,this._filterChangeWrapper);this.removeAllFilterValues=g.wrap(this._removeAllFilterValues,this._filterChangeWrapper)},setupWidgetFilterConnections:function(){var b=gb.controller.schedulingParams[this.widgetID].refreshWidgets;
if(b)for(var a in gb.widgets)if(gb.widgets[a].widgetName===b){this.targetedWidget.ID=a;break}},saveTargetedWidgetInfo:function(){gb.controller.schedulingParams[this.targetedWidget.ID]&&(-1===l.location.href.indexOf("gb_ttl_"+this.widgetGroupID)?this.targetedWidget.savedTitle=gb.controller.schedulingParams[this.targetedWidget.ID].title:this.targetedWidget.title=gb.controller.schedulingParams[this.targetedWidget.ID].title)},mergeFilters:function(b){var a=this;a.widgetGroupAnchor=b.schedulingParams.widgetAnchorName||
a.widgetGroupAnchor;b.schedulingParams.widgetCurrentTab&&(a._selectedFilterValues[gb.enums.WidgetConstants.CURRENT_TAB]=b.schedulingParams.widgetCurrentTab);g.each(gb.enums.DCSQueryParams,function(c){var e=b.schedulingParams[c];if(g.isArray(e)?!g.isEmpty(e):e)g.isArray(e)&&(e=g.clone(e)),c===gb.enums.DCSQueryParams.DEAL_STATE&&(e=g.map(e,function(a){return gb.enums.DealStatesToFilterStates[a]}),e=g.unique(e)),c===gb.enums.DCSQueryParams.PRICE_RANGE&&(c=gb.enums.BinningParams.PRICE.key),c===gb.enums.DCSQueryParams.DISCOUNT_RANGE&&
(c=gb.enums.BinningParams.DISCOUNT.key,e=e.join(",")),a._selectedFilterValues[c]=e});g.each(b.schedulingParams.extendedFilters,function(c,b){b===gb.enums.BinningParams.NEW_RELEASES.key&&(c=[1]);b===gb.enums.BinningParams.DISCOUNT.key&&(c=c.join(","));g.isArray(c)&&(c=g.clone(c));a._selectedFilterValues[b]=c});var c=b.schedulingParams.filterConfig;g.each(c,function(c){var b=g.map(c.attr.split(","),h.$.trim);g.each(b,function(f,k){if(c.plural){var m=g.map(c.plural.split(","),h.$.trim);a.filterPlurals[f]=
m[k]}if(c.values){k=1<b.length?c.values[k]:g.flatten(c.values,!0);m=a.getDCSQueryParamForBinningKey(f);a._selectedFilterValues[m]&&g.isEqual(a._selectedFilterValues[m],k)&&delete a._selectedFilterValues[m];if(f===gb.enums.BinningParams.DEAL_STATE.key){var q=[];g.each(k,function(a){q.push(gb.enums.FilterStatesToDealStates[a])});k=g.flatten(q,!0)}a.filterConfigValuesHash[f]=k}c.disableValues&&(a.attributesWithDisabledValues=g.union(a.attributesWithDisabledValues,f))})});a.customFilter=b.schedulingParams.customFilter;
a.attributesList=g.union(a.attributesList,gb.utils.getFilterAttributesList(c));a.populateAvailableFilters(b.dcsServerResponse.binning);gb.filterControllerFactory.getFilterController(this.widgetName).trigger("gbfilter:mergeFilters",this)},getDCSQueryParamForBinningKey:function(b){var a=gb.enums.BinningKeyToDCSQueryParamMap[b];if(!a||g.isArray(a))a=b;return a},getSelectedBinningValues:function(b){b=this.getDCSQueryParamForBinningKey(b);var a=this._selectedFilterValues[b];b===gb.enums.DCSQueryParams.ACCESS_TYPE&&
(a=this._transformAccessTypesToAnArray(a));return a},_transformAccessTypesToAnArray:function(b){var a=[];g.isArray(b)?g.each(b,function(c){c=g.isArray(c)?c.sort().join("__"):c;a.push(c)}):a.push(b);return a},getSelectedFilters:function(b,a){var c=this,d=g.map(c._selectedFilterValues,function(d,f){if(a&&!g.contains(a,f))return{};if(f!==gb.enums.DCSQueryParams.SORT_ORDER&&f!==gb.enums.DCSQueryParams.PAGE&&f!==gb.enums.DCSQueryParams.MIN_RATING)if(f===gb.enums.DCSQueryParams.PRIME_ELIGIBLE_ONLY||f===
gb.enums.DCSQueryParams.GLOBAL_ELIGIBLE_ONLY||f===gb.enums.DCSQueryParams.FREE_SHIPPING_ELIGIBLE_ONLY)d=!0;else if(f===gb.enums.DCSQueryParams.PRIME_ACCESS_TYPE)d=d.toString();else if(f===gb.enums.DCSQueryParams.ACCESS_TYPE)d=c._populateAccessTypesAsAnArray(d);else if(f===gb.enums.BinningParams.DISCOUNT.key)b||(f=gb.enums.DCSQueryParams.DISCOUNT_RANGE),d=d.split(",");else if(f===gb.enums.BinningParams.GIFT_WRAPPABLE.key||f===gb.enums.BinningParams.CASH_ON_DELIVERY.key||f===gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key)d=
d?["true"]:["false"];else{g.isArray(d)||(d=[d]);if(f===gb.enums.DCSQueryParams.DEAL_STATE){var k=[];g.each(d,function(a){k.push(gb.enums.FilterStatesToDealStates[a])});d=g.flatten(k,!0)}b||f!==gb.enums.BinningParams.PRICE.key||(f=gb.enums.DCSQueryParams.PRICE_RANGE)}return[f,d]});return g.object(d)},_populateAccessTypesAsAnArray:function(b){var a=[];g.isArray(b)?g.each(b,function(c){var d=c;g.isArray(c)||(d=[c]);a.push(d)}):a.push([b]);return a},populateAvailableFilters:function(b){var a=this;g.each(b,
function(c,d){g.isEmpty(c)?delete a.availableFilterOptions[d]:a.availableFilterOptions[d]=c});a.updateSelectedFiltersCount()},_setFilterValue:function(b,a){b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY?(a=a.toString(),this._removeFilterValue(b,void 0),this._addFilterValue(b,a)):this._selectedFilterValues[b]=a},_addFilterValue:function(b,a){this._selectedFilterValues[b]=this._selectedFilterValues[b]||[];if(b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||
b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY)a=a.toString();this._selectedFilterValues[b].push(a)},_removeFilterValue:function(b,a){var c=g.flatten([this._selectedFilterValues[b]],!0);this._selectedFilterValues[b]=g.without(c,a);if("undefined"===typeof a||!this._selectedFilterValues[b].length){a=b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY;var d;a&&(d=gb.utils.getmarketingIDsToKeep(this._selectedFilterValues));
a&&d.length?this._selectedFilterValues[b]=d:(this._selectedFilterValues[b]=null,delete this._selectedFilterValues[b])}},_filterChangeWrapper:function(b){var a=g.tail(arguments),c=this.getDCSQueryParamForBinningKey(a[0]),d=a[1],e=a[2],f=a[3],a=a[4];b.call(this,c,d);c===gb.enums.DCSQueryParams.PAGE&&(this.hasPageChanged=!0);g.isUndefined(e)||(g.isUndefined(d)?e.context=gb.metrics.refTags.clearFilter:e.data.push(d),gb.controller.schedulingParams[e.widgetID].refreshWidgets&&(this.targetedWidget.ID?e.widgetID=
this.targetedWidget.ID:f=!0));f||this.triggerChangeEvent(e,a)},_removeAllFilterValues:function(){var b=gb.enums.DCSQueryParams.SORT_ORDER,a=gb.utils.getmarketingIDsToKeep(this._selectedFilterValues);if(this.customFilter){var c=this.getDCSQueryParamForBinningKey(this.customFilter);this._selectedFilterValues=g.pick(this._selectedFilterValues,c,b)}else this._selectedFilterValues=g.pick(this._selectedFilterValues,b);0<a.length&&(this._selectedFilterValues[gb.enums.IncludedDealTargetsSupported.MARKETING_ID]=
a)},triggerChangeEvent:function(b,a){this.hasPageChanged||(this._selectedFilterValues[gb.enums.DCSQueryParams.PAGE]=1,gb.controller.widgetCurrentPage[b.widgetID]=1);b.eventID&&!gb.resources.deviceInfo.isPhone&&gb.resources.deviceInfo.isApp&&n.when("a-popover").execute(function(a){(a=a.get(gb.enums.WidgetViewIDs.REFINE_POPOVER_NAME))&&a.hide()});this.hasPageChanged=!1;gb.filterControllerFactory.getFilterController(this.widgetName).trigger("gbfilter:change",this,b,a)},updateSelectedFiltersCount:function(){var b=
this;b.selectedFiltersCount=0;g.each(b.attributesList,function(a){b.getSelectedBinningValues(a)&&b.selectedFiltersCount++})},getSelectedFilterCount:function(){return this.selectedFiltersCount}})});n.when("A","GoldboxMobile3PAssets","gb-filter-model").register("gb-shoveler-filter-model",function(h,l,g){var b=l._;return g.extend({init:function(a){this._super(a);this._initalizeFilterChangeHandlers();this._updateDealStates=b.wrap(this._updateDealStatesHandler,this._filterChangeWrapper)},_initalizeFilterChangeHandlers:b.once(function(){h.declarative("gbshovl-state",
"click",b.wrap(function(a,c){var d=gb.controller.schedulingParams[c.widgetID],b=gb.widgets[c.widgetID],f=d.widgetCurrentTab;a=parseInt(a.data.tabIndex,10);f!==a&&(b.isMaxDealLimitReached=!1,b.renderShovlButtonsContent(!0),b.skinDomElement.find("#"+gb.enums.WidgetViewIDs.SHOVL_PAGINATION).html(""),d.widgetCurrentTab=a,b.renderWireFrame(),gb.filterControllerFactory.getFilterController(b.widgetName).models[c.metrics.eventID]._updateDealStates(c.attribute,c.widgetID,c.metrics))},this._shovlFilterChangeWrapper));
h.declarative(gb.enums.WidgetActions.Shoveler.SHOVEL,"click",b.wrap(function(a,c){if(a.data.buttonStatus!==gb.enums.ShovlConstants.DISABLED){var d=gb.widgets[c.widgetID];d.renderShovlButtonsContent(!0);d.isLaunchCellPage=gb.utils.isLaunchCellPage(c.widgetID);var d=gb.controller.widgetCurrentPage[c.widgetID],b=a.data.actionType;b===gb.enums.ShovlConstants.SHOVL_NEXT?d++:b===gb.enums.ShovlConstants.SHOVL_PREVIOUS&&d--;a=parseInt(a.data.totalPages,10);1<=d&&d<=a&&(a=gb.filterControllerFactory.getFilterController(c.widgetName).models[c.metrics.eventID],
gb.controller.widgetCurrentPage[c.widgetID]=d,a.setFilterValue(c.attribute,d,c.metrics))}},this._shovlFilterChangeWrapper))}),_shovlFilterChangeWrapper:function(a){var c=b.tail(arguments)[0],d=parseInt(c.data.widgetID,10),e=c.data.attribute,f=gb.widgets[d].widgetGroupID;d&&f&&a.call(this,c,{attribute:e,metrics:{context:gb.metrics.refTags.filter,data:[f,e],eventID:f,widgetID:d},widgetID:d})},_updateDealStatesHandler:function(a,c){c=gb.controller.schedulingParams[c];var d=b.flatten(c.widgetTabConfig[c.widgetCurrentTab].dealStates);
this._selectedFilterValues[a]=b.clone(d);this._selectedFilterValues[gb.enums.ShovlConstants.SHOVL_STATE_TAB]=c.widgetCurrentTab}})});n.when("A","GoldboxMobile3PAssets","gb-filter-model","gb-shoveler-filter-model").register("gb-filter-model-factory",function(h,l,g,b){return h.createClass({getFilterModel:function(a,c){var d=null;if(a&&c){var e=gb.widgets[a].widgetName;a={widgetGroupID:c,widgetID:a};try{d=e===gb.enums.WidgetNames.PC_SHOVELER?new b(a):new g(a)}catch(f){n.log("FilterModel invoked for the widget is not supported on the platform!",
"ERROR","GoldboxMobileAssets")}}return d}})});n.when("A","GoldboxMobile3PAssets").register("gb-filter-utils",function(h,l){var g=l._;return{_paginationDummyUrls:{PREV:"prev",NEXT:"next"},_sortAlphabetically:function(b){b=g.pairs(b);return g.sortBy(b,function(a){return a[0]})},_sortRanges:function(b){b=g.pairs(b);return g.sortBy(b,function(a){a=a[0].split("-")[0]||0;return parseInt(a,10)})},_getFilterOptionsForDealStates:function(b,a){var c={};g.each(b,function(a){var b=gb.enums.DealStatesToFilterStates[a[0]],
f=parseInt(c[b],10);c[b]=f?(f+parseInt(a[1],10)).toString():a[1]});return g.map(c,function(c,b){return{value:b,selected:g.contains(a,b),count:c,attribute:gb.enums.BinningParams.DEAL_STATE.key}})},getFilterOptions:function(b,a,c){var d=gb.filterControllerFactory.getFilterController(c.widgetName).models[c.widgetGroupID],e=d.getSelectedBinningValues(b);if(b===gb.enums.BinningParams.PRICE.key)g.isArray(e)||(e=[e]),c=this._sortRanges(a),c=g.map(c,function(a){var c=a[0].split("-");return{rangeStart:c[0],
rangeEnd:c[1],value:a[0],count:a[1],attribute:b,selected:g.contains(e,a[0])}});else if(b===gb.enums.BinningParams.DISCOUNT.key){var f="",k=0;g.isArray(e)&&(e=e.join(","));c=this._sortRanges(a).reverse();c=g.map(c,function(a){var c=a[0].split("-");f=f?a[0]+","+f:a[0];k+=a[1];return{rangeStart:c[0]?c[0]:"0",value:f,count:k,attribute:b,selected:e===f}});c=c.reverse()}else if(b===gb.enums.BinningParams.PAGE.key)c=[{currentPage:gb.controller.widgetCurrentPage[c.widgetID],totalPages:c.totalPages,dummyUrls:this._paginationDummyUrls,
count:1,attribute:b,minimalPagination:gb.configManager.getWidgetViewConfig(c.widgetID).minimalPagination}];else if(b===gb.enums.BinningParams.SORT_ORDER.key||b===gb.enums.BinningParams.REVIEW_RATING.key)c=[{count:1,attribute:b,selected:e}];else if(b===gb.enums.BinningParams.PRIME_ELIGIBLE_ONLY.key||b===gb.enums.BinningParams.GLOBAL_ELIGIBLE_ONLY.key||b===gb.enums.BinningParams.NEW_RELEASES.key||b===gb.enums.BinningParams.GIFT_WRAPPABLE.key||b===gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key||
b===gb.enums.BinningParams.CASH_ON_DELIVERY.key||b===gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key||b===gb.enums.BinningParams.ACCESS_TYPE)c=[{value:1,selected:e,count:1,attribute:b}];else{b===gb.enums.BinningParams.CATEGORIES.key?(c=g.filter(gb.resources.whitelistedCategoryList,function(c){return c in a}),c=g.map(c,function(c){return[c,a[c]]})):b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID?(c=g.filter(gb.resources.whitelistedMarketingIDList,function(c){return c in a}),c=g.map(c,function(c){return[c,
a[c]]})):c=this._sortAlphabetically(a);var m=d.filterConfigValuesHash[b];m&&(c=g.filter(c,function(a){return g.contains(m,a[0])?!0:!1}),c=g.sortBy(c,function(a){return g.indexOf(m,a[0])}));g.isArray(e)||(e=[e]);c=b===gb.enums.BinningParams.DEAL_STATE.key?this._getFilterOptionsForDealStates(c,e):g.map(c,function(a){return{value:a[0],selected:g.contains(e,a[0]),count:a[1],attribute:b}})}return c},getFilterLabel:function(b,a){if(b){switch(b.attribute){case gb.enums.BinningParams.CATEGORIES.key:b=gb.resources.whitelistedCategoryNamesParsed[b.value];
break;case gb.enums.BinningParams.DEAL_STATE.key:case gb.enums.BinningParams.DEAL_TYPE.key:case gb.enums.BinningParams.PRIME_ACCESS_TYPE.key:a=gb.enums.FilterAttrToStrings[b.value];b=gb.resources.getString(a);break;case gb.enums.BinningParams.ACCESS_TYPE.key:a=gb.enums.FilterAttrToStrings[b.value];b=gb.resources.getString(a);break;case gb.enums.BinningParams.DISCOUNT.key:a=gb.enums.FilterAttrToStrings.DISCOUNT;b.rangeStart?b.rangeEnd||(a=gb.enums.FilterAttrToStrings.DISCOUNT_END):a=gb.enums.FilterAttrToStrings.DISCOUNT_START;
b=gb.resources.getString(a,{start:b.rangeStart,end:b.rangeEnd});break;case gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key:a=gb.enums.FilterAttrToStrings.FREE_SHIPPING_ELIGIBLE_ONLY;b=gb.resources.getString(a);break;case gb.enums.BinningParams.GIFT_WRAPPABLE.key:a=gb.enums.FilterAttrToStrings.GIFT_WRAPPABLE;b=gb.resources.getString(a);break;case gb.enums.BinningParams.GLOBAL_ELIGIBLE_ONLY.key:a=gb.enums.FilterAttrToStrings.GLOBAL_ELIGIBLE_ONLY;b=gb.resources.getString(a);break;case gb.enums.BinningParams.NEW_RELEASES.key:a=
gb.enums.FilterAttrToStrings.NEW_RELEASES;b=gb.resources.getString(a);break;case gb.enums.BinningParams.PRICE.key:a=gb.enums.FilterAttrToStrings.PRICE;b.rangeStart?b.rangeEnd||(a=gb.enums.FilterAttrToStrings.PRICE_END):a=gb.enums.FilterAttrToStrings.PRICE_START;b=gb.resources.getString(a,{start:b.rangeStart,end:b.rangeEnd});break;case gb.enums.BinningParams.PRIME_ELIGIBLE_ONLY.key:a=a?gb.enums.FilterAttrToStrings.PRIME_SUMMARY:gb.enums.FilterAttrToStrings.PRIME;b=gb.resources.getString(a);break;case gb.enums.BinningParams.REVIEW_RATING.key:a=
gb.enums.FilterAttrToStrings.REVIEW_RATING;b=gb.resources.getString(a,{stars:b.selected});break;case gb.enums.BinningParams.SORT_ORDER.key:a=gb.enums.SortOrdersToStringsMap[b.selected];b=gb.resources.getString(a);break;case gb.enums.BinningParams.CASH_ON_DELIVERY.key:a=gb.enums.FilterAttrToStrings.CASH_ON_DELIVERY;b=gb.resources.getString(a);break;case gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key:a=gb.enums.FilterAttrToStrings.FULLFILLED_BY_AMAZON;b=gb.resources.getString(a);break;case gb.enums.IncludedDealTargetsSupported.MARKETING_ID:b=
gb.resources.whitelistedMarketingIDNamesParsed[b.value];break;default:b=b.value}return b}},getLabelForSelectedAttribute:function(b,a){var c,d,e=gb.filterControllerFactory.getFilterController(a.widgetName).models[a.widgetGroupID];a.widgetGroupID&&(d=e.getSelectedBinningValues(b));if(d){var f={};gb.enums.BinningParams.DEAL_STATE.key===b?f=g.object(gb.enums.FilterStatesToDealStates[d],g.range(gb.enums.FilterStatesToDealStates[d].length).map(function(){return 1})):g.isArray(d)?g.each(d,function(a){f[a]=
1}):f[d]=1;(b=this.getFilterOptions(b,f,a)[0])&&(c=this.getFilterLabel(b))}return c},setUrlFilterParam:function(b,a,c,d){var e=b.indexOf("#"),f=-1===e?"":b.substr(e);b=-1===e?b:b.substr(0,e);a=encodeURIComponent(a);e=new RegExp("([,])"+a+":.*?(\x26|$)","i");b.match(e)?b=b.replace(e,"$1"+a+":"+c+"$2"):(e=gb.utils.getParamValueFromUrl(b,d),e=g.isEmpty(e)?a+":"+c:e+","+a+":"+c,b=gb.utils.setUrlParam(b,d,e));return b+f}}});n.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-deal-asin-dao").register("gb-dcs-translator",
function(h,n,g,b){var a=n._;return g.extend({init:function(){this._super();this.registerConnections()},registerConnections:function(){this.on("PopulateMetadata",this.populateSelectDealsMetadata);this.on("PopulateDealDAO",this.populateDealDetails);this.on("PopulateStatus",this.populateDealStatus)},populateSelectDealsMetadata:function(c,d){var b=this;if(d&&d.dealDetails&&d.dealStatus){c=d.dealDetails;var f=d.dealStatus,k=(new Date).getTime();a.each(c,function(a,c){var d=gb.controller.getDealDAO(c);
c=f[c];c.responseTimestamp=k;b.trigger("PopulateDealDAO",d,a,c)})}},populateDealDetails:function(c,d,b){if(d){gb.service.dealsWithDetails[c.dealID]=!0;c.dealType=d.type;c.legacyDealID=d.legacyDealID;c.offerID=d.offerID;c.merchantID=d.merchantID;c.merchantName=d.merchantName;var f=gb.resources.getFeature("gb_giveaway_deals");c.detail.title=d.title;d.primaryImage&&(c.detail.imageAsin=gb.baseUtils.checkAndSetSSLImageUrl(d.primaryImage));c.detail.description=d.description;c.detail.URL=this._setDealDetailURL(d,
!1);c.detail.itemType=d.itemType;c.detail.buyAsin=d.reviewAsin;c.detail.impressionAsin=d.impressionAsin;d.reviewAsin&&(c.reviews.URL=gb.utils.getReviewsPageURL(d.reviewAsin,d.type));d.marketingMessage&&(c.detail.marketingMessage=d.marketingMessage);d.isFulfilledByAmazon&&(c.detail.isFulfilledByAmazon=d.isFulfilledByAmazon);null!==d.totalReviews&&void 0!==d.totalReviews&&(c.reviews.total=parseInt(d.totalReviews,10));null!==d.reviewRating&&void 0!==d.reviewRating&&(c.reviews.rating=parseFloat(d.reviewRating));
c.auxiliaryData.isPrimeEligible=gb.resources.getCustomerData("isPrimeMarketplace")&&gb.utils.parseBool(d.isPrimeEligible);d.teaser&&(c.teaser.teaserLine=d.teaser);d.teaserImage&&(c.teaser.teaserImage=gb.baseUtils.checkAndSetSSLImageUrl(d.teaserImage));d.teaserAsin&&(c.teaser.teaserURL=this._setDealDetailURL(d,!0));this._setAccessType(c,d,b,f);c.detail.isPrimeEarlyAccessDeal=!1;c.detail.isPrimeOnly=!1;switch(c.detail.accessType){case gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS:c.detail.isPrimeEarlyAccessDeal=
!0;break;case gb.enums.DealAccessTypes.PRIME_ONLY_DOTD:case gb.enums.DealAccessTypes.PRIME_ONLY_LD:case gb.enums.DealAccessTypes.PRIME_ONLY_BD:c.detail.isPrimeOnly=!0;break;case gb.enums.DealAccessTypes.APP_ONLY_LD:case gb.enums.DealAccessTypes.APP_EARLY_ACCESS:c.detail.isAppDeal=!0;break;case gb.enums.DealAccessTypes.GIVEAWAY_DEAL:c.detail.isGiveawayDeal=!0}c.detail.isGiveawayDeal&&b.dealState===gb.enums.DealStates.AVAILABLE&&(c.detail.URL=this._setGiveawayDealDetailURL(c.detail.URL));c.auxiliaryData.breaksMAP=
gb.utils.parseBool(d.isMAP);null!==d.maxDealPrice&&void 0!==d.maxDealPrice&&null!==d.minDealPrice&&void 0!==d.minDealPrice?c.pricingData.prices.dealPrice={max:{value:parseFloat(d.maxDealPrice)},min:{value:parseFloat(d.minDealPrice)}}:c.detail.isGiveawayDeal&&!a.isEmpty(d.marketingMessage)&&(c.detail.giveawayValue=d.marketingMessage);null!==d.maxBAmount&&void 0!==d.maxBAmount&&null!==d.minBAmount&&void 0!==d.minBAmount&&(c.pricingData.prices.basisPrice={max:{value:parseFloat(d.maxBAmount)},min:{value:parseFloat(d.minBAmount)}});
null!==d.pricePerUnit&&void 0!==d.pricePerUnit&&(c.pricingData.unitPrice={value:parseFloat(d.pricePerUnit)},c.pricingData.unitPrice.formattedValue=gb.utils.getFormattedPrice(c.pricingData.unitPrice.value));null!==d.baseUnitValue&&void 0!==d.baseUnitValue&&null!==d.baseUnitName&&void 0!==d.baseUnitName&&(c.pricingData.baseUnit={value:d.baseUnitValue,name:d.baseUnitName});a.each(c.pricingData.prices,function(d,b){null===d&&void 0===d||a.each(d,function(a,d){c.pricingData.prices[b][d].formattedValue=
gb.utils.getFormattedPrice(c.pricingData.prices[b][d].value)})});if(d.maxPercentOff&&d.minPercentOff){var f=parseInt(d.maxPercentOff,10),k=parseInt(d.minPercentOff,10);f===k&&(c.pricingData.percentOff=gb.utils.getDisplayablePercentOff(f))}null!==c.pricingData.percentOff&&void 0!==c.pricingData.percentOff||c.calculatePercentOff();c.detail.itemType===gb.enums.ItemTypes.VARIATION&&this.populateAsinDetails(d.items,c);d.bKind&&(c.pricingData.bKind=d.bKind);d.glProductGroup&&-1!==a.indexOf(gb.utils.digitalGlProductGroup,
d.glProductGroup)&&(c.isDigital=!0);this._setExtendedAttributes(c,d);this._groupDealsByType(c);this._groupDealsByAccessType(c);this._executePostTranslationRules(c);b&&this.populateDealStatus(c,b)}},_setAccessType:function(a,d,b,f){d.accessBehavior&&null!==d.accessBehavior.accesslogic?(d=gb.utils.deduceAccessTypeInfoFromGetDealResponse(d,b,f),a.detail.accessType=d.accessType,a.detail.accessDurationInMs=parseInt(d.accessTypeDuration,10)*gb.enums.Constants.MINUTE_IN_MILLIS):d.primeAccessType&&(gb.enums.DealAccessTypes[d.primeAccessType]&&
(a.detail.accessType=d.primeAccessType),a.detail.accessDurationInMs=parseInt(d.primeAccessDuration,10)*gb.enums.Constants.MINUTE_IN_MILLIS)},_setGiveawayDealDetailURL:function(a){var d=l.location.protocol+"//"+l.location.host,d=gb.resources.deviceInfo.isApp?d+gb.enums.GiveawayUrlParams.returnToUrlMob:d+gb.enums.GiveawayUrlParams.returnToUrlPc;a=gb.utils.setUrlParam(a,"fsrc",gb.enums.GiveawayUrlParams.client);a=gb.utils.setUrlParam(a,"return_to",encodeURIComponent(d));return a=gb.utils.setUrlParam(a,
"nav",gb.enums.GiveawayUrlParams.nav)},_groupDealsByType:function(a){var d=gb.metadata.dealsByType[a.dealType]||[];d.push(a.dealID);gb.metadata.dealsByType[a.dealType]=d},_groupDealsByAccessType:function(a){var d=a.detail.accessType;if(d){var b=gb.metadata.dealsByAccessType[d]||[];b.push(a.dealID);gb.metadata.dealsByAccessType[d]=b}},_setExtendedAttributes:function(c,d){(d=d.extendedAttributes)&&a.isArray(d.hideAddToCart)&&"1"===d.hideAddToCart[0]&&(c.extendedAttributes.hideAddToCart=!0)},_setDealDetailURL:function(a,
d){var b=a.merchantID,f=gb.clientName,k=a.egressUrl,m=k,g=a.itemType,h=a.reviewAsin;d&&(h=a.teaserAsin);k=k?-1===k.indexOf("/dp/")||-1!==k.indexOf("forceLinkOverride"):!1;if(f===gb.enums.MobileClients.PC){if(a.type===gb.enums.DealTypes.EVENT&&!k||d)m=h?gb.utils.getDetailPageURL(h,f):"";m&&b&&!gb.utils.hasConflictingDpParams(m)&&(m=gb.utils.setUrlParam(m,"smid",b))}else{if(a.type!==gb.enums.DealTypes.EVENT||!k){gb.utils.isTablet(f)&&(f=gb.enums.Platforms.TAB);var l=gb.utils.isUnsupportedEgressURL(a),
n=gb.resources.deviceInfo,k=!1;if(a.type===gb.enums.DealTypes.DOTD||a.type===gb.enums.DealTypes.BD||a.primeAccessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD)if(g===gb.enums.ItemTypes.SINGLE||l||n.isWindowsPhone||n.isMetro)k=!0;g=a.type===gb.enums.DealTypes.LD&&a.primeAccessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||a.type===gb.enums.DealTypes.LOCAL||a.type===gb.enums.DealTypes.EVENT;if(d||k||g)a.type===gb.enums.DealTypes.BD&&a.itemType===gb.enums.ItemTypes.NONE&&(h=gb.utils.getAsinFromURL(a.egressUrl)),
m=h?gb.utils.getDetailPageURL(h,f):""}m&&b&&!gb.utils.hasConflictingDpParams(m)&&(m=gb.resources.getFeature("smid_m_standardization")?gb.utils.setUrlParam(m,"smid",b):gb.utils.setUrlParam(m,"m",b));m&&(m=gb.utils.setUrlParam(m,"dealid",a.dealID))}return m=gb.utils.convertToRequesterDomainUrl(m)},populateDealStatus:function(c,d,b){if(d){var f=d.responseTimestamp||(new Date).getTime(),k=c.status.dates.cacheExpires;c.dealType===gb.enums.DealTypes.LD&&!gb.utils.parseBool(d.isRedemptionStatus)&&k&&k.getTime()>
f||(c.customerState=null,c.checkingDealStatus=!1,void 0!==d.percentClaimed&&null!==d.percentClaimed&&(c.status.percentClaimed=parseInt(d.percentClaimed,10)),void 0!==d.isValid&&null!==d.isValid&&(c.status.isValidDeal=d.isValid),void 0!==d.msCacheTtl&&null!==d.msCacheTtl&&(k=parseInt(d.msCacheTtl,10),c.status.cache.lastMsCacheTtl=k,c.status.dates.cacheExpires=new Date(f+k)),void 0!==d.msToEnd&&null!==d.msToEnd&&(c.status.dates.end=new Date(f+parseInt(d.msToEnd,10))),void 0!==d.msToStart&&null!==d.msToStart&&
(c.status.dates.start=new Date(f+parseInt(d.msToStart,10))),gb.resources.customerData.hasEarlyAccessBenefit||(f=c.status.dates.start.getTime()+c.detail.accessDurationInMs,c.status.dates.startForNonPrimeCustomer=new Date(f)),void 0!==d.totalCouponCount&&null!==d.totalCouponCount&&(c.couponCounts.total=parseInt(d.totalCouponCount,10)),gb.metadata.dealsByState[d.dealState]=gb.metadata.dealsByState[d.dealState]||[],gb.metadata.dealsByState[d.dealState].push(c.dealID),d.dealState&&(d.dealState===gb.enums.DealStates.UPCOMING&&
0>=parseInt(d.msToStart,10)?c.dealState=gb.enums.DealStates.COMINGSOON:c.dealState=d.dealState),c.detail.itemType===gb.enums.ItemTypes.VARIATION&&a.each(d.dealItemStatus,function(a,d){(d=c.getAsinDAO(d))&&a&&gb.translator.populateAsinStatus(d,a)}),!a.isEmpty(gb.metadata.watchedDeals)&&-1<a.indexOf(gb.metadata.watchedDeals.ALL,c.dealID)&&(c.isDealWatched=!0),this._setDealTimeouts(c,d),c.trigger("RefreshView"),b&&b(c))}},populateAsinStatus:function(a,d){a.status.itemState=d.itemState;a.status.customerState=
d.customerState;void 0!==d.percentClaimed&&null!==d.percentClaimed&&(a.status.percentClaimed=d.percentClaimed);var b=gb.controller.getDealDAO(a.dealID);b.dealType===gb.enums.DealTypes.LD&&this._setAsinTimeouts(b,a,d)},translateClaimDealStatus:function(a,d,b){if(b)return a={isRedemptionStatus:!0,msCacheTtl:gb.enums.DefaultPollingIntervals.LD,dealItemStatus:{}},void 0!==b.msCacheTtl&&null!==b.msCacheTtl&&(a.msCacheTtl=parseInt(b.msCacheTtl,10)),b.dealItemStatus&&(a.dealItemStatus[d]={itemState:b.dealItemStatus.itemState,
customerState:b.dealItemStatus.customerState,msToCustomerStateExpiry:b.dealItemStatus.msToCustomerStateExpiry}),a},_setAsinTimeouts:function(a,d,b){var f=d.status.timeouts,k=d.status.dates,m=(new Date).getTime();l.clearTimeout(f.incartEnds);l.clearTimeout(f.pendingATCEnds);f.incartEnds=k.incartEnds=f.pendingATCEnds=k.pendingATCEnds=null;d.status.customerState===gb.enums.CustomerStates.INCART&&b.msToCustomerStateExpiry&&(k.incartEnds=new Date(m+parseInt(b.msToCustomerStateExpiry,10)),l.clearTimeout(f.incartEnds),
f.incartEnds=gb.utils.setSafeTimeout(function(){d.status.customerState=null;a.checkingDealStatus=!0;a.trigger("RefreshView")},k.incartEnds.getTime()-m));d.status.customerState===gb.enums.CustomerStates.PENDINGATC&&b.msToCustomerStateExpiry&&(k.pendingATCEnds=new Date(m+parseInt(b.msToCustomerStateExpiry,10)),l.clearTimeout(f.pendingATCEnds),f.pendingATCEnds=gb.utils.setSafeTimeout(function(){d.status.customerState=null;a.checkingDealStatus=!0;a.trigger("RefreshView")},k.pendingATCEnds.getTime()-m))},
_setDealTimeouts:function(c,d){var b=c.status.timeouts,f=c.status.dates,k=(new Date).getTime();l.clearTimeout(b.end);l.clearTimeout(b.start);l.clearTimeout(b.incartEnds);l.clearTimeout(b.earlyAccessExpires);l.clearTimeout(b.pendingATCEnds);b.end=b.start=b.incartEnds=b.earlyAccessExpires=f.incartEnds=f.pendingATCEnds=b.pendingATCEnds=c.customerState=null;c.dealState!==gb.enums.DealStates.SOLDOUT&&c.dealState!==gb.enums.DealStates.EXPIRED&&(b.end=gb.utils.setSafeTimeout(function(){c.dealState=gb.enums.DealStates.EXPIRED;
c.trigger("RefreshView");gb.utils.invokeWatchDealStateTransitions(c.dealID)},f.end.getTime()-k));if(gb.utils.isDealInEarlyAccessWindow(c)){var m=c.detail.accessDurationInMs+parseInt(d.msToStart,10);m<=parseInt(d.msCacheTtl,10)&&(l.clearTimeout(b.earlyAccessExpires),b.earlyAccessExpires=l.setTimeout(function(){gb.resources.customerData.hasEarlyAccessBenefit||(c.checkingDealStatus=!0,c.dealState=gb.enums.DealStates.LOADING);c.trigger("RefreshView");gb.utils.invokeWatchDealStateTransitions(c.dealID)},
m),f.cacheExpires=new Date(m+k))}c.dealState===gb.enums.DealStates.UPCOMING&&(c.dealType===gb.enums.DealTypes.LD&&gb.utils.hasPricingDetails(c)?b.start=gb.utils.setSafeTimeout(function(){c.dealState=gb.enums.DealStates.AVAILABLE;a.each(c.items,function(a,c,d){a.status.itemState=gb.enums.DealStates.AVAILABLE});gb.service.dealsWithDetails[c.dealID]=!0;gb.utils.invokeWatchDealStateTransitions(c.dealID);c.trigger("RefreshView")},f.start.getTime()-k):b.start=gb.utils.setSafeTimeout(function(){c.dealState=
gb.enums.DealStates.LOADING;gb.service.dealsWithDetails[c.dealID]=!1;c.trigger("RefreshView");gb.service.getDealDetails(c.dealID);gb.utils.invokeWatchDealStateTransitions(c.dealID)},f.start.getTime()-k));gb.watcher.dealsInView[c.dealID]&&(l.clearTimeout(b.cacheExpires),b.cacheExpires=l.setTimeout(function(){c.dealType!==gb.enums.DealTypes.LD||c.dealState!==gb.enums.DealStates.UPCOMING||gb.utils.hasPricingDetails(c)?gb.service.pollDealStatus(c.dealID):(gb.service.dealsWithDetails[c.dealID]=!1,gb.service.getDealDetails(c.dealID))},
f.cacheExpires.getTime()-k));d=d.dealItemStatus&&d.dealItemStatus[c.detail.buyAsin];m=c.detail.itemType===gb.enums.ItemTypes.VARIATION&&c.dealType===gb.enums.DealTypes.LD;d&&a.contains(a.values(gb.enums.CustomerStates),d.customerState)&&!m&&(c.customerState=d.customerState);c.dealType===gb.enums.DealTypes.LD&&d&&d.customerState===gb.enums.CustomerStates.INCART&&!m&&d.msToCustomerStateExpiry&&(f.incartEnds=new Date(k+parseInt(d.msToCustomerStateExpiry,10)),l.clearTimeout(b.incartEnds),b.incartEnds=
gb.utils.setSafeTimeout(function(){c.customerState=null;c.checkingDealStatus=!0;c.trigger("RefreshView")},f.incartEnds.getTime()-k));c.dealType===gb.enums.DealTypes.LD&&d&&d.customerState===gb.enums.CustomerStates.PENDINGATC&&!m&&d.msToCustomerStateExpiry&&(f.pendingATCEnds=new Date(k+parseInt(d.msToCustomerStateExpiry,10)),l.clearTimeout(b.pendingATCEnds),b.pendingATCEnds=gb.utils.setSafeTimeout(function(){c.customerState=null;c.checkingDealStatus=!0;c.trigger("RefreshView")},f.pendingATCEnds.getTime()-
k))},populateAsinDetails:function(c,d){a.each(c,function(a){var c=new b(a);d.items[a.itemID]=c})},_executePostTranslationRules:function(a){if("LOCAL_DEAL"===a.dealType&&a.detail){var d=a.detail.URL;if(d){var b=d.match(/:\/\/(.[^\/]+)/)[1];if(b&&b.match(/^local\./)){var f=d.split(b),b=b.replace(/^local\./,"www."),d=f[0],f=f[1];d&&f&&(a.detail.URL=d+b+"/local"+f)}}}}})});n.when("A","GoldboxMobile3PAssets").register("gb-view-component-builder",function(h,n){var g=n._;return h.createClass({_addMetricsData:function(b,
a){a=[b.deal&&b.deal.dealID];b.deal&&b.deal.detail&&b.deal.detail.isAppDeal&&a.push(gb.metrics.refTags.app);if(b.deal&&b.deal.detail&&b.deal.detail.isGiveawayDeal){var c=gb.metadata.getDealIDPosition(b.deal.dealID,b.widgetID);a.push(c)}b.getReffedURL=gb.metrics.partiallyAppliedReffedURLFunction({widgetID:b.widgetID,data:a});return b},_addMobileReffedDetailURL:function(b){var a;a=b.deal.dealState===gb.enums.DealStates.UPCOMING||b.deal.dealState===gb.enums.DealStates.COMINGSOON?b.deal.teaser.teaserURL:
b.deal.detail.URL;a=b.deal&&b.deal.detail&&b.deal.detail.isGiveawayDeal?b.getReffedURL(a,gb.metrics.refTags.giveawayMobile):b.getReffedURL(a,gb.metrics.refTags.mobile);gb.utils.isSponsoredDeal(b.deal.dealID,gb.metadata.customResponseAttributes[b.widgetID])&&(a=gb.utils.getSponsoredDealUrl(b.sponsoredDealAttr,a));b.mobileReffedDetailURL=a;return b},_getWidgetViewFlexModelData:function(b,a){var c=gb.configManager.getWidgetViewConfig(b.widgetID),d=document.documentElement.style;if(c.allowFlexRendering&&
("flexWrap"in d||"WebkitFlexWrap"in d||"msFlexWrap"in d)){var e=gb.configManager.getDealViewConfig(b.widgetID),d=e.dealsPerRowP,e=e.dealsPerRowL,f,k;k=b.skinDomElement.find(".dealView");f=gb.utils.getDealsPerRow(h.$(l).height(),b.minDealViewWidth,c.hasMargin,c.supportEvenColumnsOnly);b.viewOrientation===gb.enums.ClientOrientation.LANDSCAPE?(e=a.columnCount<=e?a.columnCount:e,d=f<=d?f:d,a.columnCount=e):(d=a.columnCount<=d?a.columnCount:d,e=f<=e?f:e,a.columnCount=d);0<k.size()?(c=k.eq(0),k=parseFloat(c.data("pwidth")),
c=parseFloat(c.data("lwidth"))):(f=gb.utils.getComputedDealWidthForFlexWidget(b.dealsPerRow,c.supportEvenColumnsOnly),k=d===b.dealsPerRow?f:gb.utils.getComputedDealWidthForFlexWidget(d,c.supportEvenColumnsOnly),c=e===b.dealsPerRow?f:gb.utils.getComputedDealWidthForFlexWidget(e,c.supportEvenColumnsOnly));f=b.viewOrientation===gb.enums.ClientOrientation.PORTRAIT?k:c;a.doFlexRendering=!0;a.dealWidth=f+"%";a.dealWidthP=k+"%";a.dealWidthL=c+"%";a.dealPerRow={};a.dealPerRow[gb.enums.ClientOrientation.PORTRAIT]=
d;a.dealPerRow[gb.enums.ClientOrientation.LANDSCAPE]=e;d=a.elements||{};d.flexContainer=gb.templateManager.getWidgetHTML({widgetID:b.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"flexContainer",data:a});a.elements=d}},getWidgetViewTemplateData:function(b,a){var c=b.widgetID,d=gb.controller.schedulingParams[c],e=gb.enums.WidgetViewIDs,f=gb.enums.WidgetHeaderIDs,k=gb.configManager.getDealViewConfig(c),m=b.dealsPerRow,g=gb.watcher.lowestDealIDWatchedIndex[c]+1-b.nextPositionToRender,
h=Math.ceil(g/d.pageSize),l=Math.ceil((b.nextPositionToRender+1)/d.pageSize);if(d.enforceLimitedDeals||d.enablePagination)var h=1,n=d.pageSize,g=Math.min(gb.metadata.selectedDealsCount[c]-(gb.controller.widgetCurrentPage[c]-1)*n,n);l=a?1:l;n=gb.enums.Constants.MAX_SUPPLE_DEALS_TO_DISPLAY;d.pageSize&&(n=d.pageSize);a=this._getCurrentCategory(c);var r=this._getCurrentStates(c),v=gb.utils.getFilterViewIDs(d.filterConfig),x=d.redirectText||gb.resources.getString("gb_see_all_deals"),z=0,B,A=gb.filterControllerFactory.getFilterController(b.widgetName).models[b.widgetGroupID];
A&&(z=A.getSelectedFilterCount(),A.customFilter&&(B=gb.filterUtils.getLabelForSelectedAttribute(A.customFilter,{widgetID:b.widgetID,widgetGroupID:b.widgetGroupID,totalPages:b.totalPages}))&&--z);e={widgetView:b,schedulingParams:d,widgetID:c,widgetGroupID:b.widgetGroupID,viewIDs:e,filterViewIDs:v,totalDeals:gb.metadata.getAllDisplayableDealIDs(c).length,totalDealsToShowCount:gb.controller.totalDealsToShow[c],totalDisplayableDealsCount:gb.controller.totalDisplayableDealsCount[c],orientation:b.viewOrientation,
dealViewCount:b.nextPositionToRender,dealViewConfig:k,firstPage:l,columnCount:m,cellCount:g,pagesToDraw:h,pageSize:n,seeAllText:x,WidgetHeaderIDs:f,selectedFilterCount:z,sortOptionSelected:gb.resources.getString(gb.enums.SortOrdersToStringsMap[d.sortOrder]),customFilterSelected:B,nextAdSlotToRenderIndex:b.nextAdSlotToRenderIndex,currentCategory:a,currentStates:r,title:d.title};this._getWidgetViewFlexModelData(b,e);f=gb.controller.widgetCurrentStatus[c];a&&(gb.controller.isPaginatedMetadataCall(c)&&
(e.dealCount=gb.metadata.getAllDisplayableDealIDs(c).length),gb.metadata.sortedDealIDs[c][f]&&gb.metadata.sortedDealIDs[c][f][a]&&(e.dealCount=gb.metadata.sortedDealIDs[c][f][a].length));d.enablePagination&&(e.widgetLandingPageUrl=gb.utils.getWidgetLandingPageUrl(c));b.deprecateNoDealMsg||(f=this._getNoDealsMessage(b),e.noDealsMessage=f.message,e.isFiltersSelected=f.isFiltersSelected,e.isGDMFailing=b.isGDMFailing,e.isRetryInProgress=b.isRetryInProgress);!d.enablePagination&&gb.watcher.lowestDealIDWatchedIndex[c]<
e.totalDeals-1&&!d.watchedDealsWidget?e.showLoadingSpinner=!0:(b.hideScrollContentLoader(),e.showLoadingSpinner=!1);return this._addMetricsData(e)},getRefineTemplateData:function(b,a){var c=this.getWidgetViewTemplateData(b);c.useLinksForFilterItem=!0;var d=[];if(gb.controller.isPaginatedMetadataCall(b.widgetID)){c.useLinksForFilterItem=!1;var e=gb.metadata.binningInfo[b.widgetID].whitelist_categories,f=[];gb.resources.whitelistedCategoryList.forEach(function(a){e&&e[a]&&f.push(a)});if(f){for(var k=
0;k<f.length;k++)var m=e[f[k]],d=this._getRefineRowData(m,f[k],d,a);a=gb.widgets[b.widgetID].widgetGroupID;b=gb.filterControllerFactory.getFilterController(b.widgetName).models[a].attributesList;g.contains(b,gb.enums.BinningParams.PRIME_ACCESS_TYPE.key)&&(c.showPEALink=!0,c.PEAText=gb.resources.getString("csld-cat-prime_early_access_deals"),c.POLDText=gb.resources.getString(gb.enums.FilterAttrToStrings.PRIME_ONLY_LD),c.PODOTDText=gb.resources.getString(gb.enums.FilterAttrToStrings.PRIME_ONLY_DOTD))}}else for(var k=
gb.metadata.getMetadataCategories(b.widgetID),q=gb.controller.widgetCurrentStatus[b.widgetID],h=0;h<k.length;h++)m=gb.metadata.sortedDealIDs[b.widgetID][q][k[h]].length,d=this._getRefineRowData(m,k[h],d,a);c.categoryData=d;return c},_getRefineRowData:function(b,a,c,d){d=gb.resources.getCategoryName(a,d);a!==gb.enums.CategoryFilters.ALL&&(d=d+" ("+b+")");0<b&&c.push({nodeId:a,text:d});return c},getDealViewTemplateData:function(b,a){var c=b.deal;if(c.dealState===gb.enums.DealStates.LOADING)return{};
var d=b.widgetView,e=gb.configManager.getWidgetViewConfig(d.widgetID),f=gb.configManager.getDealViewConfig(d.widgetID),k=null,m=!1,g=!1,l="",n=gb.resources.getCustomerData("realm"),r=this._populateSponsoredDealAttributes(d.widgetID,c.dealID),u=!0;"function"===typeof d._isDoubleCell&&(m=d._isDoubleCell(c.dealID));if(c.dealType===gb.enums.DealTypes.COUPON||c.dealType===gb.enums.DealTypes.LOCAL)k=c.detail.marketingMessage;gb.utils.showPPU(c.dealID)&&c.pricingData.unitPrice&&c.pricingData.baseUnit&&(g=
!0,l=gb.resources.getString("gb_ppu_price",{price:c.pricingData.unitPrice.formattedValue,unitValue:c.pricingData.baseUnit.value,unitName:c.pricingData.baseUnit.name}));c.dealState===gb.enums.DealStates.UPCOMING&&(u=gb.utils.isWatchButtonEnabled(c,d.widgetID));var v=gb.controller.watchDealView?gb.controller.watchDealView._isPopupTriggerRequired(d):!1,e={widgetID:d.widgetID,widgetGroupID:d.widgetGroupID,deal:c,dealViewConfig:f,widgetViewConfig:e,position:b.position,viewIDs:gb.enums.dealViewIDs,totalDeals:gb.metadata.selectedDealsCount[d.widgetID],
orientation:d.viewOrientation,marketingMessage:k,isDoubleCell:m,isPrimeEarly:c.detail.isPrimeEarlyAccessDeal,isPrimeOnly:c.detail.isPrimeOnly,showPPU:g,ppuPrice:l,isPopupTriggerRequired:v,realm:n,sponsoredDealAttr:r,isWatchButtonEnabled:u};e.showPercentOff=gb.utils.isShowPercentageOffEnabled();e.showSpecialPriceStyle=gb.utils.isSpecialPricingStyleEnabled();e.priceText=gb.utils.getPriceTextForBasisKind(c.pricingData.bKind);k=gb.templateManager.hasTemplate({widgetID:d.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,
templateName:"badge"});m=gb.templateManager.hasTemplate({widgetID:d.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"primeBadge"});if(k||m)e.badgeProperty=gb.badgeUtils.generateBadgeProperties(b);c.detail.itemType===gb.enums.ItemTypes.VARIATION&&gb.widgets[d.widgetID].widgetName===gb.enums.WidgetNames.ML_HERO?(e.asin=a,e.dimensionData=this._findDimensionData(c),e.selectedDimension=b.variationView.selectedDimension,e.unavailableAsinSelected=b.variationView.unavailableAsinSelected,
e.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(b,a),e.priceText=a?gb.utils.getPriceTextForBasisKind(a.bKind):gb.utils.getPriceTextForBasisKind(c.pricingData.bKind),this._setDealViewTimerData(b,e,a)):(e.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(c,d.widgetID),this._setDealViewTimerData(b,e));e.cellCount=gb.metadata.getSortedDealIDs(d.widgetID).length;e.customerRefTag=gb.service.customerID?gb.metrics.refTags.recLearnMore:gb.metrics.refTags.unrecLearnMore;e.imageSize=
h.capabilities.hires?f.imageSizeLarge||f.imageSize:f.imageSize;b=!1;a="medium";gb.utils.isTablet()&&(b=!0,a="mini");e.isTabletButton=b;e.buttonContainerSpacing=a;return this._addMobileReffedDetailURL(this._addMetricsData(e))},getDealOptionsTemplateData:function(b){var a={},c=b.widgetView.widgetID,d=gb.configManager.getWidgetViewConfig(c),e=gb.utils.isShowPercentageOffEnabled(),f=gb.utils.isSpecialPricingStyleEnabled();c&&d.supportWatch&&b.deal.isDealWatched&&(a.StopWatching=gb.enums.BottomSheetActions.StopWatching);
return{widgetID:c,position:b.position,deal:b.deal,dealAction:a,showPercentOff:e,showSpecialPriceStyle:f}},getMiniDPViewTemplateData:function(b,a,c){var d=b.deal;if(d.dealState===gb.enums.DealStates.LOADING)return{};var e=b.widgetView,f=gb.configManager.getWidgetViewConfig(e.widgetID),k=gb.configManager.getDealViewConfig(e.widgetID),m=null;if(d.dealType===gb.enums.DealTypes.COUPON||d.dealType===gb.enums.DealTypes.LOCAL)m=d.detail.marketingMessage,d.dealType===gb.enums.DealTypes.COUPON&&(m=m+" "+gb.resources.getString("gb_coupon"));
var g=gb.controller.watchDealView?gb.controller.watchDealView._isPopupTriggerRequiredForMiniDP(e):!1,f={widgetID:e.widgetID,widgetGroupID:e.widgetGroupID,deal:d,dealViewConfig:k,widgetViewConfig:f,position:b.position,viewIDs:gb.enums.dealViewIDs,totalDeals:gb.metadata.selectedDealsCount[e.widgetID],orientation:e.viewOrientation,marketingMessage:m,isPrimeEarly:d.detail.isPrimeEarlyAccessDeal,isPrimeOnly:d.detail.isPrimeOnly,isMiniDP:!0,isPopupTriggerRequired:g};f.showPercentOff=gb.utils.isShowPercentageOffEnabled();
f.priceText=gb.utils.getPriceTextForBasisKind(d.pricingData.bKind);f.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(d,e.widgetID);d.detail.itemType===gb.enums.ItemTypes.VARIATION?(f.asin=c,f.dimensionData=this._findDimensionData(d),f.selectedDimension=b.variationView.selectedDimension,f.unavailableAsinSelected=b.variationView.unavailableAsinSelected,f.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(b,c),this._setMiniDPAsinViewTimerData(b,c,f,a.id),f.priceText=c?gb.utils.getPriceTextForBasisKind(c.bKind):
gb.utils.getPriceTextForBasisKind(d.pricingData.bKind)):(f.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(d,e.widgetID),this._setMiniDetailPageViewTimerData(b,f,a.id));return this._addMobileReffedDetailURL(this._addMetricsData(f))},getDealStateTemplateData:function(b,a,c){var d=b.deal,e=b.widgetView,f=gb.configManager.getWidgetViewConfig(e.widgetID),k=gb.configManager.getDealViewConfig(e.widgetID),m=gb.enums.dealViewIDs,g=!1,h=!1,l=gb.resources.getCustomerData("realm"),n=!1,r=this._populateSponsoredDealAttributes(e.widgetID,
d.dealID);if(l===gb.enums.Realms.JP||l===gb.enums.Realms.CN)h=!0;d.dealType===gb.enums.DealTypes.LD&&gb.controller.schedulingParams[e.widgetID].fetchWatchedDeals&&(n=!0,d.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS||d.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)&&(n=!1);"function"===typeof e._isDoubleCell&&(g=e._isDoubleCell(d.dealID));if(d.dealState===gb.enums.DealStates.LOADING)return{};a={widgetID:e.widgetID,
widgetGroupID:e.widgetGroupID,deal:d,dealViewConfig:k,widgetViewConfig:f,position:b.position,viewIDs:m,elements:a,totalDeals:gb.metadata.selectedDealsCount[e.widgetID],orientation:e.viewOrientation,isDoubleCell:g,isPrimeEarly:d.detail.isPrimeEarlyAccessDeal,isPrimeOnly:d.detail.isPrimeOnly,showCouponCount:h,isWatchDeal:n,sponsoredDealAttr:r};a.showPercentOff=gb.utils.isShowPercentageOffEnabled();a.priceText=gb.utils.getPriceTextForBasisKind(d.pricingData.bKind);d.detail.itemType===gb.enums.ItemTypes.VARIATION?
(f=gb.controller.getDealDAO(b.dealID),a.asin=c,a.dimensionData=this._findDimensionData(f),a.modalFirstLoad=b.variationView?b.variationView.modalFirstLoad:!1,a.selectedDimension=b.variationView?b.variationView.selectedDimension:{},a.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(b,c),a.unavailableAsinSelected=b.variationView?b.variationView.unavailableAsinSelected:!1,a.priceText=c?gb.utils.getPriceTextForBasisKind(c.bKind):gb.utils.getPriceTextForBasisKind(d.pricingData.bKind)):
a.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(d,e.widgetID);a.cellCount=gb.metadata.getSortedDealIDs(e.widgetID).length;a.customerRefTag=gb.service.customerID?gb.metrics.refTags.recLearnMore:gb.metrics.refTags.unrecLearnMore;return this._addMobileReffedDetailURL(this._addMetricsData(a))},getFilterViewTemplateData:function(b){var a=b.widgetView,c=gb.filterControllerFactory.getFilterController(a.widgetName).models[a.widgetGroupID];return{actionNameTileSelected:gb.enums.WidgetActions.Faceout.TILE_SELECTED,
attributes:b.attributes,attrPriority:c.filterAttrituesByPriority,eventID:a.widgetGroupID,filterType:b.type,filterOptions:b.filterOptions,filterConfig:b.filterConfig,maxTilesPerPage:gb.configManager.getWidgetViewConfig(a.widgetID).maxTilesPerPage,selectedValues:c.getSelectedBinningValues(b.filterConfig.attr)||[],tileWidth:a.tileWidthAsPercentage,title:b.title,totalPages:a.totalPages,view:b,viewIDs:gb.enums.WidgetViewIDs,widgetID:a.widgetID,widgetName:a.widgetName}},getAdRowViewData:function(b){return{nextAdSlotToRenderIndex:b.nextAdSlotToRenderIndex,
adSlots:gb.controller.schedulingParams[b.widgetID].adSlots,widgetID:b.widgetID}},getMashRefineData:function(b){for(var a=this.getRefineTemplateData(b,!0).categoryData,c=[],d=0;d<a.length;d++)c.push(a[d].text);return{title:gb.controller.schedulingParams[b.widgetID].title,buttonTitles:c,cancelButtonTitle:gb.resources.getString("csld-cancel"),successCallback:function(c){c<a.length&&gb.controller.trigger("WidgetCategoryChange",b.widgetID,a[c].nodeId)}}},getPaginationTemplateData:function(b){var a=gb.controller.widgetCurrentPage[b.widgetID]||
1,c=gb.metadata.getAllDisplayableDealIDs(b.widgetID).length;return{widgetID:b.widgetID,widgetName:b.widgetName,filterOptions:[{attribute:gb.enums.BinningParams.PAGE.key,currentPage:a,totalPages:Math.ceil(c/gb.controller.schedulingParams[b.widgetID].pageSize),dummyUrls:gb.enums.PaginationDummyURLs,minimalPagination:gb.configManager.getWidgetViewConfig(b.widgetID).minimalPagination}]}},_populateSponsoredDealAttributes:function(b,a){var c=gb.controller.schedulingParams[b].customRequestAttributes,d=gb.metadata.customResponseAttributes[b];
b={};var e=gb.resources.getFeature("gb_sponsored_badge"),f=e===gb.enums.Weblabs.TREATMENTS.T2,k=e===gb.enums.Weblabs.TREATMENTS.T3;b.showSponsoredBadge=e===gb.enums.Weblabs.TREATMENTS.T1||e===gb.enums.Weblabs.TREATMENTS.T2||e===gb.enums.Weblabs.TREATMENTS.T3;b.showSponsoredBadgeWithIncreasedDealViewHeight=f;b.showSponsoredBadgeWithoutBadgingSpace=k;if(g.isEmpty(c)||g.isEmpty(d))return b;c=c.SponsoredDealAttributes.widgetName;(d=d.dealsWithBids)&&d[a]&&(a=d[a],b.isSponsored=!0,b.id=a.logId,b.qualifier=
a.qualifier,b.adId=a.adId,b.widgetName=c);return b},_setDealViewTimerData:function(b,a,c){var d=b.deal,e=b.widgetView,f=c?c.status.dates.incartEnds:d.status.dates.incartEnds,k=gb.utils.getDealViewID(e.widgetID,b.position),m=k+gb.enums.dealViewIDs.DEALCLOCK,g=f?!0:!1,h=c?c.status.dates.pendingATCEnds:d.status.dates.pendingATCEnds;c=gb.resources.customerData.hasEarlyAccessBenefit;var n=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer,r=gb.configManager.getWidgetViewConfig(e.widgetID).avoidContextBasedTimer;
if(g||h)g?(b.incartClock&&(l.clearTimeout(b.incartClock.timeout),b.incartClock=null),m=k+gb.enums.dealViewIDs.INCARTCLOCK,b.incartClock=gb.utils.heroTimer(f,b.viewElement,m,!0),a.incartTimeString=b.incartClock.timeString):h&&(b.pendingAtcClock&&(l.clearTimeout(b.pendingAtcClock.timeout),b.pendingAtcClock=null),m=k+gb.enums.dealViewIDs.PENDINGATCCLOCK,b.pendingAtcClock=gb.utils.heroTimer(h,b.viewElement,m,!0),a.pendingatcTimeString=b.pendingAtcClock.timeString),e.widgetName!==gb.enums.WidgetNames.PC_SUPPLE||
gb.controller.schedulingParams[e.widgetID].showShortCellView||this._genericEndDateTimerGenerator(b,a);else{k=(new Date).getTime();a.timerTextColor="base";if(d.dealState===gb.enums.DealStates.AVAILABLE||d.dealState===gb.enums.DealStates.WAITLIST||d.dealState===gb.enums.DealStates.WAITLISTFULL)gb.utils.isDealInEarlyAccessWindow(d)?d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||c?d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS?(b.clock=gb.utils.heroTimer(d.status.dates.startForNonPrimeCustomer,
b.viewElement,m,n),a.timeString=b.clock.timeString,a.timerPrefix=gb.resources.getString("gb_starts_in"),a.isEarlyAccessTimer=!r,a.timerTextColor="success"):this._genericEndDateTimerGenerator(b,a):(b.clock=gb.utils.heroTimer(d.status.dates.startForNonPrimeCustomer,b.viewElement,m,n),a.timeString=b.clock.timeString,a.timerPrefix=r?gb.resources.getString("gb_starts_in"):gb.resources.getString("gb_starts_for_you_in"),a.isEarlyAccessTimer=!r,a.timerTextColor="success"):this._genericEndDateTimerGenerator(b,
a);else if(d.dealState===gb.enums.DealStates.UPCOMING)if(f=e=d.status.dates.start,d.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS?(a.isEarlyAccessTimer=!r,c||(e=new Date(e.getTime()+d.detail.accessDurationInMs))):d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&(a.isEarlyAccessTimer=!r,e=new Date(e.getTime()+d.detail.accessDurationInMs)),k=e.getTime()-k,864E5<k)a.showDateOrTime=gb.utils.formatDate(e),a.timerPrefix=gb.resources.getString("gb_starts");else if(36E5<
k){if(a.showDateOrTime=gb.utils.formatTime(e.getHours(),e.getMinutes()),a.timerPrefix=gb.resources.getString("gb_starts_at"),a.isEarlyAccessTimer&&!r&&(a.timerPrefix=c?gb.resources.getString("gb_starts_for_prime_at"):gb.resources.getString("gb_starts_for_you_at")),d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||c||(a.primeTimeString=gb.utils.formatTime(f.getHours(),f.getMinutes()),a.primeTimerPrefix=gb.resources.getString("gb_starts_for_prime_at")),d.detail.isPrimeOnly&&!r&&(a.timerPrefix=
gb.resources.getString("gb_starts_for_prime_at")),d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS||d.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)a.timerPrefix=gb.resources.getString("gb_starts_at")}else if(b.clock=gb.utils.heroTimer(e,b.viewElement,m,n),a.timeString=b.clock.timeString,a.timerTextColor="success",a.timerPrefix=gb.resources.getString("gb_starts_in"),a.isEarlyAccessTimer&&!r&&(a.timerPrefix=c?gb.resources.getString("gb_starts_for_prime_in"):gb.resources.getString("gb_starts_for_you_in")),
d.detail.isPrimeOnly&&!r&&(a.timerPrefix=gb.resources.getString("gb_starts_for_prime_in")),d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||c||(a.primeTimeString=gb.utils.formatTime(f.getHours(),f.getMinutes()),a.primeTimerPrefix=gb.resources.getString("gb_starts_for_prime_at")),d.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD||d.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS)a.timerPrefix=gb.resources.getString("gb_starts_in");b=gb.resources.getCustomerData("realm")!==
gb.enums.Realms.IN&&(a.isEarlyAccessTimer&&c||d.detail.isPrimeOnly&&d.dealState===gb.enums.DealStates.UPCOMING);a.addLineBreak=b}},_setMiniDetailPageViewTimerData:function(b,a,c){b.modalClock&&(l.clearTimeout(b.modalClock.timeout),b.modalClock=null);var d=b.deal,e=b.widgetView,f=d.status.dates.incartEnds,k=gb.utils.getDealViewID(e.widgetID,b.position),m=k+gb.enums.dealViewIDs.DEALCLOCK,g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+m,h=d.status.dates.pendingATCEnds,n=gb.resources.customerData.hasEarlyAccessBenefit,
r=d.dealType===gb.enums.DealTypes.LD&&d.detail.itemType!==gb.enums.ItemTypes.SINGLE,e=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer,u=gb.enums.WidgetViewIDs.A_POPOVER+c;!f&&!h||r?(f=(new Date).getTime(),d.dealState===gb.enums.DealStates.AVAILABLE||d.dealState===gb.enums.DealStates.WAITLIST||d.dealState===gb.enums.DealStates.WAITLISTFULL?(gb.utils.isDealInEarlyAccessWindow(d)&&!n&&this._setMiniDPPrimeTimerData(b,a,u),this._genericEndDateTimerGenerator(b,a,c)):d.dealState===
gb.enums.DealStates.UPCOMING&&(m=d.status.dates.start,d.detail.accessType?this._setMiniDPPrimeTimerData(b,a,u):(d=m.getTime()-f,864E5<d?(a.showDateOrTime=gb.utils.formatDate(m),a.timerPrefix=gb.resources.getString("gb_deal_starts")):36E5<d?(a.showDateOrTime=gb.utils.formatTime(m.getHours(),m.getMinutes()),a.timerPrefix=gb.resources.getString("gb_deal_starts_at")):(b.modalClock=gb.utils.heroTimer(m,u,g,e),a.timeString=b.modalClock.timeString,a.timerPrefix=gb.resources.getString("gb_deal_starts_in"))))):
(f?(b.modalIncartClock&&(l.clearTimeout(b.modalIncartClock.timeout),b.modalIncartClock=null),g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+k+gb.enums.dealViewIDs.INCARTCLOCK,b.modalIncartClock=gb.utils.heroTimer(f,u,g,!0),a.modalIncartTimeString=b.modalIncartClock.timeString):h&&(b.modalPendingAtcClock&&(l.clearTimeout(b.modalPendingAtcClock.timeout),b.modalPendingAtcClock=null),g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+k+gb.enums.dealViewIDs.PENDINGATCCLOCK,b.modalPendingAtcClock=gb.utils.heroTimer(h,u,g,
!0),a.modalPendingatcTimeString=b.modalPendingAtcClock.timeString),c=d.status.dates.end,f=(new Date).getTime(),n=c.getTime()-f,g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+m,864E5<n?(a.showDateOrTime=gb.utils.formatDate(c),a.timerPrefix=gb.resources.getString("gb_ends")):d.dealType===gb.enums.DealTypes.BD&&36E5<n?(a.showDateOrTime=gb.utils.formatTime(c.getHours(),c.getMinutes()),a.timerPrefix=gb.resources.getString("gb_ends_at")):(b.modalClock=gb.utils.heroTimer(c,u,g,e),a.timeString=b.modalClock.timeString,
a.timerPrefix=gb.resources.getString("gb_ends_in")))},_setMiniDPPrimeTimerData:function(b,a,c){b.modalPrimeClock&&(l.clearTimeout(b.modalPrimeClock.timeout),b.modalPrimeClock=null);var d=b.deal,e=b.widgetView,f=gb.resources.customerData.hasEarlyAccessBenefit,k=gb.enums.WidgetViewIDs.MINI_DP_MODAL+gb.enums.WidgetViewIDs.PRIME+gb.utils.getDealViewID(e.widgetID,b.position)+gb.enums.dealViewIDs.DEALCLOCK;gb.utils.getDealViewID(e.widgetID,b.position);e=(new Date).getTime();if(d.dealState===gb.enums.DealStates.UPCOMING){var m=
d.status.dates.start;f||(m=new Date(m.getTime()+d.detail.accessDurationInMs));36E5<m.getTime()-e?(a.modalPrimeTimerPrefix=f?gb.resources.getString("gb_deal_starts_for_prime_at"):gb.resources.getString("gb_deal_starts_for_you_at"),d.detail.isPrimeOnly&&(a.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_at")),a.modalPrimeShowDateOrTime=gb.utils.formatTime(m.getHours(),m.getMinutes())):(b.modalPrimeClock=gb.utils.heroTimer(m,c,k,!0),a.modalPrimeTimeString=b.modalPrimeClock.timeString,a.modalPrimeTimerPrefix=
f?gb.resources.getString("gb_deal_starts_for_prime_in"):gb.resources.getString("gb_deal_starts_for_you_in"),d.detail.isPrimeOnly&&(a.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_in")))}else b.modalPrimeClock=gb.utils.heroTimer(d.status.dates.startForNonPrimeCustomer,c,k,!0),a.modalPrimeTimeString=b.modalPrimeClock.timeString,a.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_for_you_in")},_setMiniDPAsinViewTimerData:function(b,a,c,d){b.modalClock&&(l.clearTimeout(b.modalClock.timeout),
b.modalClock=null);var e=b.deal;if(a){var f=a.status,k=b.widgetView,m=a.status.dates.incartEnds,g=gb.utils.getDealViewID(k.widgetID,b.position);a=a.status.dates.pendingATCEnds;var h=gb.resources.customerData.hasEarlyAccessBenefit;gb.configManager.getWidgetViewConfig(k.widgetID);k=gb.enums.WidgetViewIDs.A_POPOVER+d;if(m||a)m?(b.modalIncartClock&&(l.clearTimeout(b.modalIncartClock.timeout),b.modalIncartClock=null),e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+g+gb.enums.dealViewIDs.INCARTCLOCK,b.modalIncartClock=
gb.utils.heroTimer(m,k,e,!0),c.modalIncartTimeString=b.modalIncartClock.timeString):a&&(b.modalPendingAtcClock&&(l.clearTimeout(b.modalPendingAtcClock.timeout),b.modalPendingAtcClock=null),e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+g+gb.enums.dealViewIDs.PENDINGATCCLOCK,b.modalPendingAtcClock=gb.utils.heroTimer(a,k,e,!0),c.modalPendingatcTimeString=b.modalPendingAtcClock.timeString),this._genericEndDateTimerGenerator(b,c,d);else if((new Date).getTime(),f.itemState===gb.enums.DealStates.AVAILABLE||f.itemState===
gb.enums.DealStates.WAITLIST||f.itemState===gb.enums.DealStates.WAITLISTFULL)gb.utils.isDealInEarlyAccessWindow(e)&&!h&&this._setMiniDPPrimeTimerData(b,c,k),this._genericEndDateTimerGenerator(b,c,d)}else this._setMiniDetailPageViewTimerData(b,c,d)},_genericEndDateTimerGenerator:function(b,a,c){var d=(new Date).getTime(),e=b.widgetView,f=b.deal.status.dates.end,d=f.getTime()-d,k=gb.utils.getDealViewID(e.widgetID,b.position)+gb.enums.dealViewIDs.DEALCLOCK,e=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer;
a.timerTextColor="base";d>=2*gb.enums.Constants.DAY_IN_MILLIS||d>1*gb.enums.Constants.DAY_IN_MILLIS&&b.deal.dealType===gb.enums.DealTypes.BD?(a.showDateOrTime=gb.utils.formatDate(f),a.timerPrefix=gb.resources.getString("gb_ends")):b.deal.dealType===gb.enums.DealTypes.BD&&36E5<d?(a.showDateOrTime=gb.utils.formatTime(f.getHours(),f.getMinutes()),a.timerPrefix=gb.resources.getString("gb_ends_at")):(c?(e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+k,c=gb.enums.WidgetViewIDs.A_POPOVER+c,b.modalClock&&(l.clearTimeout(b.modalClock.timeout),
b.modalClock=null),b.modalClock=gb.utils.heroTimer(f,c,e,!0),a.timeString=b.modalClock.timeString):(b.clock&&(l.clearTimeout(b.clock.timeout),b.clock=null),b.clock=gb.utils.heroTimer(f,b.viewElement,k,e),a.timeString=b.clock.timeString),a.timerPrefix=gb.resources.getString("gb_ends_in"),36E5>=d&&(a.timerTextColor="success"))},_addRedirectDetails:function(b,a,c){b=b||gb.resources.getString("gb_see_all_deals");var d=a===gb.enums.MiscLinks.LOCAL_URL?gb.metrics.refTags.seeAllLocalDeals:gb.metrics.refTags.seeAllDeals;
c&&(a=c.getReffedURL(a,d),c.seeAllText=b,c.redirectLink=a);return c},getLaunchCellTemplateData:function(b){var a=gb.controller.schedulingParams[b.widgetID];b={widgetView:b,widgetID:b.widgetID,schedulingParams:a};b=this._addMetricsData(b);return b=this._addRedirectDetails(a.redirectText,a.redirectLink,b)},getShovelerLaunchCellTemplateData:function(b){var a=gb.controller.schedulingParams[b.widgetID],c=a.widgetTabConfig[a.widgetCurrentTab];b={widgetView:b,widgetID:b.widgetID,schedulingParams:a,cssClasses:"gridColumn"+
b.dealsPerRow};b=this._addMetricsData(b);return b=this._addRedirectDetails(c.redirectText,c.redirectLink,b)},getSuppleWidgetViewTemplateData:function(b,a){var c=gb.controller.schedulingParams[b.widgetID],d=gb.enums.WidgetViewIDs,e=gb.configManager.getDealViewConfig(b.widgetID),f=b.dealsPerRow,k=gb.watcher.lowestDealIDWatchedIndex[b.widgetID]+1,m=k;if(c.enforceLimitedDeals&&c.showDoubleCellDOTD)var g=gb.metadata.getAllDisplayableDealIDs(b.widgetID),g=gb.metadata.getDOTDCount(g),m=m+g;c.enforceLimitedDeals&&
c.showLaunchCell&&gb.widgetHelper&&gb.widgetHelper.shouldReduceDeals[b.widgetID]&&0===m%b.dealsPerRow&&k--;m=Math.ceil(k/c.pageSize);if(c.enforceLimitedDeals||c.enablePagination)m=1;a=a?1:gb.controller.widgetCurrentPage[b.widgetID];g=gb.enums.Constants.MAX_SUPPLE_DEALS_TO_DISPLAY;c.pageSize&&(g=c.pageSize);var h=gb.utils.getFilterViewIDs(c.filterConfig),l=b.isLeftFilterRequired,n="",r="";c.disableRestrictionsApply||(n=gb.resources.getString("gb-restrictions-apply"),r=c.customRestrictionsApply||gb.resources.getString("csld-restrictions_link"));
var v=c.redirectText||gb.resources.getString("gb_see_all_deals"),e={widgetView:b,schedulingParams:c,widgetID:b.widgetID,widgetGroupID:b.widgetGroupID,viewIDs:d,filterViewIDs:h,totalDeals:gb.metadata.selectedDealsCount[b.widgetID],totalDealsToShowCount:gb.controller.totalDealsToShow[b.widgetID],orientation:b.viewOrientation,dealViewCount:b.nextPositionToRender,dealViewConfig:e,firstPage:a,columnCount:f,dealCount:k,pagesToDraw:m,pageSize:g,seeAllText:v,restrictionsApplyText:n,restrictionsApplyLink:r,
title:c.title,isLeftFilterRequired:l},d=this._getNoDealsMessage(b);e.noDealsMessage=d.message;e.isFiltersSelected=d.isFiltersSelected;e.isGDMFailing=b.isGDMFailing;e.isRetryInProgress=b.isRetryInProgress;e=this._addMetricsData(e);c.titleRedirectLink&&(e=this._addRedirectDetails(c.titleRedirectText,c.titleRedirectLink,e));return e},getShovelerWidgetViewTemplateData:function(b){var a=gb.controller.schedulingParams[b.widgetID],c=gb.enums.WidgetViewIDs,d,e,f=gb.metadata.selectedDealsCount[b.widgetID],
k=b.dealsPerRow||a.pageSize;a.pageSize=k;!a.enableFilter||a.widgetTabConfig[a.widgetCurrentTab].watchedDealsTab?d=!0:(e=gb.utils.getFilterViewIDs(a.filterConfig)[gb.enums.BinNames.CATEGORIES],d=!1);var m,g=a.widgetTabConfig[a.widgetCurrentTab];m=g&&g.launchCellIndex?Math.ceil((f+1)/k):Math.ceil(f/k);var h=gb.controller.widgetCurrentPage[b.widgetID];m&&h>m&&(h=m);gb.controller.widgetCurrentPage[b.widgetID]=h;var l=0;f&&(l=Math.min(k,f-(h-1)*k));var n=k="";a.disableRestrictionsApply||(k=gb.resources.getString("gb-restrictions-apply"),
n=a.customRestrictionsApply||gb.resources.getString("csld-restrictions_link"));c={actionName:gb.enums.WidgetActions.Shoveler.SHOVEL,currentPage:h,disableFilter:d,filterDomID:e,lastDealIDPosition:l,restrictionsApplyText:k,restrictionsApplyLink:n,schedulingParams:a,title:a.title,totalDeals:f,totalPages:m,viewIDs:c,widgetID:b.widgetID,widgetGroupID:b.widgetGroupID};a=this._getNoDealsMessage(b);c.noDealsMessage=a.message;c.isGDMFailing=b.isGDMFailing;c.isRetryInProgress=b.isRetryInProgress;c.gridColumnCSS=
"gridColumn"+b.dealsPerRow;c=this._addMetricsData(c);g&&g.titleRedirectText&&(c=this._addRedirectDetails(g.titleRedirectText,g.titleRedirectLink,c));return c},_findDimensionData:function(b){var a={};g.each(b.items,function(c){g.each(c.variationDimensions,function(c,b){a[b]||(a[b]=[]);a[b].push(c);a[b]=g.unique(a[b])})});return a},getCartErrorDisplayData:function(){var b=gb.resources.getString("gb-cart-error-header"),a=gb.resources.getString("gb-cart-error");return{errorAlertHeaderText:b,errorText:a}},
getBottomSheetFilterContentExpanderData:function(b,a){return{view:b,filterOptions:b.filterJSONData,isSortFilter:a.isSortFilter,schedulingParams:gb.controller.schedulingParams[b.widgetID]}},getBottomSheetFilterContentData:function(b){return{view:b,filterOptionList:b.filterOptions,currentSelection:b.widgetView.filterJSONData[b.filterConfig.attr].currentSelection,attribute:b.filterConfig.attr}},getBottomSheetFilterHeaderData:function(b,a){return{title:a.title,widgetView:b.widgetView?b.widgetView:b,selectedOption:b.filterConfig?
b.widgetView.filterJSONData[b.filterConfig.attr].currentSelection:"",showClearOption:a.showClearOption,enableBack:a.enableBack}},getBottomSheetFilterFooterData:function(){return{text:gb.resources.getString("csld-cancel")}},_getNoDealsMessage:function(b){var a,c,d=gb.controller.schedulingParams[b.widgetID],e=gb.filterControllerFactory.getFilterController(b.widgetName).models[b.widgetGroupID];if(d.watchedDealsWidget||gb.utils.isWatchedDealsTab(b.widgetID))gb.metadata.watchedDeals.ALL&&0!==gb.metadata.watchedDeals.ALL.length||
(gb.clientName===gb.enums.MobileClients.PC?a=gb.resources.getString("gb_no_watched_deals_punting_message",{watchDeal:"\x3cb\x3e"+gb.resources.getString("gb_watch_deal")+"\x3c/b\x3e"}):gb.configManager.getWidgetViewConfig(b.widgetID).showNoWatchedDealsMessg&&(a=gb.resources.getString("gb_no_watched_deals_to_show",{watchDeal:"\x3cb\x3e"+gb.resources.getString("gb_watch_deal")+".\x3c/b\x3e"})));else if(g.isEmpty(gb.metadata.getAllDisplayableDealIDs(b.widgetID))){var f=0;if(b.widgetGroupID){var k=e.attributesList,
f=e.getSelectedFilterCount();-1!==k.indexOf(gb.enums.BinningParams.SORT_ORDER.key)&&f--; -1!==k.indexOf(gb.enums.BinningParams.PAGE.key)&&f--}f?(a=d.noDealsFilterMessage||gb.resources.getString("gb_no_active_deals_on_filters"),c=!0):gb.widgetHelper&&"undefined"!==typeof gb.widgetHelper.callID[b.widgetID]&&gb.widgetHelper.callID[b.widgetID]!==gb.widgetHelper.callDataArray[b.widgetID].length||(a=d.noDealsMessage||gb.resources.getString("gb_no_results_to_show"))}return{message:a,isFiltersSelected:c}},
_getCurrentCategory:function(b){var a=gb.enums.CategoryFilters.ALL;if(gb.controller.isPaginatedMetadataCall(b)){var c=gb.widgets[b].widgetGroupID;if(!c)return;b=gb.filterControllerFactory.getFilterController(gb.widgets[b].widgetName).models[c].getSelectedFilters(!1,[gb.enums.DCSQueryParams.CATEGORIES,gb.enums.DCSQueryParams.PRIME_ACCESS_TYPE]);b.enforcedCategories?a=b.enforcedCategories[0]:b.primeAccessType&&(a=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS)}else a=gb.controller.widgetCurrentCategory[b];
return a},_getCurrentStates:function(b){var a=gb.enums.DealStates.AVAILABLE;if(gb.controller.isPaginatedMetadataCall(b)){var c=gb.widgets[b].widgetGroupID;if(!c)return;b=gb.filterControllerFactory.getFilterController(gb.widgets[b].widgetName).models[c].getSelectedFilters(!1,[gb.enums.DCSQueryParams.DEAL_STATE]);b.dealStates&&(a=b.dealStates);"object"===typeof a&&(a=gb.enums.DealStatesToFilterStates[a[0]])}else a=gb.controller.widgetCurrentStatus[b];a&&(a=a.toLowerCase());return a}})});n.declare("gb-share-manager");
n.when("A","GoldboxMobile3PAssets","gb-variation-view").register("gb-deal-view",function(h,r,g){return h.createClass({init:function(b){this.widgetView=b.widgetView;this.position=b.position;this.viewElementID="#"+gb.utils.getDealViewID(this.widgetView.widgetID,this.position);this.viewElement=this.widgetView.skinDomElement.find(this.viewElementID);this.viewOrientation=this.widgetView.viewOrientation;this.dealID=b.dealID;this.isDoubleCell=b.isDoubleCell;this.row=b.row;this.column=b.column;this.deal=
gb.controller.getDealDAO(this.dealID);this.modalClock=this.clock=this.truncatedShipSoldInfo=this.truncatedTitle=this.viewSkin=null},render:function(){if(!gb.controller.buyingDeals[this.dealID]){var b=this.widgetView.widgetID,a=gb.configManager.getWidgetViewConfig(b),c=a.useCssEllipsification;if(this.viewOrientation!==this.widgetView.viewOrientation){this.truncatedTitle=null;var d=this.deal.detail;d.truncatedDescription=null;d.restDescription=null}this.viewOrientation=this.widgetView.viewOrientation;
this.clock&&l.clearTimeout(this.clock.timeout);this.modalClock&&l.clearTimeout(this.modalClock.timeout);this.deal.detail.itemType===gb.enums.ItemTypes.VARIATION&&gb.widgets[b].widgetName===gb.enums.WidgetNames.ML_HERO?(this.variationView=this.variationView||new g({dealID:this.deal.dealID,widgetView:this.widgetView,isMiniDP:!1,position:this.position,dealView:this}),this.variationView.render()):(this.viewSkin=this._generateStateHTMLFromViewSubTemplates(),this.viewElement.html(this.viewSkin));this.renderTitle(c);
this.renderDescription();this._renderShipSold();this._handleDealActions(a);this.updateOptionsHTML();!gb.resources.deviceInfo.isCSS3Supported&&gb.configManager.getWidgetViewConfig(b).applyDealRowHeight&&(a=0===this.position%2?this.position+1:this.position-1,gb.utils.setDealViewHeightToOriginal(b,this.position),gb.utils.setDealViewHeightToOriginal(b,a),c=this.viewElement.closest("."+gb.enums.WidgetViewIDs.CONTENTROW),c.height(""),c.height(c.height()),gb.utils.setDealViewHeightToDealRowHeight(b,this.position),
gb.utils.setDealViewHeightToDealRowHeight(b,a));this.renderEldaradoUtil();gb.metricsManager.recordRender(b,this.dealID,this.position)}},_generateStateHTMLFromViewSubTemplates:function(b){var a=this.widgetView.widgetID,c=gb.utils.getStateTemplateName(this.deal.dealState,this.deal.dealType),d=gb.utils.getViewTemplatesForState(this.deal),e=gb.configManager.getWidgetViewConfig(a);b=b||{};var f=b.stateTemplateGroup||gb.templateManager.TemplateGroups.DEAL_STATE,k=b.viewTemplateGroup||gb.templateManager.TemplateGroups.DEAL_VIEW,
m=b.viewTemplateData||gb.viewComponentBuilder.getDealViewTemplateData(this);m.viewStyleInfo=gb.utils.getDealViewStyleInformation(this.deal,m,e);var g=this;b=b.stateTemplateDataBuilderFn||function(a){return gb.viewComponentBuilder.getDealStateTemplateData(g,a)};d=gb.templateManager.getWidgetHTML({widgetID:a,templateGroup:k,templateNames:d,data:m});d=b(d);d.viewStyleInfo=gb.utils.getDealViewStyleInformation(this.deal,m,e);a=gb.templateManager.getWidgetHTML({widgetID:a,templateGroup:f,templateName:c,
data:d});return a=gb.accessibility.generateDealViewAccessibilityFlow(this,a)},enableOptions:function(b){b=h.$(b);var a={header:b.find("#"+gb.enums.dealViewIDs.OPT_HEADER),contents:b.find("#"+gb.enums.dealViewIDs.OPT_CONTENT),footer:b.find("#"+gb.enums.dealViewIDs.OPT_FOOTER)};this.viewElement.find(".dealAction").click(function(c){gb.controller.getBottomSheet().render(a);c.stopPropagation();c.preventDefault()})},_handleDealActions:r._.once(function(b){h.declarative("gbdeal-addtocart","click",function(a){a=
a.data;var c=a.asin;gb.metricsManager.recordAction(a.widgetID,a.dealID,"ADD_TO_CART",a.position);gb.controller.dealDAOs[a.dealID].checkingDealStatus=!0;gb.controller.refreshDealView(a.dealID,c);gb.controller.processActionableClick({widgetID:a.widgetID,dealID:a.dealID,dealType:a.dealType,dealState:a.dealState,asin:c,offerID:a.offerID,legacyDealID:a.legacyDealID,quantity:1});a.isSponsored&&gb.service.logPicassoClick(a)});h.declarative("gbdeal-watchdeal",b.enableClickOnlyWatch?"click":"click touchstart",
function(a){var c=a.data.dealID,d=a.data.widgetID,b=gb.controller.dealDAOs[c];if(gb.utils.isWatchButtonEnabled(b,d)){var f=gb.controller.watchDealView;!f||b.isDealWatched||gb.resources.customerData.isWatchDealPopupMarked||(f.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP),gb.watchDealService.modifyPopupStatus({action:gb.enums.SembuActions.SET_COOKIE,type:gb.enums.DataTypes.BOOL,value:1,key:f.key,domain:f.domain}),gb.resources.customerData.isWatchDealPopupMarked=!0);gb.metricsManager.recordAction(d,
c,"WATCH_DEAL",a.data.position);gb.controller.watchDeal(d,c)}else gb.controller.refreshDealView(c)});gb.clientName===gb.enums.MobileClients.PC&&h.declarative("gbdeal-watchdeal","mouseenter mouseleave",function(a){var c=a.data.dealID,d=a.data.widgetID,b=gb.controller.dealDAOs[c];if(gb.controller.watchDealView&&b.isDealWatched&&!b.processWatchAction){var f=a.$target.closest("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON+c);gb.controller.watchDealView.triggerMouseEventsOnWatchingDeal(c,f,a.type);n.when("A",
"a-modal").execute(function(b,e){(b=e.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+c))&&b.isActive()&&(b.$popover.find("."+gb.enums.WatchDealViewIDs.MINI_DP_WATCH_BUTTON_MAPPING[gb.widgets[d].widgetName]),gb.controller.watchDealView.triggerMouseEventsOnWatchingDeal(c,f,a.type))})}});h.declarative("gbdeal-joinwaitlist","click",function(a){a=a.data;var c=a.asin;gb.metricsManager.recordAction(a.widgetID,a.dealID,"JOIN_WAITLIST",a.position);gb.controller.dealDAOs[a.dealID].checkingDealStatus=!0;gb.controller.refreshDealView(a.dealID,
c);gb.controller.processActionableClick({widgetID:a.widgetID,dealID:a.dealID,dealType:a.dealType,dealState:a.dealState,asin:c,offerID:a.offerID,legacyDealID:a.legacyDealID,action:gb.metrics.refTags.joinWaitlist})});h.declarative("gbdeal-checkout","click",function(a){l.location.href="/gp/cart/view.html"});h.declarative("gbdeal-add-to-wishlist","click",function(a){a=a.data;gb.controller.dealDAOs[a.dealID].addingToWishList=!0;gb.controller.refreshDealView(a.dealID);gb.controller.addItemToWishList({dealID:a.dealID,
asin:a.asin})});h.declarative("gbdeal-view-wishlist","click",function(a){l.location.href="/gp/registry/wishlist/"+a.data.defaultRegistryID});h.declarative("gbdeal-seeoptions","click",function(a){var c=gb.widgets[a.data.widgetID].dealViews[a.data.dealID][a.data.position];gb.metricsManager.recordAction(a.data.widgetID,a.data.dealID,"SEE_MORE",a.data.position);c.renderMiniDetailPage(a.data.asin);a=gb.metrics.generateRef(a.data.widgetID,gb.metrics.refTags.miniDpPopOver,[a.data.dealID]);gb.metrics.recordRefViaAjax(a)});
h.declarative("gb-image","click tap",function(a){var c=gb.widgets[a.data.widgetID].dealViews[a.data.dealID][a.data.position],b=gb.utils.shouldShowMiniDetailPageModal(c);gb.metricsManager.recordAction(a.data.widgetID,a.data.dealID,"IMAGE",a.data.position);b?(c.renderMiniDetailPage(),a=gb.metrics.generateRef(a.data.widgetID,gb.metrics.refTags.miniDpPopOver,[a.data.dealID]),gb.metrics.recordRefViaAjax(a)):l.location.href=a.data.redirectionUrl});h.declarative("gbdeal-actionrecord","click",function(a){var c=
a.data.customURL;gb.metricsManager.recordAction(a.data.widgetID,a.data.dealID,a.data.actionType,a.data.position);c&&(l.location.href=c)});h.declarative("gbdeal-mashshare","click",function(a){var c=a.data.widgetID,b=a.data.dealID;c&&b&&gb.controller.getDealDAO(b)&&(gb.metricsManager.recordAction(c,b,"SHARE_DEAL",a.data.position),gb.controller.closeBottomSheet(),gb.controller.getShareManager().shareDeal(c,b))})}),renderTitle:function(b){var a=this.widgetView.widgetID;if(!b&&!gb.configManager.getWidgetViewConfig(a).disableJsEllipsification&&
(b=this.viewElement.find("#"+gb.enums.dealViewIDs.TITLE),b.length))for(var c=0;c<b.length;c++){var d=h.$(b[c]);this._truncateText(d,"truncatedTitle");gb.configManager.getWidgetViewConfig(a).enableAutoTitleAdjustment&&d.addClass("autoHeight")}},renderDescription:function(){var b=this.viewElement.find("#"+gb.enums.dealViewIDs.DESC_ABBR);if(b.length){var b=h.$(b[0]),a=this.deal.detail;if(!a.truncatedDescription){var c=b.html().trim();if(c){var d=!0;if(gb.resources.customerData.realm===gb.enums.Realms.CN||
gb.resources.customerData.realm===gb.enums.Realms.JP)d=!1;gb.utils.ellipsify({jQuery:h.$,el:b,removeDots:!0,wordsIntact:d});a.truncatedDescription=b.html().trim();a.restDescription=c.substr(a.truncatedDescription.length);a.restDescription&&(b=this.viewElement.find("#"+gb.enums.dealViewIDs.DESC_REST),h.$(b[0]).html(a.restDescription))}}a.restDescription&&(a=this.viewElement.find("."+gb.enums.dealViewClasses.DESC_EXPANDER),0<a.length&&a.removeClass("aok-hidden"))}},_renderShipSold:function(){var b=
this.viewElement.find("#"+gb.enums.dealViewIDs.SHIP_SOLD);0<b.length&&this._truncateText(b,"truncatedShipSoldInfo");gb.configManager.getWidgetViewConfig(this.widgetView.widgetID).enableAutoTitleAdjustment&&b.addClass("autoHeight")},_truncateText:function(b,a){this[a]?b.html(this[a]):(gb.utils.ellipsify({jQuery:h.$,el:b}),this[a]=b.html())},signalMarker:function(b,a){if(gb.csm&&b&&gb.csm.recordedMarkers&&!gb.csm.recordedMarkers[b]){a=a&&a.recordMarkerFeature?!0:!1;var c=function(){gb.csm.signalMarker(b)},
d=this.viewElement.find("img");d.length&&d[0]&&d[0].complete?c():d.load(c).error(c);a&&(gb.csm.recordedMarkers[b]=!0,n.register(b))}},renderMiniDetailPage:function(b){var a=this,c=a.deal,d=c.dealID,e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+d,f=gb.resources.getImage("spinner");n.when("A","a-modal","ready").execute(function(k,h){k={name:e,header:gb.resources.getString("gb_deal_details"),width:"655",inlineContent:"\x3cimg src\x3d"+f+"\x3e"};var l=a.viewElement.find("#"+gb.enums.dealViewIDs.IMAGE),n=h.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+
d);n||(n=h.create(l,k),n.show());c.detail.itemType===gb.enums.ItemTypes.VARIATION?(a.variationView=a.variationView||new g({dealID:d,widgetView:a.widgetView,asinID:b,isMiniDP:!0,modalInstance:n,position:a.position,dealView:a}),a.variationView.render()):(a.viewSkin=a._generateStateHTMLFromViewSubTemplates({viewTemplateGroup:gb.templateManager.TemplateGroups.MINI_DP_DEAL_VIEW,stateTemplateGroup:gb.templateManager.TemplateGroups.MINI_DP_DEAL_STATE,viewTemplateData:gb.viewComponentBuilder.getMiniDPViewTemplateData(a,
n,b)}),n.updateContent(a.viewSkin).lock().show(),gb.controller.popOverVisible=!0)});var k="a:popover:beforeHide:"+e;n.when("A").execute(function(a){a.on(k,function(){n.when("GBEventManager").execute(function(a){a.trigger("popoverClosed");gb.controller.popOverVisible=!1})})})},renderEldaradoUtil:function(){var b=gb.utils.getDealsInternalUrl(this.dealID);if(b){var a=document.createElement("a");a.href=b;a.setAttribute("value","View Deals Internal Website");a.style.backgroundImage="url('http://g-ec2.images-amazon.com/images/G/01/goldbox/gb_icon_tiny._V192570393_.gif')";
a.style.width="30px";a.style.height="26px";a.style.border="none";a.style.display="block";a.style.position="absolute";a.style.top=0;a.style.zIndex=100;this.viewElement.css("position","relative");this.viewElement.append(a)}},updateOptionsHTML:function(){var b=this.widgetView.widgetID,a=gb.configManager.getWidgetViewConfig(b);gb.resources.deviceInfo.isPhone&&a.supportWatch&&(b=gb.templateManager.getWidgetHTML({widgetID:b,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"dealOptions",
data:gb.viewComponentBuilder.getDealOptionsTemplateData(this)}),this.enableOptions(b))},updateStatusMessage:function(b){var a=this,c=this.viewElement.find(".dealButtonContainer .dealStatusMessageHolder");c&&"function"===typeof c.text&&c.text(b);a.variationView&&n.when("A","a-modal").execute(function(c,e){(c=e.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+a.dealID))&&c.isActive()&&c.$popover&&(c=c.$popover.find(".dealButtonContainer .dealStatusMessageHolder"),0<c.length&&c.text(b))})},updateWatchDealStatusMessage:function(b){this.viewElement.find("#"+
gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+this.dealID).html(b)}})});n.when("A","GoldboxMobile3PAssets").register("gb-variation-view",function(h,l){var g=l._;return h.createClass({init:function(b){this.dealID=b.dealID;this.viewSkin=null;this.isMiniDP=b.isMiniDP;this.asinID=b.asinID;this.unavailableAsinSelected=!1;this.selectedDimension={};this.modalInstance=b.modalInstance;this.dealView=b.dealView},render:function(){var b;b=this.asinID;var a=this.dealView.deal;b=this.selectedDimension?a.getVariationAsin(this.selectedDimension):
b?a.getAsinDAO(b):null;this.modalFirstLoad=!0;this.update(b);this.handleDropDownActions();this.modalFirstLoad=!1},update:function(b){var a=this,c=a.modalInstance,d=a.isMiniDP;b&&b.status.itemState!==gb.enums.DealStates.SOLDOUT?(g.each(b.variationDimensions,function(c,b){a.selectedDimension[b]=c}),a.unavailableAsinSelected=!1):a.unavailableAsinSelected=!0;var e=gb.templateManager.TemplateGroups.DEAL_VIEW,f=gb.templateManager.TemplateGroups.DEAL_STATE,k=gb.viewComponentBuilder.getDealViewTemplateData(a.dealView,
b);d&&(e=gb.templateManager.TemplateGroups.MINI_DP_DEAL_VIEW,f=gb.templateManager.TemplateGroups.MINI_DP_DEAL_STATE,k=gb.viewComponentBuilder.getMiniDPViewTemplateData(a.dealView,c,b));a.viewSkin=a.dealView._generateStateHTMLFromViewSubTemplates({viewTemplateGroup:e,stateTemplateGroup:f,viewTemplateData:k,stateTemplateDataBuilderFn:function(c){return gb.viewComponentBuilder.getDealStateTemplateData(a.dealView,c,b)}});d&&c?c.updateContent(a.viewSkin).lock().show():(a.dealView.viewElement.html(a.viewSkin),
a.dealView.updateOptionsHTML())},handleDropDownActions:function(){var b=this,a=b.dealID,c=b.dealView.deal;g.keys(c.items);n.when("A","a-dropdown").execute(function(d,e){d.on("a:dropdown:select",function(d){if(d.id.slice(d.id.length-a.length,d.id.length)===a){b.selectedDimension={};var k;b.selectedDimension[d.name]=decodeURIComponent(d.value);var m=c.items[g.keys(c.items)[0]];g.each(m.variationDimensions,function(a,k){k!==d.name&&(a=k.replace(/\s/g,"")+c.dealID,a=encodeURIComponent(a),a=a.replace(/%/g,
"\\%"),a=decodeURIComponent(e.getSelect(a).val()),b.selectedDimension[k]=a)});k=b.getSelectorData();g.isEmpty(k)&&g.find(b.selectedDimension,function(a,c){if(c!==d.name)return b.selectedDimension[c]=gb.resources.getString("csld-select"),k=b.getSelectorData(),!g.isEmpty(k)});b._setDropdownValueBasedOnSelection(k,e,d);m=c.getVariationAsin(b.selectedDimension);b.update(m)}})});n.when("A").execute(function(d,e){d.on("a:popover:dismiss:"+gb.enums.WidgetViewIDs.MINI_DP_MODAL+a,function(){c.detail.itemType===
gb.enums.ItemTypes.VARIATION&&(b.selectedDimension={})})})},getSelectorData:function(){var b=this,a={},c=this.dealView.deal;g.each(b.selectedDimension,function(d,e){g.each(c.items,function(c){b.isMatchingCombination(c)&&g.each(c.variationDimensions,function(c,b){b!==e&&(a[b]||(a[b]=[]),a[b].push(c))})})});return a},isMatchingCombination:function(b){var a=!0;g.each(this.selectedDimension,function(c,d){c!==b.variationDimensions[d]&&c!==gb.resources.getString("csld-select")&&(a=!1)});return a},_setDropdownValueBasedOnSelection:function(b,
a,c){var d=this;g.each(b,function(e,f){if(f!==c.name){var k=f.replace(/\s/g,"")+d.dealID,k=encodeURIComponent(k),k=k.replace(/%/g,"\\%");1===e.length?(a.getSelect(k).setValue(e[0]),d.selectedDimension[f]=e[0]):-1===b[f].indexOf(d.selectedDimension[f])&&(a.getSelect(k).setValue(gb.resources.getString("csld-select")),d.selectedDimension[f]=gb.resources.getString("csld-select"))}})}})});n.when("A","GoldboxMobile3PAssets").register("gb-viewport-manager",function(h,n){var g=n._;return h.createClass({init:function(b){this.lastDealPosition=
this.firstDealPosition=this.lastScrollTop=-1;this.widgetContentPage=1;this.isScrollBound=!1;this.scrollCallback=null;this.widgetID=b.widgetID;this.pageSize=b.pageSize;this.totalDeals=b.totalDeals;this.domElementID=b.domElementID;this.pageScroll();this.attachScroll();this.shouldGarbageCollect=!0;this.pagesToAvoidInGC=0;b=gb.resources.getFeature("gb_image_load_fix");gb.enums.Weblabs.TREATMENTS.T1===b&&(this.pagesToAvoidInGC=1)},detachScroll:function(){this.isScrollBound&&null!==this.scrollCallback&&
(h.$(l).unbind("scroll",this.scrollCallback),this.isScrollBound=!1,this.scrollCallback=null)},attachScroll:function(){this.isScrollBound||null!==this.scrollCallback||(this.scrollCallback=g.bind(this.pageScroll,this),gb.subnavController&&g.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&(this.subnavPage=gb.controller.schedulingParams[this.widgetID].subnavPage,gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&this.setHidingHeaderVariables()),!gb.subnavController||
g.isNumber(this.subnavPage)&&this.subnavPage!==gb.subnavController.currentPageNumber||h.$(l).scrollTop(0),h.$(l).bind("scroll",this.scrollCallback),this.isScrollBound=!0)},clearHeaderInSubnav:function(){gb.subnavController&&gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.widgetHeaderInSubnav&&this.disableHidingWidgetHeaderOnScroll(),this.subnavPage===gb.subnavController.currentPageNumber&&gb.subnavController.subnavSlideCompletelyDown())},
setHidingHeaderVariables:function(){gb.subnavController&&gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.subnavContainer=document.querySelector(gb.subnavController.SubnavIDs.SubnavContainer),this.widgetHeaderHolder=h.$(gb.subnavController.SubnavIDs.SubnavWidgetHolder+this.subnavPage),this.widgetHeaderInSubnav=!1,this.subnavContainerHeightDiv=h.$(gb.subnavController.SubnavIDs.SubnavHeightDiv+this.subnavPage),this.enableHidingWidgetHeaderOnScroll())},pageScroll:function(){var b;
if(!g.isNumber(this.subnavPage)||!gb.subnavController||gb.subnavController.currentPageNumber===this.subnavPage||-1===this.lastScrollTop){b=h.$(l).scrollTop();var a=this.lastScrollTop;this.lastScrollTop=b;b<a?this.setWidgetCurrentPage(gb.enums.Direction.UP):b>a&&this.setWidgetCurrentPage(gb.enums.Direction.DOWN);this.handlePageChange()}},handlePageChange:function(){var b=gb.controller.widgetCurrentPage[this.widgetID],a=this.getCurrentPage();b!==a&&(gb.controller.widgetCurrentPage[this.widgetID]=a,
b=gb.widgets[this.widgetID].totalPages,a>=b-1&&gb.widgets[this.widgetID].hideScrollContentLoader(),a!==b&&(gb.controller.trigger("WidgetPageScroll",this.widgetID,a+1),!0===this.shouldGarbageCollect&&this.garbageCollectAndReRender()))},getCurrentPage:function(){return this.widgetContentPage},setWidgetCurrentPage:function(b){for(var a=this.widgetContentPage;gb.utils.isElementInViewPort(gb.utils.getPageID(this.widgetID,a))===gb.enums.ViewPortPresence.ABSENT;)if(b===gb.enums.Direction.UP&&0<a)--a;else if(b===
gb.enums.Direction.DOWN&&a<=this.totalDeals/this.pageSize)++a;else{a=1;break}this.widgetContentPage=a},garbageCollectAndReRender:function(){this.firstDealPosition=this.widgetContentPage>this.pagesToAvoidInGC+1?(this.widgetContentPage-(this.pagesToAvoidInGC+1))*this.pageSize:0;this.lastDealPosition=(this.widgetContentPage+this.pagesToAvoidInGC)*this.pageSize-1;this.lastDealPosition>=this.totalDeals&&(this.lastDealPosition=this.totalDeals-1);this.renderedDealViews=this.renderedDealViews||[];var b=gb.metadata.getAllDisplayableDealIDs(this.widgetID).slice(this.firstDealPosition,
this.lastDealPosition),a=g.difference(this.renderedDealViews,b);this.renderedDealViews=b;gb.widgets[this.widgetID].reRenderDealViews(this.firstDealPosition,this.lastDealPosition);gb.garbageCollector.deepCleanDealViews(this.widgetID,a)},enableHidingWidgetHeaderOnScroll:function(){gb.subnavController&&gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.widgetHeader=h.$("#"+gb.enums.WidgetHeaderIDs.WidgetHeader+this.widgetID),this.widgetHeaderHolder.html(this.widgetHeader.html()),
this.widgetHeader.html(""),this.subnavContainerHeightDiv.height(this.subnavContainer.getBoundingClientRect().height),this.widgetHeaderInSubnav=!0)},disableHidingWidgetHeaderOnScroll:function(){this.widgetHeader.html(this.widgetHeaderHolder.html());this.widgetHeaderHolder.html("");this.widgetHeaderInSubnav=!1;this.subnavContainerHeightDiv.height(this.subnavContainer.getBoundingClientRect().height)}})});n.declare("gb-page-refresher");n.when("A","GoldboxMobile3PAssets","gb-filter-item-view","gb-deal-view",
"gb-viewport-manager","gb-csm","gb-page-refresher").register("gb-widget-view",function(h,r,g,b,a,c,d){var e=r._;return h.createClass({init:function(a){this.widgetID=a.widgetID;this.widgetGroupID=a.widgetGroupID;this.widgetName=a.widgetName;this.domElementID=a.domElementID;this.dealViews={};this.fullyRenderedPages=[];this.pageHandlers=[];this.filterViews=[];this.skinDomElement=null;this.isRefineRender=!1;this.totalPages=this.viewOrientation=null;this.isRetryInProgress=this.isGDMFailing=this.isCFRecorded=
!1;this.minDealViewWidth=this.getMinDealWidth();this.viewPortManager=this.dealsPerRow=null;this.nextPositionToRender=0;this.filterJSONData={};this.nextAdSlotToRenderIndex=-1;this.isMaxDealLimitReached=!1;this.filterController=gb.filterControllerFactory.getFilterController(a.widgetName);this.initializeView()},initializeView:function(){this.skinDomElement=h.$("#"+this.domElementID);this.dealsPerRow=this.getDealsPerRow();var a=gb.controller.schedulingParams[this.widgetID];e.isEmpty(a.adSlots)||(this.nextAdSlotToRenderIndex=
0);var c=null;if(gb.subnavController&&e.isNumber(a.subnavPage)&&(gb.subnavController.widgetsOnSubnavPage[a.subnavPage]||(c=parseInt(gb.subnavController.idleTimeRefresh,10)),a.allowWidgetRefresh)){var b=a.subnavPage;gb.subnavController.widgetsOnSubnavPage[b]=gb.subnavController.widgetsOnSubnavPage[b]||{};gb.subnavController.widgetsOnSubnavPage[b][a.subnavPageSlot]=this}if(gb.subnavController&&(a=parseInt(gb.subnavController.pageRefreshInterval,10),b=parseInt(gb.subnavController.tabRefreshElapseTime,
10),c||a||b))try{this.pageRefresher=new d(c,this.widgetID),this.pageRefresher.initializeVisibilityHandler(a)}catch(g){n.log("PageRefresher works only on mobile platfrom!","ERROR","GoldboxMobileAssets")}gb.configManager.getWidgetViewConfig(this.widgetID).disableOrientationChange||this.enableOrientationChange();this._handleRefreshClick()},enableRefine:function(){var a=this;a.skinDomElement.find("#"+gb.enums.WidgetViewIDs.REFINE).click(function(){a.renderRefine()});a.filterAndSortEventsCache=a.filterAndSortEventsCache||
{};a.filterAndSortEventsCache[a.widgetID]||(a.filterAndSortEventsCache[a.widgetID]=e.once(function(){h.declarative("gbfilter-click-"+a.widgetID,"click",function(c){c.data.filterType===gb.enums.FilterConstants.CUSTOM_FILTER?a.renderFilter({isSortFilter:!1,isCustomFilter:!0}):a.renderFilter({isSortFilter:!1})});h.declarative("gbsort-click-"+a.widgetID,"click",function(c){a.renderFilter({isSortFilter:!0})})}));a.filterAndSortEventsCache[a.widgetID].call()},enableOrientationChange:function(){gb.clientName!==
gb.enums.MobileClients.PC&&(this.viewOrientation=gb.utils.getDeviceOrientation(this.widgetID));h.$(l).resize(e.bind(this.resizeWindow,this))},enableInfiniteScroll:function(){var c=gb.controller.schedulingParams[this.widgetID],b=!0;e.each(c.filterConfig,function(a){if(a.attr===gb.enums.BinningParams.PAGE.key)return b=!1});if(b&&!this.viewPortManager){var d=gb.metadata.getAllDisplayableDealIDs(this.widgetID);this.viewPortManager=new a({widgetID:this.widgetID,pageSize:c.pageSize,totalDeals:d.length,
domElementID:this.domElementID})}},getMinDealWidth:function(){return gb.enums.Constants.MIN_TABLET_VIEW_WIDTH},getDealsPerRow:function(){var a=gb.configManager.getDealViewConfig(this.widgetID),c=gb.configManager.getWidgetViewConfig(this.widgetID);return gb.resources.deviceInfo.isPhone?this.viewOrientation===gb.enums.ClientOrientation.LANDSCAPE?a.dealsPerRowL||gb.enums.Constants.PHONE_LANDSCAPE_COLUMN_COUNT:a.dealsPerRowP||gb.enums.Constants.PHONE_PORTRAIT_COLUMN_COUNT:gb.utils.getDealsPerRow(h.$(l).width(),
this.minDealViewWidth,c.hasMargin,c.supportEvenColumnsOnly)},resizeWindow:function(){var a=gb.configManager.getWidgetViewConfig(this.widgetID).allowFlexRendering;if(!this.isRefineRender){gb.controller.watchDealView&&(gb.controller.watchDealView.isWatchDealPopupRendered=!1);var c=this.dealsPerRow;this.dealsPerRow=this.getDealsPerRow();if(gb.clientName===gb.enums.MobileClients.PC){if(c===this.dealsPerRow)return}else{c=gb.utils.getDeviceOrientation(this.widgetID);if(c===this.viewOrientation)return;var b=
gb.configManager.getDealViewConfig(this.widgetID);this.viewOrientation=c;this.viewPortManager&&(this.viewPortManager.lastScrollTop=c===gb.enums.ClientOrientation.LANDSCAPE?Math.ceil(this.viewPortManager.lastScrollTop*b.dealsPerRowP/b.dealsPerRowL):Math.ceil(this.viewPortManager.lastScrollTop*b.dealsPerRowL/b.dealsPerRowP))}a?(a=this.skinDomElement.find(".dealView"),0<a.size()&&(this.viewOrientation===gb.enums.ClientOrientation.PORTRAIT?a.width(a.eq(0).data("pwidth")):a.width(a.eq(0).data("lwidth"))),
this.viewPortManager&&h.$(l).scrollTop(this.viewPortManager.lastScrollTop),this._navigateToWidget()):(this.renderContent(!0),gb.controller.watchDealView&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP))}},renderWireFrame:function(){this.isRefineRender=!1;gb.garbageCollector.clearDealViews(this.widgetID);e.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&
gb.widgets[this.widgetID]&&gb.widgets[this.widgetID].viewPortManager&&gb.widgets[this.widgetID].viewPortManager.clearHeaderInSubnav();this.totalCellsRendered=0;var a=gb.viewComponentBuilder.getWidgetViewTemplateData(this);this.filterViews=[];var c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",data:a});this.skinDomElement.html(c);e.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&
gb.widgets[this.widgetID]&&gb.widgets[this.widgetID].viewPortManager&&gb.widgets[this.widgetID].viewPortManager.enableHidingWidgetHeaderOnScroll();this._handleFilterChange();this._handleClearFilters();gb.controller.schedulingParams[this.widgetID].enablePagination&&this.renderPagination(a)},showLoading:function(){if(gb.subnavController&&(h.$(gb.subnavController.subnavPages[gb.subnavController.currentPageNumber]).find("."+gb.enums.WidgetViewIDs.LOADING).length||gb.subnavController.showRefresher))this.skinDomElement.html("");
else{var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetLoading"});this.skinDomElement.html(a)}},hideScrollContentLoader:function(){this.skinDomElement.find("."+gb.enums.WidgetViewIDs.SCROLL_CONTENT_LOADER).css("display","none")},renderContent:function(a){var c=null;a&&(c=this.viewPortManager?this.viewPortManager.lastScrollTop:null,this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).empty(),this.skinDomElement.find("#"+
gb.enums.WidgetViewIDs.FILTERS).empty(),this.filterViews=[],gb.garbageCollector.clearViewPort(this.widgetID),gb.garbageCollector.clearDealViews(this.widgetID));var d=gb.viewComponentBuilder.getWidgetViewTemplateData(this,a),g=gb.metadata.getAllDisplayableDealIDs(this.widgetID),n=gb.controller.schedulingParams[this.widgetID],r=gb.enums.WidgetViewIDs.CONTENT,d=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",
data:d});this.totalPages=Math.ceil(g.length/n.pageSize);n.enablePagination?this.skinDomElement.find("#"+r).html(d):this.skinDomElement.find("#"+r).append(d);for(var d=gb.controller.widgetCurrentPage[this.widgetID],r=n.pageSize,d=gb.controller.schedulingParams[this.widgetID].eventID||n.enablePagination?r*(d-1):0,E=g.length<this.dealsPerRow?g.length:this.dealsPerRow;this.nextPositionToRender<=gb.watcher.lowestDealIDWatchedIndex[this.widgetID]&&d+this.nextPositionToRender<g.length;){var u=g[d+this.nextPositionToRender],
v=new b({dealID:u,widgetView:this,position:this.nextPositionToRender});this.dealViews[u]=this.dealViews[u]||{};this.dealViews[u][this.nextPositionToRender]=v;v.render();this._publishLatencyMetrics(this.nextPositionToRender,gb.watcher.lowestDealIDWatchedIndex[this.widgetID],E,v);this._recordWidgetCF(n.featureScope);this.nextPositionToRender++}n.maxLimitDeals&&this.nextPositionToRender>=n.maxLimitDeals&&this.renderMaxLimitDealTemplate();g=n.adSlots;if(!e.isEmpty(g))for(;this.nextAdSlotToRenderIndex<
g.length;)if(d=gb.utils.getAdRowID(this.widgetID,this.nextAdSlotToRenderIndex),E=this.skinDomElement.find("#"+d),E.length)d=gb.viewComponentBuilder.getAdRowViewData(this),d=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"adSlot",data:d}),E.html(d),this.nextAdSlotToRenderIndex++;else break;!n.enforceLimitedDeals&&!n.enablePagination&&0<r&&this.enableInfiniteScroll();n.enableCategoryRefine&&this.enableRefine();this.widgetName!==
gb.enums.WidgetNames.TAB_GRID_HERO||n.enforceLimitedDeals||(r=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTER_CONTENT),r.html(this._getRefineHTML()),gb.accessibility.trigger("AccessibilityAction","updateRefineView",{filterEl:r}));this._renderFilterViews();a&&this.viewPortManager&&(c&&(this.viewPortManager.lastScrollTop=c),void 0!==n.subnavPage&&null!==n.subnavPage?h.$(gb.utils.getSubnavPageElementFromDomID(this.domElementID)).scrollTop(this.viewPortManager.lastScrollTop):h.$(l).scrollTop(this.viewPortManager.lastScrollTop));
this._publishWidgetLatencyMetrics(n.featureScope);this._navigateToWidget();this._renderEllipsifiedTitle();this.applyWidgetSpecificStyle()},_publishLatencyMetrics:function(a,c,b,d){100===parseInt(this.widgetID,10)&&(a<b&&(a===b-1?d.signalMarker("af",{recordMarkerFeature:!0}):d.signalMarker("af")),a===c-1?d.signalMarker("cf",{recordMarkerFeature:!0}):d.signalMarker("cf"))},showExcessiveTrafficMessage:function(){gb.metadata.sortedDealIDs[this.widgetID]=[];gb.watcher.unwireStatusRefresh(gb.watcher.viewPort[this.widgetID]);
this.renderWireFrame();this.renderContent(!0)},applyWidgetSpecificStyle:function(){h.$("#filterContent").css("background","white");h.$("#categoryRefineContent").parent().css("background","white");this.widgetName===gb.enums.WidgetNames.MG_HERO&&(this.skinDomElement.find(".widgetContentRow.noBorder").removeClass("noBorder"),this.skinDomElement.find(".widgetContentRow:not(:has(*\x3e*))").addClass("noBorder"))},reRenderDealViews:function(a,c){if(!(c<=a))for(var d=gb.metadata.getAllDisplayableDealIDs(this.widgetID);a<
c;a++){var e=d[a],g=null;this.dealViews[e]&&this.dealViews[e][a]&&(g=this.dealViews[e][a]);var h=gb.garbageCollector.reRenderGCElement(this.widgetID,e,a);h?(h.clock&&(h.clock=gb.utils.heroTimer(h.clock.dealDate,h.clock.viewElement,h.clock.spanID,gb.configManager.getWidgetViewConfig(this.widgetID).forceApplyIncartTimer)),this.dealViews[e]=this.dealViews[e]||{},this.dealViews[e][a]=h,gb.metricsManager.recordAction(this.widgetID,e,"GC_RENDER",a)):g&&0!==g.viewElement.children("a").length||(g||(g=new b({dealID:e,
widgetView:this,position:a}),this.dealViews[e]=this.dealViews[e]||{},this.dealViews[e][a]=g),g.render())}},_navigateToWidget:function(){var a=gb.controller.schedulingParams[this.widgetID].widgetAnchorName;a&&l.location.hash==="#"+a&&e.defer(function(){h.$("html, body").scrollTop(h.$("#"+a).offset().top)})},_renderFilterViews:function(){var a=this;a.isFilterEnabled()&&(a.widgetName!==gb.enums.WidgetNames.MG_HERO||e.isEmpty(a.filterViews))&&e.each(gb.controller.schedulingParams[a.widgetID].filterConfig,
function(c){c=new g({},{filterConfig:c,widgetView:a});a.filterViews.push(c);gb.configManager.getWidgetViewConfig(a.widgetID).showBottomSheetFilter||c.render()})},_getRefineHTML:function(){var a=this.isEventsWidget()?"filter":"refine",c=gb.viewComponentBuilder.getRefineTemplateData(this);return gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:a,data:c})},renderRefine:function(a){var c=this;c.isRefineRender=!0;var b=c._getRefineHTML();
if(c.isEventsWidget()){var b=h.$("\x3cdiv\x3e").html(b),d=h.$("#"+gb.enums.WidgetViewIDs.FILTERS,c.skinDomElement).html();h.$("#"+gb.enums.WidgetViewIDs.FILTERS,b).html(d);b=b.html()}c.skinDomElement.hide();a?h.$("#"+a).html(b):c.skinDomElement.html(b);c.skinDomElement.slideDown();c.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CANCEL).click(function(a){a.preventDefault();c.skinDomElement.slideUp(function(){c.skinDomElement.show();c.renderWireFrame();c.renderContent(!0)})})},renderPagination:function(){var a=
gb.viewComponentBuilder.getPaginationTemplateData(this),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"pagination",data:a});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PAGINATION_ROW).html(a);this._handlePageChange()},_handleFilterChange:e.once(function(){h.declarative("refine","click",function(a){a.$event.preventDefault();var c=a.data.widgetID,b=a.$target.closest("[data-status]").data("status");a=a.$target.closest("[data-category]").data("category");
b?(gb.controller.trigger("WidgetStatusChange",c,b),gb.widgets[c].renderRefine(gb.enums.WidgetViewIDs.FILTER_CONTENT),gb.widgets[c].enableInfiniteScroll()):a&&gb.controller.trigger("WidgetCategoryChange",c,a);(b||a)&&n.when("a-popover").execute(function(a){gb.widgets[c].isRefineRender=!1;(a=a.get(gb.enums.WidgetViewIDs.REFINE_POPOVER_NAME))&&a.hide()})})}),_handleRefreshClick:e.once(function(){h.declarative("refresh-widget","click",function(a){a.$event.preventDefault();gb.widgets[a.data.widgetID].refreshWidget()})}),
_handlePageChange:e.once(function(){h.declarative("gbfilter-pagination","click",function(a){a.$event.preventDefault();var c=a.data.widgetID,b=parseInt(a.data.currentPage,10),d=parseInt(a.data.totalPages,10),e=a.$target.closest("[data-page]").data("page");e||(a=a.$target[0].href&&a.$target[0].href.split("#")[1],a===gb.enums.PaginationDummyURLs.PREV&&1<b?e=b-1:a===gb.enums.PaginationDummyURLs.NEXT&&b<d&&(e=b+1));e&&(gb.controller.widgetCurrentPage[c]=e,c&&!gb.widgets[c].isEventsWidget()&&(gb.controller.trigger("WidgetPageUpdate",
c,!0),gb.controller.updateAppliedFilters(c)))})}),_handleClearFilters:e.once(function(){h.declarative("clear-refine","click",function(a){a.$event.preventDefault();a=a.data.widgetID;gb.controller.widgetCurrentStatus[a]=gb.enums.StatusFilters.AVAILABLE;gb.controller.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;gb.controller.widgetCurrentPage[a]=1;gb.controller.trigger("WidgetPageUpdate",a,!0);gb.controller.updateAppliedFilters(a)})}),scrollToWidgetTop:function(a){a||(a=0);h.$("html,body").animate({scrollTop:this.skinDomElement.offset().top},
a)},isEventsWidget:function(){return!!gb.controller.schedulingParams[this.widgetID].eventID},isFilterEnabled:function(){return!!this.widgetGroupID},_renderEllipsifiedTitle:function(){var a=this;gb.configManager.getWidgetViewConfig(this.widgetID).useCssEllipsification&&e.defer(function(){e.each(a.dealViews,function(a,c){e.each(a,function(a,c){a.renderTitle(!1)})})})},_publishWidgetLatencyMetrics:function(a){a&&gb.csm&&gb.csm.publishedMetrics&&!gb.csm.publishedMetrics[a]&&(gb.csm.signalMarker("be",
a),gb.csm.publishMetrics(a))},_recordWidgetCF:function(a){a&&!this.isCFRecorded&&gb.csm&&gb.csm.publishedMetrics&&!gb.csm.publishedMetrics[a]&&(gb.csm.signalMarker("cf",a),this.isCFRecorded=!0)},renderFilter:function(a){this.filterViews[0]._handleFilterChange();this.getInitialFilterList(a);this._handleBottomSheetFilterEvents()},getInitialFilterList:function(a){var c=a.isSortFilter;a=a.isCustomFilter;var b=this,d=e.keys(this.filterController.models[this.widgetGroupID].availableFilterOptions),h=e.keys(b.filterViews[0]._staticFilterAttrToValues),
d=e.union(d,h,[gb.enums.BinningParams.REVIEW_RATING.key,gb.enums.BinningParams.SORT_ORDER.key]);this.filterJSONData={};e.each(gb.controller.schedulingParams[b.widgetID].filterConfig,function(a){var c=!1,f="";e.each(a.attr.split(","),function(a){!c&&e.contains(d,a)&&(c=!0);f||(f=gb.filterUtils.getLabelForSelectedAttribute(a,{widgetID:b.widgetID,widgetGroupID:b.widgetGroupID,totalPages:b.totalPages}))});c&&(b.filterJSONData[a.attr]={currentSelection:f,filterConfig:a})});var h=e.without(Object.keys(b.filterJSONData),
gb.enums.BinningParams.SORT_ORDER.key),l=this.filterController.models[this.widgetGroupID].customFilter;c||1!==h.length?a?b.filterJSONData[l]&&(c=new g({},{filterConfig:b.filterJSONData[l].filterConfig,widgetView:b,disableBackButton:!0}),c.render()):(l&&delete b.filterJSONData[l],h=gb.viewComponentBuilder.getBottomSheetFilterContentExpanderData(b,{isSortFilter:c}),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"expander",
data:h}),h=gb.viewComponentBuilder.getBottomSheetFilterHeaderData(b,{title:c?gb.resources.getString("gb_sort_by").toUpperCase():gb.resources.getString("csld-refine").toUpperCase(),showClearOption:!c,enableBack:0}),c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"header",data:h}),h=gb.viewComponentBuilder.getBottomSheetFilterFooterData(),h=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,
templateName:"footer",data:h}),c={header:c,contents:a,footer:h},gb.controller.getBottomSheet().render(c)):(c=new g({},{filterConfig:b.filterJSONData[h[0]].filterConfig,widgetView:b}),c.render())},_handleBottomSheetFilterEvents:function(){var a=this;a.bottomSheetFilterEventsCache=a.bottomSheetFilterEventsCache||{};a.bottomSheetFilterEventsCache[a.widgetID]||(a.bottomSheetFilterEventsCache[a.widgetID]=e.once(function(){h.declarative("gbfilter-back-navigation-"+a.widgetID,"click",function(c){a.getInitialFilterList({isSortFilter:!1})});
h.declarative("gbfilter-expander-"+a.widgetID,"click",function(c){(new g({},{filterConfig:a.filterJSONData[c.data.attribute].filterConfig,widgetView:a})).render()})}));a.bottomSheetFilterEventsCache[a.widgetID].call()},refreshWidget:function(a){var c=this,b=gb.controller.schedulingParams[c.widgetID],d=null;c.isGDMFailing=!1;c.isRetryInProgress=!1;a&&this.viewPortManager&&(d=this.viewPortManager.lastScrollTop);b.fetchWatchedDeals&&(c.showLoading(),gb.metadata.refreshWatchedDeals(c.widgetID));b.watchedDealsWidget||
gb.utils.isWatchedDealsTab(c.widgetID)||(delete gb.metadata.sortedDealIDs[c.widgetID],a={},a=2,gb.configManager.getWidgetViewConfig(c.widgetID).fetchSinglePageDeals&&(a=1),a={dealsPerPage:gb.configManager.getWidgetViewConfig(c.widgetID).preFetchGDMDeals,getDealsSize:a*b.pageSize},c.showLoading(),d&&h.$(l).scrollTop("0px"),gb.service.fetchDealWithData(c.widgetID,a,function(){c.filterController._updateWidgetGroup(c.widgetGroupID);d&&h.$(l).scrollTop(d)}))},renderMaxLimitDealTemplate:function(){if(0===
this.skinDomElement.find(".widgetMaxLimitDeal").size()){var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});this.skinDomElement.append(a);this.hideScrollContentLoader()}}})});n.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-deal-view").register("gb-supple-widget-view",function(h,l,g,b){var a=l._;return g.extend({totalCellsRendered:0,isLeftFilterRequired:!1,init:function(c){var b=["all",gb.enums.BinningParams.PAGE.key,
gb.enums.BinningParams.SORT_ORDER.key];this.isLeftFilterRequired=!a.isEmpty(a.reject(c.schedulingParams.filterConfig,function(c){return a.contains(b,c.attr)}));this._super(c)},renderWireFrame:function(){this.filterViews=[];gb.garbageCollector.clearDealViews(this.widgetID);this.totalCellsRendered=0;var a=gb.viewComponentBuilder.getSuppleWidgetViewTemplateData(this),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",
data:a});this.skinDomElement.html(a);var a=this.skinDomElement.find(gb.enums.WidgetViewSelectors.PADCENTER),b=gb.utils.isTablet(gb.clientName)?gb.enums.Constants.MIN_TAB_WIDTH:gb.enums.Constants.MIN_NAV_WIDTH;gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals||(b-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);var e=this.skinDomElement.width();!gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&this.isLeftFilterRequired&&(e-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);
e<b&&(b=e);a.css("min-width",b)},renderContent:function(a){var d=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS),e=gb.controller.schedulingParams[this.widgetID],f=gb.metadata.customResponseAttributes[this.widgetID];a&&(this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).empty(),d.empty(),d.height("auto"),this.filterViews=[],gb.garbageCollector.clearDealViews(this.widgetID));var k=gb.viewComponentBuilder.getSuppleWidgetViewTemplateData(this,a);a=gb.metadata.getAllDisplayableDealIDs(this.widgetID).length;
var d=gb.metadata.getSortedDealIDs(this.widgetID),g=gb.enums.WidgetViewIDs.CONTENT,h=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",data:k}),k=gb.controller.widgetCurrentPage[this.widgetID],l=e.pageSize;this.skinDomElement.find("#"+g).html(h);this.totalPages=Math.ceil(a/l);g=this.getATFDealsCount(a,e.enforceLimitedDeals,gb.widgetHelper.allDealsFetched[this.widgetID]);h=0;e.enforceLimitedDeals?h=d.length:
a&&(h=Math.min(l,a-(k-1)*l));this.totalCellsRendered=0;this._renderFilterViews();for(var n=0,r=0,u=0;n<h;n++){var v=d[n];if(v){var x=this._isDoubleCell(v),z=x?2:1;u+z<=this.dealsPerRow||(r++,u=0);var B=new b({dealID:v,widgetView:this,position:n,isDoubleCell:x,row:r,column:u});u+z>=this.dealsPerRow?(u=0,r++):u+=z;this.dealViews[v]=this.dealViews[v]||{};this.dealViews[v][n]=B;B.render();this._publishLatencyMetrics(n,h,g,B);this._recordWidgetCF(e.featureScope);x=this._isDoubleCell(v);v=gb.utils.isSponsoredDeal(v,
f);this.totalCellsRendered+=x?2:1;var z=this.totalCellsRendered<=this.dealsPerRow,A=!1;0===this.totalCellsRendered%this.dealsPerRow?A=!0:n+1===d.length&&(A=!e.showLaunchCell||!e.enforceLimitedDeals);(x=this.getDealViewCSS(x,z,A,v))&&B.viewElement.addClass(x);gb.utils.isTouchDevice()&&e.showShortCellView&&B.viewElement.removeClass("shortCellView").addClass("shortCellViewTablet")}}e.maxLimitDeals&&k*l>=e.maxLimitDeals&&this.renderMaxLimitDealTemplate();e.enforceLimitedDeals&&0<a&&this.renderLaunchCell();
this._publishWidgetLatencyMetrics(e.featureScope);this._navigateToWidget();this._renderEllipsifiedTitle()},getATFDealsCount:function(a,b,e){var f=this.dealsPerRow;b?e&&f>a&&(f=a):f>a&&(f=a);return f},getDealsPerRow:function(){var a=h.$("#"+this.domElementID).width();!gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&this.isLeftFilterRequired&&(a-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);a=gb.utils.getDealsPerRow(a,this.minDealViewWidth,gb.configManager.getWidgetViewConfig(this.widgetID).hasMargin,
!1,!0);a=Math.min(a,8);return a=Math.max(2,a)},renderMaxLimitDealTemplate:function(){var a=this.skinDomElement.find("#maxLimitCell"),b=!1;this.totalCellsRendered<=this.dealsPerRow&&(b=!0);a&&a.remove();a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});b=this.getDealViewCSS(!1,b,!0);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a);a=this.skinDomElement.find("#maxLimitCell");a.addClass(b)},
renderLaunchCell:function(){if(gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&gb.controller.schedulingParams[this.widgetID].showLaunchCell&&gb.widgetHelper.allDealsFetched[this.widgetID]&&0!==a.keys(this.dealViews).length){var c=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);c&&c.remove();var b=!1;this.totalCellsRendered<=this.dealsPerRow&&(b=!0);c=gb.viewComponentBuilder.getLaunchCellTemplateData(this);c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,
templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"launchCell",data:c});b=this.getDealViewCSS(!1,b,!0);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(c);c=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);c.addClass(b)}},getDealViewCSS:function(a,b,e,f){var k="tallCellView";gb.controller.schedulingParams[this.widgetID].showShortCellView&&(k="shortCellView");k=k+" "+("gridColumn"+this.dealsPerRow);b&&gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&
(k+=" firstRowDiv");e&&(k+=" rightMostDiv");k=a?k+" doubleCell":k+" singleCell";f&&(k+=" adHolder");return k},_isDoubleCell:function(c){return gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&gb.controller.schedulingParams[this.widgetID].showDoubleCellDOTD&&(a.contains(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],c)||a.contains(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],c))},renderErrorMessage:function(){if(!gb.controller.popOverVisible){this.removeErrorMessage();
var a=gb.viewComponentBuilder.getCartErrorDisplayData(),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetErrorAlert",data:a});this.skinDomElement.prepend(a);h.$("html,body").animate({scrollTop:h.$("#"+this.domElementID).offset().top},"slow")}},removeErrorMessage:function(){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CART_ERROR);0<a.length&&a.remove()},getMinDealWidth:function(){return gb.enums.Constants.MIN_PC_VIEW_WIDTH}})});
n.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-deal-view","gb-filter-item-view").register("gb-shoveler-widget-view",function(h,r,g,b,a){var c=r._;return g.extend({isLaunchCellPage:!1,Constants:{MIN_SHOVELER_VIEW_WIDTH:223,CONTAINER_PADDING:21},init:function(a){this._super(a);this.displayableFilter=[gb.enums.BinNames.CATEGORIES]},renderWireFrame:function(){var a=this;gb.garbageCollector.clearDealViews(this.widgetID);n.when("a-popover").execute(function(c){(c=c.get(gb.enums.WidgetViewIDs.SHOVL_FILTER+
"_"+a.widgetID))&&c.hide()&&c.update({content:""})});var c=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this),b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",data:c});this.skinDomElement.html(b);this.renderStateHeader(c)},renderContent:function(){var a=gb.controller.schedulingParams[this.widgetID],c=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this);this.isLaunchCellPage=gb.utils.isLaunchCellPage(this.widgetID);
var f=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",data:c});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).html(f);this._renderShovlPagination(c);this._renderFilterViews();for(var f=c.totalDeals<this.dealsPerRow?c.totalDeals:this.dealsPerRow,k=0,g=0,h=gb.metadata.getSortedDealIDs(this.widgetID);k<c.lastDealIDPosition;){var l=h[k];if(l){var n=new b({dealID:l,widgetView:this,position:k,
row:1,column:g});this._recordWidgetCF(a.featureScope);this.dealViews[l]=this.dealViews[l]||{};this.dealViews[l][k]=n;n.render();this._publishLatencyMetrics(k,c.lastDealIDPosition,f,n);k++;g++}else k++}a.maxLimitDeals&&gb.controller.widgetCurrentPage[this.widgetID]*a.pageSize>=a.maxLimitDeals&&this.renderMaxLimitDealTemplate();0<c.totalDeals&&this.isLaunchCellPage?(this.renderLaunchCell(),this.renderShovlButtonsContent({prev:!1,next:!0},c)):this.renderShovlButtonsContent(!1,c);this._publishWidgetLatencyMetrics(a.featureScope);
this._renderEllipsifiedTitle()},getDealsPerRow:function(){var a=this.skinDomElement.width()-2*this.Constants.CONTAINER_PADDING,a=gb.utils.getDealsPerRow(a,this.minDealViewWidth,gb.configManager.getWidgetViewConfig(this.widgetID).hasMargin,!1,!0),a=Math.min(a,12);return a=Math.max(2,a)},resizeWindow:function(){if(!this.isRefineRender){gb.controller.watchDealView&&(gb.controller.watchDealView.isWatchDealPopupRendered=!1);var a=this.dealsPerRow;this.dealsPerRow=this.getDealsPerRow();if(a!==this.dealsPerRow){gb.widgetHelper&&
gb.widgetHelper.callDataArray[this.widgetID]&&(gb.widgetHelper.callDataArray[this.widgetID][0].dealsPerPage=this.dealsPerRow);var c=gb.controller.schedulingParams[this.widgetID],a=gb.metadata.selectedDealsCount[this.widgetID],b=this.dealsPerRow||c.pageSize;c.pageSize=b;a=(c=c.widgetTabConfig[c.widgetCurrentTab])&&c.launchCellIndex?Math.ceil((a+1)/b):Math.ceil(a/b);b=gb.controller.widgetCurrentPage[this.widgetID];b>a&&(b=a);gb.controller.widgetCurrentPage[this.widgetID]=b;gb.controller.trigger("WidgetResize",
this.widgetID);gb.controller.watchDealView&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP)}}},renderErrorMessage:function(){if(!gb.controller.popOverVisible){this.removeErrorMessage();var a=gb.viewComponentBuilder.getCartErrorDisplayData(),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetErrorAlert",data:a});this.skinDomElement.prepend(a);a=this.skinDomElement.position().top;
l.scrollY>a&&h.$("html,body").animate({scrollTop:a},"slow")}},removeErrorMessage:function(){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CART_ERROR);0<a.length&&a.remove()},getMinDealWidth:function(){return this.Constants.MIN_SHOVELER_VIEW_WIDTH},renderShovlButtonsContent:function(a,b){b||(b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this));c.isObject(a)?b.disableButton=a.prev:b.disableButton=a;var f=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"previousButton",data:b});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PREV_SHOVL_BUTTON).html(f);c.isObject(a)&&(b.disableButton=a.next);a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"nextButton",data:b});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.NEXT_SHOVL_BUTTON).html(a)},_renderShovlPagination:function(a){a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"pagination",data:a});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.SHOVL_PAGINATION).html(a)},_renderFilterViews:function(){var b=this;c.each(gb.controller.schedulingParams[this.widgetID].filterConfig,function(e){c.contains(b.displayableFilter,e.attr)&&(e=new a({},{filterConfig:e,widgetView:b}),e.render(),b.filterViews.push(e))})},renderStateHeader:function(a){var c=a;c||(c=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this));var b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,
templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"stateHeader",data:c});a=gb.enums.WidgetViewIDs.SHOVL_STATE_HEADER;this.skinDomElement.find("#"+a).html(b);c.disableFilter||(c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"filterHeader",data:c}),this.skinDomElement.find("#"+a).append(c))},showLoading:function(){var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"widgetLoading"});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).html(a)},renderMaxLimitDealTemplate:function(){var a=this.skinDomElement.find("#maxLimitCell"),c="dealView",b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this);a&&a.remove();a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a);c+=
" "+b.gridColumnCSS;this.skinDomElement.find("#maxLimitCell").addClass(c)},renderLaunchCell:function(){if(gb.widgetHelper.allDealsFetched[this.widgetID]&&this.isLaunchCellPage){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);a&&a.remove();a=gb.viewComponentBuilder.getShovelerLaunchCellTemplateData(this);a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"launchCell",data:a});this.skinDomElement.find("#"+
gb.enums.WidgetViewIDs.CONTENT).append(a)}}})});n.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-filter-item-view").register("gb-faceout-widget-view",function(h,l,g,b){var a=l._;return g.extend({init:function(a){this._super(a);this.marginOnEitherSide=22;this.tileWidthAsPercentage=0;this.minimumTileWidth=85},renderContent:function(a){a&&this._clearFilterViews();this._generateFilterViews();a=this._fetchWidgetConfigs();a.animateShoveling=!1;this._calculateTileWidth(a.tilesPerPage);this._calculateTotalPages(a);
this._renderFilterViews();this.renderShovlButtonsContent(a)},_generateFilterViews:function(){var c=this;a.isEmpty(c.filterViews)&&a.each(gb.controller.schedulingParams[c.widgetID].filterConfig,function(a){a=new b({},{filterConfig:a,widgetView:c});c.filterViews.push(a)})},_renderFilterViews:function(){a.each(this.filterViews,function(a){a.render()})},resizeWindow:function(){this.renderContent(!0)},renderShovlButtonsContent:function(a){var b=this._fetchWidgetViewTemplateData();b.currentPage=a.currentPage;
b.totalPages=this.totalPages;1>=this.totalPages&&(b.hideButton=!0);b.disableButton=1>=b.currentPage;var e=this._fetchWidgetViewHtml("previousButton",b);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PREV_SHOVL_BUTTON).html(e);b.disableButton=b.currentPage>=b.totalPages;b=this._fetchWidgetViewHtml("nextButton",b);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.NEXT_SHOVL_BUTTON).html(b);this._shovelTo(a)},_fetchWidgetViewTemplateData:function(){var a={};a.widgetID=this.widgetID;a.widgetName=
this.widgetName;a.widgetGroupID=this.widgetGroupID;a.actionName=gb.enums.WidgetActions.Faceout.SHOVEL;a.hideButton=!1;return a},_fetchWidgetViewHtml:function(a,b){return gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:a,data:b})},_fetchWidgetConfigs:function(){var a=gb.configManager.getWidgetViewConfig(this.widgetID),b=gb.controller.widgetCurrentPage[this.widgetID],e=this.filterViews[0].filterConfig.faceoutConfig.length,
f=this.skinDomElement.width()-2*this.marginOnEitherSide;return{totalTiles:e,tilesPerPage:Math.min(a.maxTilesPerPage,e,Math.floor(f/this.minimumTileWidth)),currentPage:b,scrollAnimationSpeed:a.scrollAnimationSpeed}},_shovelTo:function(a){var b=(this.skinDomElement.width()-2*this.marginOnEitherSide)/a.tilesPerPage*(a.currentPage-1)*a.tilesPerPage,e=a.scrollAnimationSpeed;a.animateShoveling?h.$(".tiles").animate({scrollLeft:b},e):h.$(".tiles").scrollLeft(b)},_calculateTileWidth:function(a){this.tileWidthAsPercentage=
100/a},_clearFilterViews:function(){this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS).empty()},_calculateTotalPages:function(a){this.totalPages=Math.ceil(a.totalTiles/a.tilesPerPage)}})});n.when("A","gb-widget-view","gb-shoveler-widget-view","gb-supple-widget-view","gb-faceout-widget-view").register("gb-widget-factory",function(h,l,g,b,a){return h.createClass({getWidgetView:function(c){var d=c.widgetName;try{switch(d){case gb.enums.WidgetNames.PC_SUPPLE:return new b(c);case gb.enums.WidgetNames.PC_SHOVELER:return new g(c);
case gb.enums.WidgetNames.PC_FACEOUT:return new a(c);default:return new l(c)}}catch(e){n.log("WidgetView invoked for the widget is not supported on the platform!","ERROR","GoldboxMobileAssets")}},isInstanceOfWidgetView:function(a){return a&&a instanceof l?!0:!1}})});n.when("A","GoldboxMobile3PAssets").register("gb-filter-item-view",function(h,l){var g=l._;return h.createClass({_staticFilterAttrToValues:{},init:function(b,a){this.widgetView=a.widgetView;this.filterConfig=a.filterConfig;this.disableBackButton=
a.disableBackButton;this.type=this.filterConfig.type;this.title=this.filterConfig.title;b=this.filterConfig.attr.split(",");this.attributes=g.map(b,function(a){return h.$.trim(a)});b="#"+gb.utils.getFilterItemViewID(this.attributes,this.type);this.viewElement=this.widgetView.skinDomElement.find(b);this.viewElement.length?this.viewElement.empty():this.viewElement=this.widgetView.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS);this._populateStaticFilterValues()},render:function(){this.filterOptions=
this._getFilterOptionList(this.attributes,this.widgetView);var b=gb.filterControllerFactory.getFilterController(this.widgetView.widgetName).models[this.widgetView.widgetGroupID];if(gb.configManager.getWidgetViewConfig(this.widgetView.widgetID).showBottomSheetFilter){var a=gb.viewComponentBuilder.getBottomSheetFilterContentData(this),c=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"links",data:a}),a=gb.viewComponentBuilder.getBottomSheetFilterHeaderData(this,
{title:gb.resources.getString(this.filterConfig.title).toUpperCase(),showClearOption:0,enableBack:this.disableBackButton||1===g.without(b.attributesList,gb.enums.BinningParams.SORT_ORDER.key).length?0:1}),b=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"header",data:a}),a=gb.viewComponentBuilder.getBottomSheetFilterFooterData(),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,
templateName:"footer",data:a}),c={header:b,contents:c,footer:a};gb.controller.getBottomSheet().render(c)}else a=gb.viewComponentBuilder.getFilterViewTemplateData(this),a.elements=this.generateFilterViewComponent(a),this.viewSkin=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"filterItem",data:a}),this.viewElement.append(this.viewSkin);this._handleFilterChange()},generateFilterViewComponent:function(b){var a=
{};a[this.type]=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:this.type,data:b});return a},_paginationDummyUrls:{PREV:"prev",NEXT:"next"},_getTypeCorrectedData:function(b){var a=parseInt(b,10);return!isNaN(a)&&a+""===b&&0<=a?a:g.isNumber(b)&&0>b?b.toString():b},_handleTitleChange:function(b){b.targetedWidget.title&&(b.targetedWidget.title=null,b.targetedWidget.clearTitle=!0)},_handleFilterChange:g.once(function(){var b=
this,a=function(a){var d=g.tail(arguments)[0],e=d.$target.closest("[data-widgetid]").data("widgetid");if(e){var f=gb.widgets[e].widgetGroupID,k=d.data.attribute,m=d.data.attributes,h=d.data.linkType,l=d.data.redirectURL,n=d.data.titleOnTargetedWidget,r=d.data.isSelected,u=gb.filterControllerFactory.getFilterController(gb.widgets[e].widgetName).models[f];a.call(b,d,{widgetID:e,widgetGroupID:f,attribute:k,attributes:m,linkType:h,redirectURL:l,titleOnTargetedWidget:n,metrics:{widgetID:e,eventID:f,data:[f,
k||m],context:gb.metrics.refTags.filter},isSelected:r},u);return!1}};h.declarative("gbfilter-checkbox","change",g.wrap(function(a,b,e){var f=a.data.value;a.$target.is(":checked")?e.addFilterValue(b.attribute,f,b.metrics):(b.metrics.context=gb.metrics.refTags.clearFilter,e.removeFilterValue(b.attribute,f,b.metrics))},a));h.declarative("gbfilter-dropdown","change",g.wrap(function(a,b,e){a=a.$target.val();e.setFilterValue(b.attribute,a,b.metrics)},a));h.declarative("gbfilter-link","click",g.wrap(function(a,
d,e){if("clear"===d.linkType)if(this._handleTitleChange(e),"true"===d.isSelected)gb.controller.getBottomSheet().close();else{var f=g.map(d.attributes.split(","),h.$.trim);g.each(f,function(a){e.removeFilterValue(a,void 0,d.metrics,!0)});e.triggerChangeEvent(d.metrics)}else{a.data.attribute===gb.enums.BinningParams.DEAL_TYPE.key?(e.removeFilterValue(gb.enums.BinningParams.PRIME_ACCESS_TYPE.key,void 0,void 0,!0),e.removeFilterValue(gb.enums.BinningParams.ACCESS_TYPE.key,void 0,void 0,!0)):a.data.attribute===
gb.enums.BinningParams.PRIME_ACCESS_TYPE.key?(e.removeFilterValue(gb.enums.BinningParams.DEAL_TYPE.key,void 0,void 0,!0),e.removeFilterValue(gb.enums.BinningParams.ACCESS_TYPE.key,void 0,void 0,!0)):a.data.attribute===gb.enums.BinningParams.ACCESS_TYPE.key&&(e.removeFilterValue(gb.enums.BinningParams.DEAL_TYPE.key,void 0,void 0,!0),e.removeFilterValue(gb.enums.BinningParams.PRIME_ACCESS_TYPE.key,void 0,void 0,!0));var f=a.$target,k=f.closest("[data-value]").data("value")||f.find("[data-value]").data("value");
f.closest("[data-isselected]").data("isselected")||f.find("[data-isselected]").data("isselected")?gb.controller.getBottomSheet().close():k&&(k=a.data.attribute===gb.enums.BinningParams.CATEGORIES.key?k.toString():b._getTypeCorrectedData(k),e.setFilterValue(d.attribute,k,d.metrics))}a.$event.preventDefault()},a));h.declarative(gb.enums.WidgetActions.Faceout.TILE_SELECTED,"click",g.wrap(function(a,b,e){a=a.$target.closest("[data-value]").data("value");b.redirectURL&&(e.redirectURL=b.redirectURL,gb.resources.deviceInfo.isApp||
gb.clientName===gb.enums.MobileClients.AW)&&(e.doPageRefresh=!0);e.targetedWidget.title=b.titleOnTargetedWidget;e.targetedWidget.clearTitle=b.titleOnTargetedWidget?!1:!0;var f={disableNavigationToTop:!0,updateTitleOnTargetedWidget:!0};a?(a=a.toString(),e.removeFilterValue(b.attribute,void 0,b.metrics,!0),b.metrics.context=gb.metrics.refTags.filter,e.addFilterValue(b.attribute,a,b.metrics,!1,f)):e.removeFilterValue(b.attribute,void 0,b.metrics,!1,f)},a));h.declarative(gb.enums.WidgetActions.Faceout.SHOVEL,
"click",g.wrap(function(a,b){if(a.data.buttonStatus!==gb.enums.ShovlConstants.DISABLED){var e=parseInt(a.data.currentPage,10),e=a.data.actionType===gb.enums.ShovlConstants.SHOVL_NEXT?e+1:e-1;a=parseInt(a.data.totalPages,10);1<=e&&e<=a&&(gb.controller.widgetCurrentPage[b.widgetID]=e,b=gb.widgets[b.widgetID],a=b._fetchWidgetConfigs(),a.animateShoveling=!0,b.renderShovlButtonsContent(a))}},a));h.declarative(gb.enums.WidgetActions.Filter.CLEAR_ALL,"click",g.wrap(function(a,b,e){b.metrics.context=gb.metrics.refTags.clearFilter;
this._handleTitleChange(e);e.removeAllFilterValues(null,null,b.metrics)},a));h.declarative("gbfilter-pagination","click",g.wrap(function(a,d,e){var f=parseInt(a.data.currentPage,10),k=parseInt(a.data.totalPages,10),g=a.$target.closest("[data-page]").data("page");parseInt(g,10)||(g=void 0);a.$event.preventDefault();g||(a=a.$target[0].href&&a.$target[0].href.split("#")[1],a===b._paginationDummyUrls.PREV&&1<f?g=f-1:a===b._paginationDummyUrls.NEXT&&f<k&&(g=f+1));g&&(gb.controller.widgetCurrentPage[d.widgetID]=
g,e.setFilterValue(d.attribute,g,d.metrics))},a))}),_getFilterOptionList:function(b,a){var c=this,d=[],e=gb.filterControllerFactory.getFilterController(a.widgetName).models[a.widgetGroupID];if("all"===b[0]){b=g.keys(e.availableFilterOptions);b.push(gb.enums.BinningParams.PAGE.key);var f=e.attributesList,k=g.keys(c._staticFilterAttrToValues),k=g.union(k,[gb.enums.BinningParams.REVIEW_RATING.key,gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key]);b=g.union(b,g.intersection(f,k))}g.each(b,function(b){var f;
f=c._staticFilterAttrToValues[b]?c._getStaticBinningResponse(b):e.availableFilterOptions[b]||{};b=gb.filterUtils.getFilterOptions(b,f,{widgetID:a.widgetID,widgetGroupID:a.widgetGroupID,widgetName:a.widgetName,totalPages:a.totalPages});Array.prototype.push.apply(d,b)});return d},_populateStaticFilterValues:function(){this._staticFilterAttrToValues[gb.enums.BinningParams.DEAL_STATE.key]=gb.enums.DealStates;this._staticFilterAttrToValues[gb.enums.BinningParams.DEAL_TYPE.key]=gb.enums.DealTypes;this._staticFilterAttrToValues[gb.enums.BinningParams.ACCESS_TYPE.key]=
gb.enums.DealAccessTypes;this._staticFilterAttrToValues[gb.enums.BinningParams.PRIME_ACCESS_TYPE.key]={PRIME_EARLY_ACCESS:"PRIME_EARLY_ACCESS",PRIME_ONLY_BD:"PRIME_ONLY_BD",PRIME_ONLY_DOTD:"PRIME_ONLY_DOTD",PRIME_ONLY_LD:"PRIME_ONLY_LD"}},_getStaticBinningResponse:function(b){b=g.values(this._staticFilterAttrToValues[b]);return g.object(g.map(g.values(b),function(a){return[a,1]}))}})});n.declare("gb-bottomsheet-view");n.when("A","GoldboxMobile3PAssets").register("gb-watch-deal-view",function(h,l){return h.createClass({defaults:{isWatchDealPopupRendered:null,
domain:null,key:null,watchDealPopupHandler:null},init:function(){this.domain=gb.enums.WatchDealViewKeys.GOLDBOX_DOMAIN;this.key=gb.enums.WatchDealViewKeys.DISMISS_WATCHPOPUP_KEY;this.isWatchDealPopupRendered=!1;this._handleWatchUnwatchActions();h.on.afterLoad(function(){gb.controller.watchDealView&&!gb.controller.watchDealView.isWatchDealPopupRendered&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.SHOW_WATCH_POPUP)&&(gb.controller.watchDealView.isWatchDealPopupRendered=
!0)})},_handleWatchUnwatchActions:l._.once(function(){h.on("a:popover:dismiss:watch_preload",function(g){g=gb.controller.watchDealView;g.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP);gb.watchDealService.modifyPopupStatus({action:gb.enums.SembuActions.SET_COOKIE,type:gb.enums.DataTypes.BOOL,value:1,key:g.key,domain:g.domain});gb.resources.customerData.isWatchDealPopupMarked=!0});n.when("A","a-popover","ready").execute(function(g,b){gb.controller.watchDealView.watchDealPopupHandler=
b})}),changeWatchPopupState:function(g){if(gb.controller.watchDealView.watchDealPopupHandler){var b=gb.controller.watchDealView.watchDealPopupHandler.get(h.$("#"+gb.enums.WatchDealViewIDs.WATCH_POPOVER));if(b){switch(g){case gb.enums.WatchDealPopoverActions.SHOW_WATCH_POPUP:b.lock().show();break;case gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP:b.unlock().hide();break;case gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP:b.lock().show().updatePosition()}return!0}}return!1},resetWatchDealVariables:function(){gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP)&&
(gb.controller.watchDealView.isWatchDealPopupRendered=!1)},triggerMouseEventsOnWatchingDeal:function(g,b,a){"mouseenter"===a?(b.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+g).html(gb.resources.getString("gb_stop_watching_deal")),b.find("#"+gb.enums.WatchDealViewIDs.WATCHING_IMAGE+g).removeClass("watchingImage").addClass("stopWatchingImage"),b.find(".watchingText").removeClass("watchingText").addClass("stopWatchingText")):"mouseleave"===a&&(b.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+
g).html(gb.resources.getString("gb_watching_deal")),b.find("#"+gb.enums.WatchDealViewIDs.WATCHING_IMAGE+g).removeClass("stopWatchingImage").addClass("watchingImage"),b.find(".stopWatchingText").removeClass("stopWatchingText").addClass("watchingText"))},_isPopupTriggerRequired:function(g){return!(gb.resources.customerData.isWatchDealPopupMarked||gb.controller.watchDealView.isWatchDealPopupRendered)&&gb.controller.schedulingParams[g.widgetID].fetchWatchedDeals},_isPopupTriggerRequiredForMiniDP:function(g){return!gb.resources.customerData.isWatchDealPopupMarked&&
gb.controller.schedulingParams[g.widgetID].fetchWatchedDeals}})});n.when("A","GoldboxMobile3PAssets","gb-event-emitter").register("gb-metadata",function(h,n,g){var b=n._;return g.extend({sortedDealIDs:{},sortedGiveawayDealIDs:{},dealIDLocations:{},selectedDealsCount:{},binningInfo:{},dealsByType:{},dealsByState:{},dealsByAccessType:{},metadataResponse:{},watchedDeals:{},customResponseAttributes:{},dealCategoryHash:{},init:function(){this._super();this.registerConnections()},registerConnections:function(){this.on("ConsumeMetadataChange",
this.updateMetadata);this.on("RefreshWatchedDealWidgets",this.updateWatchDealWidgets)},parseSortedDealIDs:function(a,c){var d=gb.controller.schedulingParams[a],e=d.prioritizedDealIDs;gb.controller.isPaginatedMetadataCall(a)?e.length&&(a=this.dealsByState[gb.enums.DealStates.AVAILABLE],c.sortedDealIDs=b.intersection(c.sortedDealIDs,a)):(e.length&&(a=c.dealsByState[gb.enums.DealStates.AVAILABLE],e=b.intersection(e,a),e.length&&(c.sortedDealIDs=b.union(e,c.sortedDealIDs))),d.enforceLimitedDeals&&(c.sortedDealIDs=
c.sortedDealIDs.slice(0,d.pageSize)))},registerMetadata:function(a,c,d){"undefined"===typeof d&&(d=!0);this.metadataResponse[a]=c;var e=gb.controller.schedulingParams[a];e.enableDeDuping&&(c.sortedDealIDs=this.deDupeDeals(c.sortedDealIDs,a));if(gb.controller.isPaginatedMetadataCall(a)){this.sortedDealIDs[a]=c.sortedDealIDs||[];this.sortedGiveawayDealIDs[a]=this.sortedGiveawayDealIDs[a]||c.sortedGiveawayDealIDs||[];b.isEmpty(this.sortedGiveawayDealIDs[a])||gb.utils.mergeGiveawayWithGdmResponse(c,this.sortedGiveawayDealIDs[a],
e,a);if(!e.enforceLimitedDeals){var f=c.selectedDealsCount?parseInt(c.selectedDealsCount,10):0,k=e.pageSize,g=0;1<e.page&&e.fetchSinglePage&&(g=(e.page-1)*k);this.sortedDealIDs[a]=gb.utils.getExtendedArray(f,this.sortedDealIDs[a],g)}this._registerCustomResponseAttributes(a,c.customResponseAttributes);c.binning&&(this.binningInfo[a]=c.binning);gb.controller.totalDealsToShow[a]=this.getAllDisplayableDealIDs(a).length}else this.registerSortedDealIDs(a,c),this.registerDealCategoryHashMap(c),this.populateIsDigitalDeals();
this.registerDealIDLocations(a);this.selectedDealsCount[a]=parseInt(c.selectedDealsCount,10)||0;gb.controller.trigger("WidgetPageUpdate",a,d)},registerSortedDealIDs:function(a,c){var d=this,e=gb.controller.widgetCurrentStatus[a],f=gb.controller.widgetCurrentCategory[a],k=c.dealsByState[e.toUpperCase()]||[];d.sortedDealIDs[a]={};d.sortedDealIDs[a][e]={};e===gb.enums.StatusFilters.AVAILABLE?(k=k.concat(c.dealsByState.UPCOMING||[]),d._isWidgetScheduledWithDOTD(a)&&!gb.utils.isWidgetWithStatusFilter(gb.widgets[a].widgetName)&&
(k=k.concat(c.dealsByState.SOLDOUT))):e===gb.enums.StatusFilters.MISSED&&(k=c.dealsByState[e.toUpperCase()]||[],k=k.concat(c.dealsByState.SOLDOUT));var g=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS;f!==gb.enums.CategoryFilters.ALL&&f!==g?k=b.intersection(k,c.dealsByCategory[f]):f===g&&(k=b.intersection(k,d.metadataResponse.dealsByAccessType[g]));d.sortedDealIDs[a][e][f]=b.intersection(c.sortedDealIDs,k);b.each(d.sortedDealIDs[a][e][f],function(c,b){d.registerDealIDLocation(c,a,e,f,b)})},registerDealIDLocations:function(a){var c=
this;gb.controller.isPaginatedMetadataCall(a)?b.each(c.sortedDealIDs[a],function(b,e){c.dealIDLocations[b]=c.dealIDLocations[b]||{};c.dealIDLocations[b][a]=e}):b.each(c.sortedDealIDs[a],function(d,e){b.each(d,function(d,k){b.each(d,function(b,d){c.registerDealIDLocation(b,a,e,k,d)})})})},registerDealCategoryHashMap:function(a){var c=this;b.each(a.dealsByCategory,function(a,e){b.each(a,function(a){c.dealCategoryHash[a]||(c.dealCategoryHash[a]=[]);-1===b.indexOf(c.dealCategoryHash[a],e)&&c.dealCategoryHash[a].push(e)})})},
populateIsDigitalDeals:function(){b.each(this.dealCategoryHash,function(a,c){gb.controller.getDealDAO(c).isDigital=gb.utils.hasDigitalCategory(a)})},registerWatchedDeals:function(a){var c=b.flatten(a);a[gb.enums.Constants.ALL]=c;this.watchedDeals=a;b.each(c,function(a){gb.controller.getDealDAO(a).isDealWatched=!0})},_registerCustomResponseAttributes:function(a,c){var d={};c&&!b.isEmpty(c.dealsWithBids)&&(d.dealsWithBids=this._updateDealsWithBids(c.dealsWithBids));this.customResponseAttributes[a]=
d},_updateDealsWithBids:function(a,c){var d=c||{};b.each(a,function(a,c){d[c]={adId:a.adId,logId:a.logId,qualifier:a.qualifier}});return d},updateWatchedDeals:function(a){var c,d,e=this.watchedDeals;d=gb.controller.dealDAOs[a];c=b.keys(gb.widgets);d.isDealWatched?(d=gb.enums.WatchedDealStateMap.UPCOMING,e.ALL=b.union(e.ALL,[a]),e[d]=e[d]||[],e[d]=b.union(e[d],[a])):(d=gb.enums.WatchedDealStateMap[d.dealState],e.ALL=b.without(e.ALL,a),e[d]=b.without(e[d],a));this.trigger("RefreshWatchedDealWidgets",
c,a)},refreshWatchedDeals:function(a){var c=this,d=gb.metrics.generateRef(a,gb.metrics.refTags.getWatchedDeals,["ALL"]);gb.service.getWatchedDeals(function(a,d,k){gb.metadata.registerWatchedDeals(a);a=b.keys(gb.widgets);b.each(a,function(a){var b=gb.controller.schedulingParams[a];if(b.watchedDealsWidget||gb.utils.isWatchedDealsTab(a))b=gb.utils.getWatchedDealWidgetData(b.dealStates),c.registerMetadata(a,b)})},function(){var c=gb.utils.getWatchedDealWidgetData(gb.controller.schedulingParams[a].dealStates);
gb.metadata.registerMetadata(a,c,!0)},d)},updateWatchDealWidgets:function(a,c){var d=this,e=gb.controller.dealDAOs[c],f=gb.enums.WatchedDealStateMap[e.dealState],k=!1,g=gb.metadata.watchedDeals.ALL.length;if(0===g||1===g&&e.isDealWatched)k=!0;b.each(a,function(a){var g=gb.controller.schedulingParams[a];if(g.watchedDealsWidget||gb.utils.isWatchedDealsTab(a)){var h=gb.utils.getWatchedDealStates(g.dealStates),g=d.getAllDisplayableDealIDs(a),m=b.indexOf(g,c);if((h=b.contains(h,f))||-1!==m){var n=!0;h&&
e.isDealWatched&&-1===m?g.unshift(c):e.isDealWatched&&h||-1===m?n=!1:g.splice(m,1);if(n){var r={sortedDealIDs:g,selectedDealsCount:g.length,dealsByState:{}};r.dealsByState[gb.enums.DealStates.AVAILABLE]=g;gb.widgets[a].dealViews[c]&&gb.metadata.watchedDeals.ALL&&gb.metadata.watchedDeals.ALL.length?(b.each(gb.widgets[a].dealViews[c],function(a){a.viewElement.slideUp(200)}),l.setTimeout(function(){d.registerMetadata(a,r)},200)):d.registerMetadata(a,r)}}else k&&gb.controller.trigger("WidgetPageUpdate",
a,!0)}})},getSortedDealIDs:function(a,c){c||(c=gb.controller.widgetCurrentPage[a]||0);var b=gb.controller.schedulingParams[a],e=2;gb.configManager.getWidgetViewConfig(a).fetchSinglePageDeals&&(e=1);var f=b.pageSize||0;c=f*(c-1);e=c+f*e;return(a=this.getAllDisplayableDealIDs(a))?b.enforceLimitedDeals?a:a.slice(c,e):[]},getAllDisplayableDealIDs:function(a){var c=[];if(gb.controller.isPaginatedMetadataCall(a)){var c=this.sortedDealIDs[a],d=this.dealsByType[gb.enums.DealTypes.DOTD]||[],e=this.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD]||
[],f=gb.controller.schedulingParams[a];f.enforceLimitedDeals&&f.showDoubleCellDOTD&&(c=this._rearrangeDealIds(a,c,b.union(d,e)));return c||[]}d=gb.controller.widgetCurrentStatus[a];e=gb.controller.widgetCurrentCategory[a];d&&e&&this.sortedDealIDs[a][d]&&this.sortedDealIDs[a][d][e]&&(c=this.sortedDealIDs[a][d][e]);return this._insertBlankDealIDs(a,c||[])},getMetadataCategories:function(a){var c=[];if(!gb.controller.isPaginatedMetadataCall(a)){var b=gb.controller.widgetCurrentStatus[a];this.metadataResponse[a]&&
(this.registerFullMetadata(this.metadataResponse[a],a),this.metadataResponse[a]=null);for(var e=0;e<gb.resources.categories.length;e++){var f=gb.resources.categories[e].nodeId;this.sortedDealIDs[a][b]&&this.sortedDealIDs[a][b][f]&&c.push(f)}}return c},getDealIDPosition:function(a,c){if(a){a=this.dealIDLocations[a];if(gb.controller.isPaginatedMetadataCall(c))return a[c];var b=gb.controller.widgetCurrentStatus[c],e=gb.controller.widgetCurrentCategory[c];if(a&&a[c]&&a[c][b]&&null!==a[c][b][e]&&void 0!==
a[c][b][e])return a[c][b][e]}return-1},_insertBlankDealIDs:function(a,c){var b,e=gb.controller.widgetCurrentPage[a],f=gb.controller.schedulingParams[a].pageSize;gb.widgets[a]&&gb.widgets[a].widgetGroupID&&this.selectedDealsCount[a]>c.length&&(b=gb.utils.getExtendedArray(this.selectedDealsCount[a],c,f*(e-1)));return b||c},updateMetadata:function(a,c,d,e){var f=gb.widgets[a],k=gb.controller.schedulingParams[a],g=e.metaParams,h=gb.filterControllerFactory.getFilterController(f.widgetName);b.isEmpty(this.sortedGiveawayDealIDs[a])||
gb.utils.mergeGiveawayWithGdmResponse(c,this.sortedGiveawayDealIDs[a],k,a,e);if(g&&g.callDataArray)gb.widgetHelper.callBins[a][g.callID]=c.sortedDealIDs||[],k.enableDeDuping&&(gb.widgetHelper.callBins[a][g.callID]=this.deDupeDeals(gb.widgetHelper.callBins[a][g.callID],a)),this.sortedDealIDs[a]=gb.widgetHelper.buildSortedDealsArray(a,f.dealsPerRow),gb.widgetHelper.callID[a]++,gb.widgetHelper.fetchCallDataArrayDeals(a);else if(k.enableDeDuping&&(c.sortedDealIDs=this.deDupeDeals(c.sortedDealIDs,a)),
g&&g.isPageChange){var l=this.sortedDealIDs[a];e=e.dealsPerPage?e.dealsPerPage:k.pageSize;k=(c.page-1)*e;c=this.restrictDeals(a,c,e);this.sortedDealIDs[a]=gb.utils.getExtendedArray(c.selectedDealsCount,c.sortedDealIDs,k,l);this._updateCustomResponseAttributes(a,c,g.isPageChange);c.binning=this.getBinningInfo(a)}else c=this.restrictDeals(a,c),this._updateCustomResponseAttributes(a,c),this.sortedDealIDs[a]=gb.utils.getExtendedArray(c.selectedDealsCount,c.sortedDealIDs);this.selectedDealsCount[a]=this.sortedDealIDs[a].length;
this.binningInfo[a]=c.binning;this.registerDealIDLocations(a);(f=f.widgetGroupID)&&h.models[f].populateAvailableFilters(c.binning);"function"===typeof d&&d(a)},_updateCustomResponseAttributes:function(a,c,d){var e=this.customResponseAttributes[a]||{};if(!d||b.isEmpty(e))this._registerCustomResponseAttributes(a,c.customResponseAttributes);else{a=e.dealsWithBids;var f;c.customResponseAttributes&&(f=c.customResponseAttributes.dealsWithBids);this._updateDealsWithBids(f,a)}},getDOTDCount:function(a){return b.intersection(b.union(this.dealsByType[gb.enums.DealTypes.DOTD]||
[],this.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD]||[]),a).length},getBinningInfo:function(a){return this.binningInfo[a]},isCurrentWindowFull:function(a,c,b){if(!(this.sortedDealIDs[a]&&this.sortedDealIDs[a]instanceof Array))return!1;c=(c-1)*b;a=this.sortedDealIDs[a].slice(c,c+b);for(b=0;b<a.length;)if(!a[b++])return!1;return!0},_rearrangeDealIds:function(a,c,d){d=b.intersection(c,d);var e=gb.widgets[a].dealsPerRow,f=0;0<d.length&&b.each(d,function(a){f+=1;a=b.indexOf(c,a);if(0===
(a+f)%e&&a<c.length){var g=1;if(!(a+g>=c.length)){for(;b.contains(d,c[a+g])&&!(g++,a+g>=c.length););a+g<c.length&&(g=c.splice(a+g,1),c.splice(a,0,g))}}});return c},registerFullMetadata:function(a,c){var d=gb.enums.StatusFilters;this.sortedDealIDs[c][d.AVAILABLE]={};this.sortedDealIDs[c][d.UPCOMING]={};this.sortedDealIDs[c][d.MISSED]={};var e=a.dealsByState.AVAILABLE||[],f=a.dealsByState.UPCOMING||[],g=a.dealsByState.EXPIRED||[],e=e.concat(f);this._isWidgetScheduledWithDOTD(c)&&!gb.utils.isWidgetWithStatusFilter(gb.widgets[c].widgetName)?
e=e.concat(a.dealsByState.SOLDOUT):g=g.concat(a.dealsByState.SOLDOUT);this.sortedDealIDs[c][d.MISSED][gb.enums.CategoryFilters.ALL]=b.intersection(a.sortedDealIDs,g);this.sortedDealIDs[c][d.UPCOMING][gb.enums.CategoryFilters.ALL]=b.intersection(a.sortedDealIDs,f);this.sortedDealIDs[c][d.AVAILABLE][gb.enums.CategoryFilters.ALL]=b.intersection(a.sortedDealIDs,e);this.registerCategories(a,c);this.registerDealIDLocations(c)},registerCategories:function(a,c){for(var d=gb.enums.StatusFilters,e=gb.enums.CategoryFilters,
f=this.sortedDealIDs[c][d.AVAILABLE][e.ALL],g=this.sortedDealIDs[c][d.UPCOMING][e.ALL],e=this.sortedDealIDs[c][d.MISSED][e.ALL],h=1;h<gb.resources.categories.length;h++){var l=gb.resources.categories[h].nodeId;a.dealsByCategory[l]&&(this.sortedDealIDs[c][d.AVAILABLE][l]=b.intersection(f,a.dealsByCategory[l]),this.sortedDealIDs[c][d.UPCOMING][l]=b.intersection(g,a.dealsByCategory[l]),this.sortedDealIDs[c][d.MISSED][l]=b.intersection(e,a.dealsByCategory[l]))}h=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS;
if(a=a.dealsByAccessType[h])this.sortedDealIDs[c][d.AVAILABLE][h]=b.intersection(f,a),this.sortedDealIDs[c][d.UPCOMING][h]=b.intersection(g,a),this.sortedDealIDs[c][d.MISSED][h]=b.intersection(e,a)},registerDealIDLocation:function(a,c,b,e,f){this.dealIDLocations[a]||(this.dealIDLocations[a]={});this.dealIDLocations[a][c]||(this.dealIDLocations[a][c]={});this.dealIDLocations[a][c][b]||(this.dealIDLocations[a][c][b]={});this.dealIDLocations[a][c][b][e]=f},_isWidgetScheduledWithDOTD:function(a){var c=
!1;b.contains(gb.controller.schedulingParams[a].dealTypes,gb.enums.DealTypes.DOTD)&&(c=!0);return c},deDupeDeals:function(a,c){var d=this;b.each(gb.widgets,function(e){if(e.widgetID!==c||gb.controller.schedulingParams[c].enforceLimitedDeals)a=b.difference(a,d.sortedDealIDs[e.widgetID])});return a},restrictDeals:function(a,c,b){var e=gb.controller.schedulingParams[a];a=c.page;var e=(e=e.widgetTabConfig[e.widgetCurrentTab])?e.launchCellIndex:0,f;b&&a&&(f=b*(a-1));e&&c.selectedDealsCount>e&&(c.selectedDealsCount=
e,f&&e>f&&(e-=f),c.sortedDealIDs.splice(e));return c}})});n.when("A","gb-resources","GoldboxMobile3PAssets","gb-csm").register("gb-service",function(h,r,g,b){var a=g._;return h.createClass({clientID:"",customerID:"",statusPollTimeoutValue:2E3,statusPollCache:[],getDealsTimeoutValue:500,getDealsCache:[],dealsWithDetails:{},maxDealIDsLength:12,getDealsMaxJitter:null,apis:{GDM:{name:"GetDealMetadata",maxRetries:3,baseRetryInterval:4E3,ajaxTimeout:6E4},GDS:{name:"GetDealStatus",maxRetries:0,baseRetryInterval:12E3,
ajaxTimeout:6E4},GD:{name:"GetDeals",maxRetries:3,baseRetryInterval:4E3,ajaxTimeout:6E4},CD:{name:"ClaimDeal",maxRetries:2,baseRetryInterval:1E4,ajaxTimeout:6E4},WD:{name:"WatchDeal",maxRetries:2,baseRetryInterval:1E4,ajaxTimeout:6E4},GWD:{name:"GetWatchedDeals",maxRetries:0,baseRetryInterval:0},RFN:{name:"RegisterForNotifications",maxRetries:2,baseRetryInterval:1E4},PICASSO_CLICKS:{name:"picasso",maxRetries:0,baseRetryInterval:0},FWC:{name:"FetchWidgetConfig",maxRetries:0,baseRetryInterval:0}},TYPE_NAME_MAP:{SponsoredDealAttributes:"SponsoredDealsRequestAttributes:http://internal.amazon.com/coral/com.amazon.dcs.model.v2/"},
init:function(){var a=this;r.when("gbResources").execute(function(){a.registerConfigs()})},registerConfigs:function(){this.marketplaceID=gb.resources.getCustomerData("marketplaceId");this.sessionID=gb.resources.getCustomerData("sessionId");this.customerID=gb.resources.getCustomerData("customerId");this.getDealsMaxJitter=gb.enums.Constants.GET_DEALS_MAX_JITTER;this.clientID=gb.enums.ClientIDPrefix+"_"+gb.clientName;this.overrideAPIConfigsFromG2S2()},_ajaxWithRetries:function(a,b,e){var f=this,g=new Date,
m=0,q=f.apis[a],n=b.retry,r=b.error;e.retry&&m++;delete b.error;delete b.retry;q.ajaxTimeout&&(b.timeout=q.ajaxTimeout);(function u(){b.url=gb.utils.setUrlParam(b.url,"nocache",(new Date).getTime());var a=b.success;b.success=function(c,h,n){"function"===typeof n.getResponseHeader&&n.getResponseHeader("X-CSRFToken")&&(gb.resources.customerData.csrfToken=n.getResponseHeader("X-CSRFToken"));if(c&&c.forceRefresh)l.location.reload();else if(c&&gb.utils.parseBool(c.retry))b.error();else{var q=0<m;e.latency=
(new Date).getTime()-g.getTime();f._recordAPIMetrics(q,!0,e);a(c,h,n)}};b.error=function(a,c){var h=0<m;e.latency=(new Date).getTime()-g.getTime();f._recordAPIMetrics(h,!1,e);b.url=gb.utils.setUrlParam(b.url,"retrying",1);"timeout"===c&&f._recordAPITimeoutMetrics(m);++m>q.maxRetries?(c="Request failing for "+e.apiName+".",h&&(c=c+" Retry number: "+m),r(Error(c+JSON.stringify(a)))):(a=f.getRetryInterval(m,q),"function"===typeof n&&n(),l.setTimeout(u,a))};h.$.ajax(b)})()},_buildAjaxRequestParams:function(a,
b,e,f,g){a={success:e.success,error:e.error,retry:e.retry,url:a,type:"POST",dataType:"json"};g&&(a.dataType=g);e.beforeSend&&(a.beforeSend=e.beforeSend);a.data=f?JSON.stringify(b):b;return a},getRetryInterval:function(a,b){return Math.pow(2,a-1)*(b.baseRetryInterval+gb.utils.getRandomNumber(-1E3,1E3))},callAPI:function(a,b,e,f){for(var g=[],h=0;h<b.length;h++)g.length===this.maxDealIDsLength&&(this[a](g,e,f),g=[]),g.push(b[h]);if(g.length)this[a](g,e,f)},getGetDealStatusRequestParam:function(c){c=
c.sort();c=a.map(c,function(a){return{dealID:a}});c={requestMetadata:{marketplaceID:this.marketplaceID,clientID:this.clientID},dealTargets:c,responseSize:"STATUS_ONLY",itemResponseSize:"DEFAULT_WITH_PREEMPTIVE_LEAKING"};this.customerID&&(c.requestMetadata.customerID=this.customerID);this.sessionID&&(c.requestMetadata.sessionID=this.sessionID);return c},GetDealStatusCall:function(c){if(c.length){var b=this,e=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GDS.name,f=this.getGetDealStatusRequestParam(c),
g={apiName:this.apis.GDS.name},e=this._buildAjaxRequestParams(e,f,{success:function(b){var d=(new Date).getTime();a.each(c,function(a){var c=gb.controller.getDealDAO(a);a=b.dealStatus[a];a.responseTimestamp=d;gb.translator.trigger("PopulateStatus",c,a)})},error:function(e){a.each(c,function(a){var c=gb.controller.dealDAOs[a],e=c.status.timeouts,f=c.status.cache.lastMsCacheTtl||b.apis.GDS.baseRetryInterval;f&&gb.watcher.dealsInView&&gb.watcher.dealsInView[c.dealID]&&(l.clearTimeout(e.cacheExpires),
e.cacheExpires=l.setTimeout(function(){b.pollDealStatus(a)},f))})}},!0);this._ajaxWithRetries("GDS",e,g)}},getGetDealsRequestParam:function(c,b){var e=!1,f=null,g=null;b&&(e=b.excludeCustomerID?b.excludeCustomerID:!1,b.widgetID&&(g=b.widgetID,f=gb.controller.schedulingParams[b.widgetID].eventID));c=c.sort();c=a.map(c,function(a){return{dealID:a}});c={requestMetadata:{marketplaceID:this.marketplaceID,clientID:this.clientID},dealTargets:c,responseSize:"ALL",itemResponseSize:"DEFAULT_WITH_PREEMPTIVE_LEAKING"};
!e&&this.customerID&&(c.requestMetadata.customerID=this.customerID);this.sessionID&&(c.requestMetadata.sessionID=this.sessionID);f&&(c.extendedAttributes=["hideAddToCart"]);g&&(c.widgetContext=this._getRequestParamsWidgetContext(g));return c},GetDealsCall:function(c,b,e){if(c.length){var f=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GD.name,g=this.getGetDealsRequestParam(c,b);b={apiName:this.apis.GD.name};f=this._buildAjaxRequestParams(f,g,{success:function(b){var d=(new Date).getTime();a.each(c,function(a){var c=
gb.controller.getDealDAO(a);b.dealStatus[a].responseTimestamp=d;gb.translator.trigger("PopulateDealDAO",c,b.dealDetails[a],b.dealStatus[a])});"function"===typeof e&&e(c)},error:function(a){throw a;}},!0);this._ajaxWithRetries("GD",f,b)}},getDealDetails:function(c){var b=this;a.contains(b.getDealsCache,c)||(b.getDealsCache.push(c),1===b.getDealsCache.length&&(c=Math.floor(Math.random()*b.getDealsMaxJitter*1E3),c+=b.getDealsTimeoutValue,l.setTimeout(function(){var c=[];a.each(b.getDealsCache,function(a){b.dealsWithDetails[a]||
c.push(a)});b.getDealsCache=[];b.callAPI("GetDealsCall",c,{})},c)))},pollDealStatus:function(c){var b=this,e=gb.controller.getDealDAO(c);e.dealType===gb.enums.DealTypes.EVENT||a.contains(b.statusPollCache,c)||gb.enums.DealStatesToFilterStates[e.dealState]===gb.enums.FilterStates.MISSED||(b.statusPollCache.push(c),1===b.statusPollCache.length&&l.setTimeout(function(){var c=new Date,g=[];a.each(b.statusPollCache,function(a){var b=e.status.dates.cacheExpires;0<=c.getTime()-b.getTime()&&g.push(a)});b.statusPollCache=
[];b.callAPI("GetDealStatusCall",g)},b.statusPollTimeoutValue))},fetchDeals:function(c,b,e){var f=this,g=new Date,h=[],l=[];a.each(c,function(a){a&&(f.dealsWithDetails[a]?gb.controller.getDealDAO(a).status.dates.cacheExpires.getTime()<=g.getTime()&&l.push(a):h.push(a))});"function"===typeof e&&e(a.difference(c,h));f.callAPI("GetDealsCall",h,{widgetID:b},e);f.callAPI("GetDealStatusCall",l)},claimDeal:function(a,b,e,f,g){var h=gb.enums.AJAXLinks.CD.V1+g,l=gb.resources.getFeature("gb_csrf_validations");
if(1===l||2===l)h=gb.enums.AJAXLinks.CD.V2+g;g={apiName:this.apis.CD.name};a=this._buildAjaxRequestParams(h,{dealId:a.dealID,itemId:a.asin,clientId:this.clientID},{success:b,error:e,retry:f,beforeSend:function(a){a.setRequestHeader("X-CSRFToken",gb.resources.customerData.csrfToken)}});this._ajaxWithRetries("CD",a,g)},logPicassoClick:function(a){var b={apiName:this.apis.PICASSO_CLICKS.name},e=function(a){};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.PICASSO_CLICKS,{action:"clickNoRedirect",qualifier:a.qualifier,
id:a.id,adId:a.adId,widgetName:a.widgetName},{success:e,error:e},!1,"text");this._ajaxWithRetries("PICASSO_CLICKS",a,b)},watchDeal:function(a,b,e,f,g,h){var l=gb.enums.AJAXLinks.WATCH_DEAL.V1+h,n=gb.resources.getFeature("gb_csrf_validations");if(1===n||2===n)l=gb.enums.AJAXLinks.WATCH_DEAL.V2+h;h={apiName:this.apis.WD.name};a={watchAction:b,dealId:a,clientId:this.clientID};gb.clientName!==gb.enums.MobileClients.PC&&gb.resources.customerData.isWatchedDealFirstRun&&(a.isWatchedDealFirstRun=!0);e=this._buildAjaxRequestParams(l,
a,{success:e,error:f,retry:g,beforeSend:function(a){a.setRequestHeader("X-CSRFToken",gb.resources.customerData.csrfToken)}},!1);this._ajaxWithRetries("WD",e,h)},registerForNotifications:function(a,b,e){var f={apiName:this.apis.RFN.name};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.SUBSCRIBE_MNSS+"gb_mshop?customer\x3d"+this.customerID+"\x26sessionId\x3d"+this.sessionID+"\x26token\x3d"+a.pushToken+"\x26application\x3d"+a.appID+"\x26protocol\x3d"+a.protocol,{},{success:b,error:e},!0);this._ajaxWithRetries("RFN",
a,f)},getWatchedDeals:function(a,b,e){if(gb.service.customerID){var f={apiName:this.apis.GWD.name};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.GET_WATCHED+e,{},{success:a,error:function(){"function"===typeof b&&b();throw Error("Ajax call to fetch watched deals failed");}},!1);this._ajaxWithRetries("GWD",a,f)}else"function"===typeof b&&b()},fetchWidgetConfig:function(a,b){var e={apiName:this.apis.FWC.name};b=this._buildAjaxRequestParams(gb.enums.AJAXLinks.FWC,{config_name:a},{success:b,error:function(){n.log("Attempts to lazy load the widget: "+
a+" have failed!","ERROR","GoldboxMobileAssets")}},!1);this._ajaxWithRetries("FWC",b,e)},fetchDealWithData:function(c,b,e){var f=this;b=gb.utils.validateFetchParam(c,b);b.dealsPerPage&&0<b.dealsPerPage?f.GetDealMetadataCall(c,b,function(g){b.priorityDeal&&f.pushBuyBoxDealIDinGDMResponse(b.priorityDeal,g);var h=[],l=a.clone(g.sortedDealIDs);b.getDealsSize&&(l=l.slice(0,b.getDealsSize));f.fetchDeals(l,c,function(f){h=a.union(h,f);h.length===l.length&&gb.metadata.trigger("ConsumeMetadataChange",c,g,
e,b)})}):e(c)},GetDealMetadataCall:function(a,b,e){var f=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GDM.name,g=this.getGetDealMetadataRequestParam(a,b),h={apiName:this.apis.GDM.name};g.version===gb.enums.Constants.PAGINATED_METADATA_VERSION&&(h.version=g.version);b.isServersideGDMRetried&&(h.retry=!0);b=this._buildAjaxRequestParams(f,g,{success:function(b){var d=gb.controller.schedulingParams[a];gb.widgets[a].isGDMFailing=!1;gb.widgets[a].isRetryInProgress=!1;d&&d.maxLimitDeals&&b&&b.selectedDealsCount>
d.maxLimitDeals&&(b.selectedDealsCount=d.maxLimitDeals);e(b)},error:function(b){gb.widgets[a].isGDMFailing=!0;gb.widgets[a].isRetryInProgress=!1;gb.widgets[a].showExcessiveTrafficMessage();throw b;},retry:function(){gb.widgets[a].isGDMFailing=!0;gb.widgets[a].isRetryInProgress=!0;gb.widgets[a].showExcessiveTrafficMessage()}},!0);this._ajaxWithRetries("GDM",b,h)},getGetDealMetadataRequestParam:function(c,b){var e={requestMetadata:{clientID:this.clientID,marketplaceID:this.marketplaceID,sessionID:this.sessionID},
queryProfile:{},sortOrder:gb.enums.SortOrders.BY_SCORE,version:gb.enums.Constants.PAGINATED_METADATA_VERSION,page:1,dealsPerPage:0};this.customerID&&(e.requestMetadata.customerID=this.customerID);var f=gb.controller.schedulingParams[c];f.isInterestWidget&&this.updateGDMRequestParamForInterestWidget(c,e,f);var g={enforcedCategories:"includedCategories",enforcedDealIDs:"includedDealIDs",enforcedMerchantIDs:"merchantIDs",expiredDealsDisplayDuration:"expiredDealLookBackHours",exclusiveTargetArray:"exclusiveTargetValues",
inclusiveTargetArray:"inclusiveTargetValues"};a.each("brands dealGroups dealStates dealTypes enforcedCategories excludedCategories enforcedDealIDs enforcedMerchantIDs excludedDealIDs excludedExtendedFilters excludedItemIDs exclusiveTargetArray expiredDealsDisplayDuration extendedFilters enforcedAccessTypes excludedAccessTypes includedAccessTypes includedCategories includedDealIDs inclusiveTargetTypes inclusiveTargetArray interests itemIDs merchantIDs includedBins eventID featuredOnly freeShippingEligibleOnly globalEligibleOnly maxPercentOff maxPrice minDuration minPercentOff minPrice minRating primeAccessType primeEligibleOnly fromTime toTime discountRanges priceRanges featuredDealsElevationSize".split(" "),
function(c){if("includedBins"!==c||!(f.eventID&&!f.isInterestWidget||b.metaParams&&b.metaParams.isPageChange)){var h=f[c];g[c]&&(c=g[c]);a.isObject(h)?a.isEmpty(h)||(h=gb.utils.removeNulls(h))&&(e.queryProfile[c]=h):h&&(e.queryProfile[c]=h)}});f.dealDisplay&&f.dealStatesDD&&(e.queryProfile.dealStates=f.dealStatesDD);f.expiringWithin&&0<f.expiringWithin&&(e.queryProfile.expiringWithin=f.expiringWithin);e.sortOrder=this._getRequestSortOrder(f.sortOrder,f.rankingStrategy);e.page=b.page;e.dealsPerPage=
b.dealsPerPage;e.widgetContext=this._getRequestParamsWidgetContext(c);e.customRequestAttributes=this._getCustomRequestAttributes(e.sortOrder,f.customRequestAttributes);e=gb.utils.sortRequestObj("",e);this._excludePrimeDOTDFromLDList(e);return e},_getRequestParamsWidgetContext:function(c){var b={},e=gb.controller.contentMetadata;a.isEmpty(e)||(e.pageType&&(b.pageType=e.pageType),e.subPageType&&(b.subPageType=e.subPageType),e.deviceType&&(b.deviceType=e.deviceType),e.originRef&&(b.refTag=e.originRef),
e.originRID&&(b.refRID=e.originRID),e.browseNode&&(b.pageTypeID=e.browseNode));c=gb.metrics.widgetMetricsParams[c];a.isEmpty(c)||(c.placementID&&(b.widgetID=c.placementID),c.slotName&&(b.slotName=c.slotName));return b},_getCustomRequestAttributes:function(a,b){var e=null;b=b.SponsoredDealAttributes;a===gb.enums.RankingStrategies.BY_CUSTOM_CRITERION&&b&&(e={__type:this.TYPE_NAME_MAP.SponsoredDealAttributes,populateSponsoredDealAttributes:!0},e.interestBasedAdsOptOut="true"===gb.utils.getCookie(gb.enums.Cookies.apnPrivacy)||
!1,e.widgetName=b.widgetName,e.ipAddress=gb.resources.deviceInfo.ipAddress||null,e.experimentName=b.experimentName||null,e.experiments=b.experiments);return e},_excludePrimeDOTDFromLDList:function(a){a=a.queryProfile;if(a.dealTypes){var b=!1,e=a.dealTypes,f,g=0,h=e.length;a:for(;g<h;g++)if(f=e[g],f===gb.enums.DealTypes.LD)b=!0;else if(f===gb.enums.DealTypes.DOTD){b=!1;break a}b&&(a.excludedExtendedFilters||(a.excludedExtendedFilters={}),a.excludedExtendedFilters.MARKETING_ID?a.excludedExtendedFilters.MARKETING_ID.push("PRIME_ONLY_DOTD"):
a.excludedExtendedFilters={MARKETING_ID:["PRIME_ONLY_DOTD"]})}},_getRequestSortOrder:function(b,d){return a.contains(a.values(gb.enums.RankingStrategies),d)&&b===gb.enums.SortOrders.BY_SCORE?d:b},_generateAPIMetricName:function(a,b,e){var f="goldbox:";e.apiName&&(f+=e.apiName,e.version&&(f=f+":"+e.version),f=f+":"+(b?"success":"error")+":"+(a?"retry":"noretry"));f=f+":"+this.clientID;return f.toLowerCase()},_recordAPIMetrics:function(a,d,e){if(a=this._generateAPIMetricName(a,d,e))b.incrementCounter(a),
e.latency&&b.recordLatency(a,e.latency)},pushBuyBoxDealIDinGDMResponse:function(b,d){var e=d.sortedDealIDs;if(e&&e.length){var f=a.indexOf(e,b);0<=f&&(e.splice(f,1),d.selectedDealsCount--);e.unshift(b);d.selectedDealsCount++}else d.sortedDealIDs=[b],d.selectedDealsCount=1},overrideAPIConfigsFromG2S2:function(){var b=this,d=gb.resources.getAPIConfigs();a.isEmpty(d)||a.each(d,function(d){a.each(d,function(d,e){a.extend(b.apis[e],d)})})},_recordAPITimeoutMetrics:function(a){b.incrementCounter("goldbox:ajaxTimeout:retry_"+
a.toString()+":"+this.clientID)},updateGDMRequestParamForInterestWidget:function(a,b,e){a=gb.configManager.getWidgetViewConfig(a);b.requestMetadata={clientID:this.clientID,marketplaceID:this.marketplaceID};e.interests=null;e.eventID=null;e.sortOrder=a.sortOrder},fetchFaceoutFitlerConfig:function(a,b,e,f,g){var h=gb.configManager.getWidgetViewConfig(a),h={dealsPerPage:h.preFetchGDMDeals,getDealsSize:h.pageSize,page:h.page};"undefined"!==b.schedulingParams.filterConfig&&"undefined"!==b.schedulingParams.filterConfig[0]&&
(b.schedulingParams.includedBins=gb.utils.getIncludedBins(b.schedulingParams.filterConfig),this.GetDealMetadataCall(a,h,function(h){h=gb.utils.fetchFaceoutConfigFromWhitelistedInterests(a,b.schedulingParams,h);b.schedulingParams.filterConfig[0].faceoutConfig=h;e[a]=b.schedulingParams.filterConfig;f._updateWidgetGroup(g)}))}})});n.when("A").register("gb-watch-deal-service",function(h){return h.createClass({modifyPopupStatus:function(l,g){h.post(gb.enums.AJAXLinks.UPDATE_EMBU,{success:g,error:function(){throw Error("get/set status of watchdeal popup failed");
},params:{action:l.action,key:l.key},dataType:"json"})},addWatchedDealOnLoginRedirect:function(h){if(gb.resources.deviceInfo.isApp)gb.resources.deviceInfo.isPhone?(h=encodeURIComponent(l.location.href.replace(/^http:/,"https:")),l.location.href=gb.utils.setUrlParam(gb.resources.urls.app_login_url,"openid.return_to",h)):(h=gb.utils.getWindowLocationOrigin(),l.location.href=gb.utils.setUrlParam(h,"app-action","login"));else{var g=gb.resources.getUrl("watching_login_redirect"),g=g.replace(/%257BmarketplaceID%257D/,
gb.resources.customerData.marketplaceId);l.location.href=g.replace(/%257BdealID%257D/,h)}}})});n.when("A","gb-csm").register("gb-notifications",function(h,r){return h.createClass({pushNotificationInfo:{},init:function(){this.getPushNotificationInfo()},subscribeNotifications:function(){this.getAppNotificationStatus()&&gb.service.registerForNotifications(this.pushNotificationInfo,function(){},function(){})},getPushNotificationInfo:function(g){var b=this;n.when("mash").execute(function(a){l.amazon.mash.privateAPI&&
l.amazon.mash.privateAPI.getPushNotificationInfo({successCallback:function(a){b.pushNotificationInfo=a;"function"===typeof g&&g()},failCallback:function(a){r.incrementCounter("goldboxDetailDeviceTokenUnavailable")}})})},invokePushNotificationInterstitial:function(g){var b=this;n.when("mash").execute(function(a){cordova.require("cordova/exec")(function(){gb.controller.getPushNotificationInfo(function(){b.subscribeNotifications();g()})},function(){g()},"PushNotificationsIOS","invokePushNotificationInterstitial",
[gb.resources.getString("gb-interstitial-title"),gb.resources.getString("gb-interstitial-subtitle"),"http://g-ec2.images-amazon.com/images/G/01/golbox/mshop/INTERSTITIAL_1X._V293550351_.png",["DEALS:waitlist"]])})},getAppNotificationStatus:function(){return"object"===typeof this.pushNotificationInfo&&!h.objectIsEmpty(this.pushNotificationInfo)}})});n.when("A","GoldboxMobile3PAssets").register("gb-watcher",function(h,n){var g=n._;return h.createClass({viewPort:{},dealsInView:{},lowestDealIDWatchedIndex:{},
changePage:function(b,a){var c=this;c.viewPort[b]=c.viewPort[b]||[];c.lowestDealIDWatchedIndex[b]=c.lowestDealIDWatchedIndex[b]||0;var d=g.compact(gb.metadata.getSortedDealIDs(b)),e=g.difference(c.viewPort[b],d),f=g.difference(d,c.viewPort[b]);c.viewPort[b]=d;d=g.last(d);d=gb.metadata.getDealIDPosition(d,b);d>c.lowestDealIDWatchedIndex[b]&&(c.lowestDealIDWatchedIndex[b]=d);g.each(e,function(a){c.dealsInView[a]&&(c.dealsInView[a][b]=null,delete c.dealsInView[a][b],g.isEmpty(c.dealsInView[a])&&(c.dealsInView[a]=
null,delete c.dealsInView[a]))});g.each(f,function(a){c.dealsInView[a]=c.dealsInView[a]||{};var d=gb.metadata.getDealIDPosition(a,b);-1!==d&&(c.dealsInView[a][b]=d)});c.unwireStatusRefresh(e);c.wireStatusRefresh(f);a()},wireStatusRefresh:function(b){var a=new Date;g.each(b,function(b){var d=gb.controller.getDealDAO(b);(b=d.status.dates.cacheExpires)&&d.dealType!==gb.enums.DealTypes.EVENT&&(b=b.getTime()-a.getTime(),d.status.timeouts.cacheExpires=gb.utils.setSafeTimeout(function(){gb.service.pollDealStatus(d.dealID)},
0>b?1:b))})},unwireStatusRefresh:function(b){g.each(b,function(a){a=gb.controller.getDealDAO(a);a.status.timeouts.cacheExpires&&(l.clearTimeout(a.status.timeouts.cacheExpires),a.status.timeouts.cacheExpires=null)})}})});n.when("A","GoldboxMobile3PAssets").register("gb-garbage-collector",function(h,n){var g=n._;return h.createClass({init:function(){this.garbageCollectedDealView={}},clearDealViews:function(b,a){!b||g.isEmpty(gb.widgets)||g.isEmpty(gb.widgets[b])||g.isEmpty(gb.widgets[b].dealViews)||
(void 0===a&&(a=g.keys(gb.widgets[b].dealViews),gb.widgets[b].nextPositionToRender=0),g.each(a,function(a){gb.widgets[b].dealViews[a]&&(g.each(gb.widgets[b].dealViews[a],function(d,e){d.clock&&(l.clearTimeout(d.clock.timeout),d.clock=null);gb.widgets[b].dealViews[a][e]=null;delete gb.widgets[b].dealViews[a][e]}),delete gb.widgets[b].dealViews[a])}))},deepCleanDealViews:function(b,a){if(b&&!g.isEmpty(gb.widgets)&&!g.isEmpty(gb.widgets[b])&&!g.isEmpty(gb.widgets[b].dealViews)&&a&&!g.isEmpty(a)){var c=
[],d=gb.widgets[b],e;this.garbageCollectedDealView[b]||(this.garbageCollectedDealView[b]={});var f=this,h;g.each(a,function(a){d.dealViews[a]&&(c.push(a),f.garbageCollectedDealView[b][a]||(f.garbageCollectedDealView[b][a]={}),g.each(d.dealViews[a],function(c,d){(h=gb.utils.removeImage(c.viewElement))&&!f.garbageCollectedDealView[b][a][d]&&(e={imageContent:h.imageContent,imageContainer:h.imageContainer,dealObject:c},f.garbageCollectedDealView[b][a][d]=e)}))});this.clearDealViews(b,c)}},clearViewPort:function(b){!b||
g.isEmpty(gb.widgets)||g.isEmpty(gb.widgets[b])||null===gb.widgets[b].viewPortManager||(gb.subnavController&&gb.widgets[b].viewPortManager.clearHeaderInSubnav(),gb.widgets[b].viewPortManager.detachScroll(),gb.widgets[b].viewPortManager=null)},reRenderGCElement:function(b,a,c){if(b&&a&&!g.isNaN(parseInt(c,10))){var d=this.garbageCollectedDealView[b],e;if(d&&d[a]&&d[a][c])return d[a][c].imageContainer.html(d[a][c].imageContent),e=d[a][c].dealObject,delete d[a][c],g.isEmpty(d[a])&&delete d[a],g.isEmpty(d)&&
delete this.garbageCollectedDealView[b],e}}})});n.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-deal-dao","gb-csm","gb-enums","gb-config-manager","gb-resources","gb-watcher","gb-filter-controller-factory","gb-garbage-collector","gb-metadata","gb-widget-factory","gb-service","gb-watch-deal-service","gb-notifications","gb-base-utils","gb-link-generator","gb-metrics","gb-share-manager","gb-metrics-manager","gb-utilities","gb-widget-clientside-helper","gb-template-manager","gb-dcs-translator",
"gb-view-component-builder","gb-watch-deal-view","gb-prime-utils","gb-accessibility","gb-badge-utils","gb-filter-utils","gb-bottomsheet-view").register("gb-controller",function(h,r,g,b,a,c,d,e,f,k,m,q,y,I,E,u,v,x,z,B,A,p,w,C,F,G,J,K,H,D,P,M){var t=r._;return g.extend({nextWidgetID:100,schedulingParams:{},dealDAOs:{},totalDealsToShow:{},totalDisplayableDealsCount:{},widgetCurrentPage:{},widgetCurrentCategory:{},widgetCurrentStatus:{},widgetFilters:{},widgetName:{},pageOrientation:null,clientName:null,
useHtmlRefineButton:!1,buyingDeals:{},bottomSheet:null,originRID:null,popOverVisible:!1,watchDealView:null,pageScrollHandled:!1,contentMetadata:{pageType:null,subPageType:null,originRef:null,originRID:null,deviceType:null},init:function(a){this._super(a);gb.widgets={};this.contentMetadata.pageType=a.contentMetadata.pageType;this.contentMetadata.subPageType=a.contentMetadata.subPageType;this.contentMetadata.originRef=a.contentMetadata.refTag;this.contentMetadata.originRID=a.contentMetadata.originRID;
this.contentMetadata.deviceType=a.contentMetadata.deviceType;this.instantiateFramework();this._handleActions();this.registerConnections();n.when("A","jQuery").execute(function(a,b){b(l).unload(function(){var a=!1,a=t.any(gb.widgets,function(a){return a.isEventsWidget()});a||(a=gb.utils.setUrlParam(l.location.href,"nocache",(new Date).getTime()),gb.utils.pushAddressInBrowserHistory(a));gb.metricsManager.reportImpression()})});h.$(l).bind("popstate",function(a){var b,c=gb.controller.bottomSheet;c&&
(b=h.$("."+c.elClasses.container).length);b?gb.globalFlags.ignoreBottomSheet||c.close():t.isEmpty(a.originalEvent.state)||a.originalEvent.state.attribution!==gb.enums.BrowserHistory.ATTRIBUTION||location.reload();gb.globalFlags.ignoreBottomSheet=!1})},instantiateFramework:function(){gb.globalFlags={};gb.enums=c;gb.resources=e;gb.baseUtils=v;gb.utils=p;gb.primeUtils=K;gb.badgeUtils=D;gb.metrics=gb.metrics||new z;gb.configManager=d;gb.templateManager=C;gb.metadata=new q;gb.service=new I;gb.translator=
new F;gb.viewComponentBuilder=new G;gb.watcher=new f;gb.garbageCollector=new m;gb.metricsManager=new A;gb.widgetViewFactory=new y;gb.notifications=new u;gb.filterControllerFactory=k;gb.accessibility=new H;gb.filterUtils=P;gb.widgetMetadata=gb.widgetMetadata||{};gb.csm=gb.csm?t.extend(gb.csm,a):a;n.register("GBEventManager",function(){return new g})},registerConnections:function(){this.on("WidgetPageUpdate",this.updatePage);this.on("WidgetPageScroll",this.updateDealsInWidgetPage);this.on("WidgetResize",
this.updateDealsInWidgetPage);this.on("WidgetCategoryChange",this.changeCategory);this.on("WidgetStatusChange",this.changeStatus);this.on("WidgetLoaded",this._postWidgetLoaded)},registerWidget:function(a){var b=this,c=a.widgetName;a.resources&&gb.resources.registerResources(a.resources,c);a.inlinedImage&&gb.resources.registerImages(a.inlinedImage);gb.resources.when(a.config_name).execute(function(){b.bootstrapWidget(a)});a.schedulingParams.isATFWidget||gb.resources.hasResourceFetchInitiated[c]||(gb.resources.hasResourceFetchInitiated[c]=
!0,gb.service.fetchWidgetConfig(a.config_name,function(a){gb.resources.registerResources(a,c)}))},bootstrapWidget:function(a){var b=gb.filterControllerFactory.getFilterController(a.widgetName);t.isEmpty(gb.metadata.watchedDeals)&&a.watchedDeals&&gb.metadata.registerWatchedDeals(a.watchedDeals);var c=null;isNaN(parseInt(a.schedulingParams.watchedDealsTab,10))||(c=parseInt(a.schedulingParams.watchedDealsTab,10));if(a.schedulingParams.watchedDealsWidget||null!==c&&c===a.schedulingParams.widgetCurrentTab)a.dcsServerResponse=
gb.utils.getWatchedDealWidgetData(a.schedulingParams.dealStates);var d=a.dcsServerResponse||{};d.sortedDealIDs=d.sortedDealIDs||[];d.customResponseAttributes=d.customResponseAttributes||{};d.dealsByCategory=d.dealsByCategory||{};d.dealsByAccessType=d.dealsByAccessType||{};d.dealsByState=d.dealsByState||{};d.binning=d.binning||{};a.dcsServerResponse=d;c=(this.nextWidgetID++).toString();gb.widgetMetadata[c]=a.widgetMetadata;gb.widgetMetadata[c].widgetID=c;if(a.schedulingParams.maxJitter){var e=parseInt(a.schedulingParams.maxJitter,
10);e&&e>gb.enums.Constants.GET_DEALS_MAX_JITTER&&e>gb.service.getDealsMaxJitter&&(gb.service.getDealsMaxJitter=e)}d.selectedDealsCount=isNaN(parseInt(d.selectedDealsCount,10))?0:parseInt(d.selectedDealsCount,10);this.totalDealsToShow[c]=d.selectedDealsCount;this.totalDisplayableDealsCount[c]=d.selectedDealsCount;this.widgetName[c]=a.widgetName;this.registerSchedulingParams(c,a.schedulingParams,gb.configManager.getWidgetViewConfig(c).dcsMetadataVersion);e=this.schedulingParams[c];a.schedulingParams=
e;a.widgetID=c;e.fetchWatchedDeals&&(gb.controller.getWatchDealService(),gb.clientName===gb.enums.MobileClients.PC&&gb.controller.getWatchDealView());this.widgetFilters[c]=e.filterConfig||[];var f=e.widgetGroupID;gb.widgets[c]=gb.widgetViewFactory.getWidgetView({widgetID:c,widgetGroupID:f,widgetName:a.widgetName,domElementID:a.domElementID,schedulingParams:e});gb.widgets[c].deprecateNoDealMsg=a.gdmServiceLazyLoad;f&&gb.controller.isPaginatedMetadataCall(c)&&t.isEmpty(e.includedBins)&&(e.includedBins=
gb.utils.getIncludedBins(e.filterConfig));b.registerFilters(a,c,f);gb.metrics.registerWidgetMetricParams(c,a.domElementID);gb.translator.trigger("PopulateMetadata",c,d);gb.metadata.parseSortedDealIDs(c,d);gb.configManager.getWidgetViewConfig(c).callDataBuilder&&(gb.widgetHelper=gb.widgetHelper||new w,gb.widgetHelper.registerWidgetData(c,d));this.setInitialFilters(c);e.isInterestWidget&&gb.service.fetchFaceoutFitlerConfig(c,a,this.widgetFilters,b,f);gb.metadata.registerMetadata(c,d);gb.widgetHelper&&
gb.widgetHelper.callDataArray[c]&&gb.widgetHelper.fetchCallDataArrayDeals(c);a.gdmServiceLazyLoad&&(delete gb.widgets[c].deprecateNoDealMsg,e.watchedDealsWidget?gb.controller.trigger("WidgetPageUpdate",c,!0):(a.isGDMFailing?(gb.widgets[c].isGDMFailing=!0,gb.widgets[c].isRetryInProgress=!0,gb.widgets[c].showExcessiveTrafficMessage()):gb.widgets[c].showLoading(),a={page:1,dealsPerPage:gb.configManager.getWidgetViewConfig(c).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[c].pageSize,priorityDeal:a.prioritizedBuyboxDealID,
isLazyLoadPageCall:!0,isServersideGDMRetried:a.isGDMFailing},this.fetchPage(a,c,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)})));this.pageScrollHandled||this._handlePageScroll();this.trigger("WidgetLoaded")},registerSchedulingParams:function(a,b,c){var d={adSlots:[],allowWidgetRefresh:!1,brands:[],customFilter:null,customRequestAttributes:{},customRestrictionsApply:null,campaignSchedulingParams:{},dealDisplay:{},dealGroups:{},dealStates:[],dealTypes:[],disableMiniDP:!1,disableRestrictionsApply:!1,
disableSortFilter:!1,disableStatusFilter:!1,disableWidgetHeader:!1,discountRanges:[],displayFeaturedDeals:!1,disableWatchingBufferMillis:6E5,enablePagination:!1,enableCategoryRefine:!0,enableDeDuping:!1,enableFilter:!1,enableHidingWidgetHeader:!1,enforcedAccessTypes:[],excludedAccessTypes:[],enforcedCategories:[],enforcedDealIDs:[],enforcedMerchantIDs:[],enforceLimitedDeals:!1,eventID:null,excludedCategories:[],excludedDealIDs:[],excludedExtendedFilters:{},exclusiveTargetKeys:[],exclusiveTargetValues:[],
exclusiveTargetArray:[],expiringWithin:0,expiredDealsDisplayDuration:0,extendedFilters:{},filterConfig:[],featureScope:null,featuredDealsElevationSize:null,fetchSinglePage:!1,fetchWatchedDeals:!1,fromTime:null,freeShippingEligibleOnly:!1,globalEligibleOnly:!1,giveawaySlots:[],includedAccessTypes:[],includedBins:[],inclusiveTargetKeys:[],inclusiveTargetValues:[],inclusiveTargetArray:[],interests:[],isCritical:!1,isInterestWidget:!1,maxJitter:2,maxLimitDeals:null,minRating:null,noDealsFilterMessage:null,
noDealsMessage:null,page:1,pageSize:4,priceRanges:[],primeAccessType:null,primeEligibleOnly:!1,prioritizedDealIDs:[],rankingStrategy:null,redirectLink:null,redirectPageTitle:null,redirectText:null,rowsOfDeals:1,refreshWidgets:null,seeAllText:null,shovelerEndText:null,widgetTabConfig:{},widgetCurrentTab:0,showAllDealsFaceout:!1,showDoubleCellDOTD:!1,showLaunchCell:!0,showHelpLink:!1,showShortCellView:!1,sortOrder:gb.enums.SortOrders.BY_SCORE,sortOptionsOverride:[],subnavPage:null,subnavPageSlot:null,
subTitle:null,title:null,titleRedirectLink:null,titleRedirectText:null,titleWithS:null,toTime:null,watchedDealsWidget:!1,watchedDealsTab:null,widgetAnchorName:null,widgetGroupID:null};t.each(d,function(a,c){null!==b[c]&&void 0!==b[c]&&(d[c]=b[c])});isNaN(parseInt(d.pageSize,10))||(d.pageSize=parseInt(d.pageSize,10));isNaN(parseInt(d.featuredDealsElevationSize,10))||(d.featuredDealsElevationSize=parseInt(d.featuredDealsElevationSize,10));isNaN(parseInt(d.expiredDealsDisplayDuration,10))||(d.expiredDealsDisplayDuration=
parseInt(d.expiredDealsDisplayDuration,10));isNaN(parseInt(d.subnavPage,10))||(d.subnavPage=parseInt(d.subnavPage,10));isNaN(parseInt(d.subnavPageSlot,10))||(d.subnavPageSlot=parseInt(d.subnavPageSlot,10));d.widgetTabConfig&&t.each(d.widgetTabConfig,function(a,b){isNaN(parseInt(a.launchCellIndex,10))&&(a.launchCellIndex=0)});isNaN(parseInt(d.watchedDealsTab,10))||(d.watchedDealsTab=parseInt(d.watchedDealsTab,10));isNaN(parseInt(d.widgetCurrentTab,10))||(d.widgetCurrentTab=parseInt(d.widgetCurrentTab,
10));t.isEmpty(d.adSlots)||d.adSlots.sort(function(a,b){return a.rowNumber<b.rowNumber?-1:a.rowNumber>b.rowNumber?1:0});var e=l.amazon&&l.amazon.mash?!0:!1;d.sortOptionsOverride.length&&!t.contains(d.sortOptionsOverride,d.sortOrder)&&(d.sortOrder=d.sortOptionsOverride[0]);isNaN(parseInt(d.maxLimitDeals,10))||(d.maxLimitDeals=parseInt(d.maxLimitDeals,10));d.enforceLimitedDeals?(null===d.redirectLink&&(d.redirectLink=(new x(gb.clientName)).generateRedirectLink(d,c)),this.widgetName[a]===gb.enums.WidgetNames.TAB_HERO&&
null===d.redirectText&&(d.redirectText=1===d.dealTypes.length&&d.dealTypes[0]===gb.enums.DealTypes.LD?gb.resources.getString("gb_tabhero_ld_redirect_text"):gb.resources.getString("gb_tabhero_bd_redirect_text")),d.redirectLink&&null===d.redirectPageTitle&&(d.redirectPageTitle=d.title),gb.resources.deviceInfo.isApp&&d.redirectLink&&d.redirectPageTitle&&e&&(d.redirectLink=gb.utils.setUrlParam(d.redirectLink,"app-title",encodeURIComponent(d.redirectPageTitle))),d.redirectLink=gb.utils.enforceUTFEncodingInUrl(d.redirectLink)):
gb.controller.widgetName[a]===gb.enums.WidgetNames.HERO&&(d.redirectLink=null,d.redirectText=null,d.redirectPageTitle=null);this.schedulingParams[a]=d},getDealDAO:function(a){this.dealDAOs[a]=this.dealDAOs[a]||new b(a);return this.dealDAOs[a]},updatePage:function(a,b){gb.watcher.lowestDealIDWatchedIndex[a]&&delete gb.watcher.lowestDealIDWatchedIndex[a];var c=gb.widgets[a];b&&(gb.garbageCollector.clearViewPort(a),c.renderWireFrame());t.isEmpty(gb.controller.schedulingParams[a].adSlots)||(c.nextAdSlotToRenderIndex=
0);gb.controller.updateDealsInWidgetPage(a)},updateDealsInWidgetPage:function(a,b){function c(){var b=gb.widgets[a];gb.watcher.changePage(a,function(){b.nextPositionToRender<gb.watcher.lowestDealIDWatchedIndex[a]+1&&b.renderContent();gb.service.fetchDeals(gb.watcher.viewPort[a],a)})}b=b||this.widgetCurrentPage[a];if(this.isPaginatedMetadataCall(a)&&!gb.metadata.isCurrentWindowFull(a,b,this.schedulingParams[a].pageSize)){var d={page:b,dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,
getDealsSize:gb.controller.schedulingParams[a].pageSize};this.fetchPage(d,a,!0,c)}else c();gb.csm&&gb.csm.recordMaxPageDepthReached(a,b)},changeCategory:function(a,b){this.widgetCurrentPage[a]=1;this.widgetCurrentCategory[a]=b;gb.controller.trigger("WidgetPageUpdate",a,!0);this.updateAppliedFilters(a)},changeStatus:function(a,b){this.widgetCurrentPage[a]=1;this.widgetCurrentStatus[a]=b;this.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;gb.controller.trigger("WidgetPageUpdate",a,!0);this.updateAppliedFilters(a)},
refreshDealView:function(a,b){if(!gb.controller.buyingDeals[a]){var c=gb.watcher.dealsInView[a],d=gb.resources.getFeature("gb_image_load_fix");gb.enums.Weblabs.TREATMENTS.T1===d&&(c=gb.widgets);t.each(c,function(c,d){(c=gb.widgets[d].dealViews[a])&&t.each(c,function(a){a.render()});gb.controller.refreshMiniDetailPageView(a,b)})}},refreshDealStatusText:function(a,b){t.each(gb.watcher.dealsInView[a],function(c,d){(c=gb.widgets[d].dealViews[a])&&t.each(c,function(a){a.updateStatusMessage(b)})})},refreshWatchDealStatus:function(a,
b){t.each(gb.watcher.dealsInView[a],function(c,d){(c=gb.widgets[d].dealViews[a])&&t.each(c,function(a){a.updateWatchDealStatusMessage(b)})})},refreshMiniDetailPageView:function(a,b){gb.controller.buyingDeals[a]||t.each(gb.watcher.dealsInView[a],function(c,d){var e=gb.widgets[d].dealViews[a];n.when("A","a-modal").execute(function(c,d){t.each(e,function(c){var e=d.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+a);c&&e&&e.isActive()&&c.renderMiniDetailPage(b)})})})},fetchPage:function(a,b,c,d){var e={page:a.page,
dealsPerPage:a.dealsPerPage,getDealsSize:a.getDealsSize,priorityDeal:a.priorityDeal,isLazyLoadPageCall:a.isLazyLoadPageCall,isServersideGDMRetried:a.isServersideGDMRetried,metaParams:{isPageChange:!a.isLazyLoadPageCall}},f=gb.widgets[b],g=!1;f&&(!c||f.viewPortManager&&!a.isLazyLoadPageCall||(g=!0),gb.service.fetchDealWithData(b,e,function(){d&&d(b,g)}))},getLoginURL:function(a,b){if(gb.resources.deviceInfo.isApp){if(gb.resources.deviceInfo.isPhone)return a=encodeURIComponent(l.location.href.replace(/^http:/,
"https:")),gb.utils.setUrlParam(gb.resources.urls.app_login_url,"openid.return_to",a);a=gb.utils.getWindowLocationOrigin();return gb.utils.setUrlParam(a,"app-action","login")}if(gb.clientName!==gb.enums.MobileClients.AW){var c=gb.resources.urls.login_url,c=c.replace(/%257BdealID%257D/,a),c=c.replace(/%257Basin%257D/,b);return c=c.replace(/%257BmarketplaceID%257D/,gb.resources.customerData.marketplaceId)}},_updateNavCartQty:function(a){l.navbar&&"function"===typeof l.navbar.setCartCount&&l.navbar.setCartCount(a);
n.when("mash").execute(function(b){b.cart.didUpdate({newCartQuantity:parseInt(a,10)})})},_showErrorOnAjaxFail:function(a){var b=this.dealDAOs[a];delete this.buyingDeals[a];b.checkingDealStatus=!1;this.refreshDealView(a);n.when("mash").execute(function(a){a.showAlert({message:gb.resources.getString("gb_problem_adding_item_to_cart"),buttonTitles:[gb.resources.getString("gb_ok")],successCallback:h.$.noop})})},processActionableClick:function(a){var b=this,c=a.dealID,d=b.dealDAOs[c],e=a.dealType,f=gb.utils.getWindowLocationOrigin(),
g=a.asin,k=gb.metrics.generateRef(a.widgetID,a.action||gb.metrics.refTags.addToCart,[c]),m=gb.widgets[a.widgetID].widgetGroupID,p=gb.widgets[a.widgetID];"function"===typeof p.removeErrorMessage&&p.removeErrorMessage();if(!b.buyingDeals[c])if(e!==gb.enums.DealTypes.LD||gb.service.customerID)if(b.buyingDeals[c]=!0,e===gb.enums.DealTypes.EVENT)e=gb.metrics.addMetricsParams(gb.enums.AJAXLinks.ADD_TO_CART,a.widgetID,gb.metrics.refTags.addToCart,[c,m]),h.post(e,{params:{offerID:a.offerID,quantity:a.quantity,
asin:a.asin,dealId:c},success:function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a.success&&(d.isAddedToCart=!0,d.addActionMessage=d.postActionMessage=gb.resources.getString("gb_item_added_to_cart"),b._updateNavCartQty(a.itemsInCart));b.refreshDealView(c)},error:function(){delete b.buyingDeals[c];d.checkingDealStatus=!1;d.postActionMessage=gb.resources.getString("gb-cart-error");b.refreshDealView(c)}});else if(d.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&e===gb.enums.DealTypes.LD)gb.service.claimDeal(a,
function(e){delete b.buyingDeals[c];if(e){var f=gb.translator.translateClaimDealStatus(d,a.asin,e);d.inCartAsin=a.asin;gb.translator.trigger("PopulateStatus",d,f,b._registerDealWithNotifier);b.redemptionResponseHandler(d,a.asin,e.currentCartQuantity)}else d.checkingDealStatus=!1,b.refreshDealView(c)},function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;(a=gb.resources.getString("csld-all_retries_failed"))?(b.refreshDealStatusText(c,a),l.setTimeout(function(){b.refreshDealView(c)},3E3)):b.refreshDealView(c)},
function(){var a=gb.resources.getString("csld-retrying_deal_status");a&&b.refreshDealStatusText(c,a)},k);else if(d.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD)gb.service.claimDeal(a,function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a&&(a.errorCode===gb.enums.Constants.NON_RETRYABLE_QUANTITY_RESTRICTION_VIOLATION_ERROR?(d.postActionMessage=gb.resources.getString("gb-podotd-quantity-restriction-violated-msg"),d.isOfferingRestrictionViolated=!0):d.postActionMessage=gb.resources.getString("gb-added-to-cart"),
b._updateNavCartQty(a.currentCartQuantity));b.refreshDealView(c)},function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;(a=gb.resources.getString("csld-all_retries_failed"))?(b.refreshDealStatusText(c,a),l.setTimeout(function(){b.refreshDealView(c)},3E3)):b.refreshDealView(c)},function(){var a=gb.resources.getString("csld-retrying_deal_status");a&&b.refreshDealStatusText(c,a)},k);else if(gb.resources.deviceInfo.doesAppHaveURLInterception){var e=gb.enums.AJAXLinks.ADD_TO_CART,n=gb.enums.MiscLinks.CART_URL;
h.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a.success?(d.isAddedToCart=!0,d.addActionMessage=gb.resources.getString("gb_item_added_to_cart"),amazon.mash.cart.didUpdate({newCartQuantity:parseInt(a.itemsInCart,10)}),gb.resources.deviceInfo.isIPad&&(l.location.href=decodeURIComponent(n)),b.refreshDealView(c),gb.resources.deviceInfo.isAndroid&&amazon.mash.showAlert({message:gb.resources.getString("gb_item_added_to_cart"),
buttonTitles:[gb.resources.getString("gb_continue_shopping"),gb.resources.getString("gb_go_to_cart")],successCallback:function(a){1===a&&(l.location.href=decodeURIComponent(n))}})):b._showErrorOnAjaxFail(c)},error:function(){b._showErrorOnAjaxFail(c)}})}else gb.resources.deviceInfo.isApp?(f=gb.utils.setUrlParam(f,"app-action","add-to-cart"),f=gb.utils.setUrlParam(f,"ref",k),f=gb.utils.setUrlParam(f,"asin",a.asin),f=gb.utils.setUrlParam(f,"offer-id",a.offerID),f=gb.utils.setUrlParam(f,"clickstream-tag",
"Deal"),l.location.href=decodeURIComponent(f),delete b.buyingDeals[c],d.checkingDealStatus=!1,b.refreshDealView(c)):(e=gb.metrics.addMetricsParams(gb.enums.AJAXLinks.ADD_TO_CART,a.widgetID,gb.metrics.refTags.addToCart,[c,m]),h.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(e){if(e){delete b.buyingDeals[c];d.checkingDealStatus=!1;if(e.success)d.postActionMessage=gb.resources.getString("gb-added-to-cart"),b._updateNavCartQty(e.itemsInCart);else{d.cartError=
!0;var f=gb.widgets[a.widgetID],g;e.cartItem&&e.cartItem.statusList&&(g=e.cartItem.statusList);!t.isEmpty(g)&&gb.utils.isOfferingRestrictionViolated(g)?(d.postActionMessage=gb.resources.getString("gb-quantity-restriction-violated",{quantityLimit:e.cartItem.quantityRestriction}),d.isOfferingRestrictionViolated=!0):"function"===typeof f.renderErrorMessage&&f.renderErrorMessage()}b.refreshDealView(c)}},error:function(){delete b.buyingDeals[c];d.checkingDealStatus=!1;d.cartError=!0;var e=gb.widgets[a.widgetID];
"function"===typeof e.renderErrorMessage&&e.renderErrorMessage();b.refreshDealView(c)}}));else f=b.getLoginURL(c,g),l.location.href=f,d.checkingDealStatus=!1,b.refreshDealView(c)},redemptionResponseHandler:function(a,b,c){var d=a.customerState;a.detail.itemType===gb.enums.ItemTypes.VARIATION&&(b=a.getAsinDAO(b))&&(d=b.status.customerState);d===gb.enums.CustomerStates.INCART?(this._updateNavCartQty(c),n.when("jQuery").execute(function(b){b("#"+gb.enums.ChangeoverID.AddedToCart+a.dealID).show()})):
d===gb.enums.CustomerStates.INWAITLIST&&(n.when("jQuery").execute(function(b){b("#"+gb.enums.ChangeoverID.Waitlisted+a.dealID).show()}),"object"!==typeof gb.controller.pushNotificationInfo||t.isEmpty(gb.controller.pushNotificationInfo)||gb.notifications.subscribeNotifications())},_registerDealWithNotifier:function(a){l.dealNotifier&&(a.legacyDeal=new GBDealNotifier.Model.Deal(a.dealID),a.legacyDeal._loadStatusFromDealDAO(a),dealNotifier.registerDeal(a.inCartAsin,a.legacyDeal))},watchDeal:function(a,
b){var c=this;gb.utils.getWindowLocationOrigin();var d=c.dealDAOs[b],e=h.$("#"+gb.enums.ChangeoverID.Subnav),f;if(!0!==d.processWatchAction)if(gb.service.customerID){d.processWatchAction=!0;c.refreshDealView(b);var g=gb.enums.WatchDealActions.ADD,k=gb.metrics.refTags.watchDeal;c.dealDAOs[b].isDealWatched&&(g=gb.enums.WatchDealActions.REMOVE,k=gb.metrics.refTags.unWatchDeal);k=gb.metrics.generateRef(a,k,[b]);gb.service.watchDeal(b,g,function(k,h,l){d.processWatchAction=!1;c.closeBottomSheet();g===
gb.enums.WatchDealActions.ADD?(d.isDealWatched=!0,f=gb.resources.getString("gb_watching_deal")):(d.isDealWatched=!1,f=gb.resources.getString("gb_stopped_watching"));c.refreshDealView(b);gb.metadata.updateWatchedDeals(b);0<e.length&&(e.find("strong").text(f),e.show());k=gb.resources.getFeature("mobile_redesign");if(gb.resources.deviceInfo.isApp&&4!==k)if(gb.resources.deviceInfo.isAppVersionHigher)d.isDealWatched&&(gb.notifications.subscribeNotifications(),gb.resources.customerData.isWatchedDealFirstRun&&
c.renderWatchDealFirstrun(a));else if(g===gb.enums.WatchDealActions.ADD){var m=gb.utils.getAppStoreURL();m&&n.when("mash").execute(function(a){a.showAlert({message:gb.resources.getString("gb-reminders-msg-old-app"),buttonTitles:[gb.resources.getString("gb-go-to-app-store"),gb.resources.getString("gb_continue_shopping")],successCallback:function(b){0===b&&a.canLaunchIntentURL({url:m,successCallback:function(b){b&&a.launchIntentURL({url:m})}})}})})}},function(a){(a=gb.resources.getString("csld-all_retries_failed"))?
(c.refreshWatchDealStatus(b,a),d.processWatchAction=!1,l.setTimeout(function(){c.refreshDealView(b)},3E3)):c.refreshDealView(b)},function(){var a=gb.resources.getString("gb_watch_this_deal_failed_retrying");a&&c.refreshWatchDealStatus(b,a)},k)}else gb.watchDealService.addWatchedDealOnLoginRedirect(b),d.processWatchAction=!1,c.refreshDealView(b)},addItemToWishList:function(a){var b=this,c=a.dealID,d=a.asin;gb.resources.customerData.customerId?h.post("/gp/mobile/deals/ajax/addToWishList.html?asin\x3d"+
d,{success:function(a){if(a.isAddedToWishList)b.dealDAOs[c].addActionMessage=gb.resources.getString("gb_added_to_wishlist"),b.dealDAOs[c].isAddedToWishList=!0;else if(a.isDuplicateAdd)b.dealDAOs[c].addActionMessage=gb.resources.getString("gb_already_in_wishlist"),b.dealDAOs[c].isAddedToWishList=!0;else if(a.isAuthError){b.addToWishListOnLoginRedirect(d);return}b.dealDAOs[c].addingToWishList=!1;b.dealDAOs[c].defaultRegistryID=a.defaultRegistryID;b.refreshDealView(c)},error:function(){l.location.href=
"/gp/registry/wishlist"}}):b.addToWishListOnLoginRedirect(d)},addToWishListOnLoginRedirect:function(a){var b=gb.resources.getUrl("wishlist_login_redirect");l.location.href=b.replace(/%257BdealID%257D/,a)},updateAppliedFilters:function(a){this.schedulingParams[a].enablePagination&&(gb.utils.updateFiltersInAddressBar(a,this.widgetCurrentPage[a],this.widgetCurrentCategory[a],this.widgetCurrentStatus[a]),gb.widgets[a].scrollToWidgetTop())},setPreviouslyAppliedFilters:function(a,b){b=gb.utils.getHashOfAppliedFilters(b);
this.widgetCurrentPage[a]=parseInt(b[gb.enums.CustomerAppliedFilters.PAGE],10);this.widgetCurrentCategory[a]=b[gb.enums.CustomerAppliedFilters.CATEGORY];this.widgetCurrentStatus[a]=b[gb.enums.CustomerAppliedFilters.STATUS]},isPaginatedMetadataCall:function(a){if(gb.configManager.getWidgetViewConfig(a).dcsMetadataVersion===gb.enums.Constants.PAGINATED_METADATA_VERSION||gb.controller.schedulingParams[a].eventID)return!0},setInitialFilters:function(a){this.widgetCurrentPage[a]=this.schedulingParams[a].page;
this.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;this.widgetCurrentStatus[a]=gb.enums.StatusFilters.AVAILABLE;if(this.schedulingParams[a].enablePagination){var b=gb.utils.getParamValueFromUrl(l.location.href,gb.enums.BrowserHistory.STATE_KEY+a);b&&this.setPreviouslyAppliedFilters(a,b)}},getShareManager:function(){gb.shareManager||(gb.shareManager=new B);return gb.shareManager},getBottomSheet:function(){if(null===this.bottomSheet)try{this.bottomSheet=new M}catch(a){n.log("BottomSheet works only on mobile platfrom!",
"ERROR","GoldboxMobileAssets")}this.removeWatchDealFirstrun();return this.bottomSheet},closeBottomSheet:function(){this.bottomSheet&&this.bottomSheet.close()},getWatchDealView:function(){this.watchDealView||(this.watchDealView=new J);return this.watchDealView},getWatchDealService:function(){gb.watchDealService||(gb.watchDealService=new E);return gb.watchDealService},renderWatchDealFirstrun:function(a){var b=h.$;if(gb.resources.customerData.isWatchedDealFirstRun&&(gb.resources.customerData.isWatchedDealFirstRun=
!1,gb.resources.deviceInfo.isPhone&&gb.subnavController&&gb.subnavController.subnavContainer.length)){var c=function(){var c=gb.templateManager.getWidgetHTML({widgetID:a,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"bottomPopover",data:{message:gb.resources.getString("gb_m_watch_deal_firstrun")}}),d=b(c);gb.subnavController.subnavContainer.after(d);d.slideDown(gb.enums.AnimationDurations.WATCH_DEAL);c=function(a){d.slideUp(gb.enums.AnimationDurations.WATCH_DEAL,function(){h.$(this).remove()})};
h.declarative("gbdeal-close-infobox","click",c);d.bind("gbdeal-close-infobox",c)};gb.resources.deviceInfo.isApp&&gb.resources.deviceInfo.isIPhone&&gb.resources.deviceInfo.isIOSInterstitialSupported?gb.notifications.invokePushNotificationInterstitial(c):c()}},removeWatchDealFirstrun:function(a){a=h.$(".bottomPopover-infobox");0<a.length&&a.trigger("gbdeal-close-infobox")},_handleActions:t.once(function(){var a=this;h.declarative("gb-bottomSheet-close","click",function(b){a.closeBottomSheet()})}),_handlePageScroll:function(){var a=
gb.metrics.getReftagFromUrl(l.location.href),b;t.isEmpty(a)||(b=t.find(t.invert(gb.metrics.widgetRefTags),function(b){return-1!==a.indexOf(gb.metrics.widgetRefTags[b])}));if(t.contains(gb.enums.WidgetsAllowedAsScrollSource,b)&&(b=t.filter(gb.widgetMetadata,function(a){return a.isWidgetFilteredViaUrl}),b=t.filter(b,function(a){return gb.configManager.getWidgetViewConfig(a.widgetID).scrollToWidgetEnabled}),!t.isEmpty(b))){var c=t.first(b).widgetID;l.setTimeout(function(){gb.widgets[c].scrollToWidgetTop(gb.enums.AnimationDurations.SCROLL_WIDGET_TO_TOP)},
gb.enums.Timeouts.WIDGET_LOAD_WAIT_TIME);this.pageScrollHandled=!0}},_postWidgetLoaded:function(){t.each(gb.filterControllerFactory.getAllControllers(),function(a){a.trigger("widgetLoaded")})}})});n.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-filter-model-factory","gb-filter-metrics").register("gb-filter-controller",function(h,n,g,b,a){var c=n._;return g.extend({filterMetrics:null,filterModelFactory:null,models:{},widgetGroups:{},init:function(){this._super();this.filterMetrics=new a;
this.filterModelFactory=new b;this.on("gbfilter:change",this.onFilterChange);this.on("gbfilter:mergeFilters",this.onFilterMerge);this.on("widgetLoaded",this._postWidgetLoaded)},registerFilters:function(a,b,c){c&&(this.models[c]||(this.models[c]=this.filterModelFactory.getFilterModel(b,c)),this.models[c].mergeFilters({schedulingParams:a.schedulingParams,dcsServerResponse:a.dcsServerResponse}),this.widgetGroups[c]=this.widgetGroups[c]||[],this.widgetGroups[c].push(gb.widgets[b]))},onFilterChange:function(a,
b,c){var g=b.widgetID,h=b.data[1]===gb.enums.BinningParams.PAGE.key;c=c||{};var l=this._fetchSelectedFilterParams(g,a,h);b=this._fetchUpdatedUrl(g,a,l,c,b);this._doPostFilterChangeAction(g,a,c,h,b)},_doPostFilterChangeAction:function(a,b,c,g,h){var n=gb.widgets[a],r=b.widgetGroupID;if(b.doPageRefresh)n.widgetName===gb.enums.WidgetNames.HERO&&(n.renderWireFrame(),n.renderContent(!0)),this.models[r].doPageRefresh=!1,h=gb.utils.setUrlHash(h,b.widgetGroupAnchor),l.location.href=h;else{var I=n.isEventsWidget();
b=b.getSelectedFilters(I);this._scrollToTopOfWidget(a,c);gb.configManager.getWidgetViewConfig(a).showBottomSheetFilter&&gb.controller.closeBottomSheet();gb.utils.updateAddressBarUrl(h,gb.configManager.getWidgetViewConfig(a).pushFilteredURL,b);n.showLoading();this._handleWidgetRefresh(a,r,b,I,g)}},_handleWidgetRefresh:function(a,b,c,g,h){var l=this,n=gb.controller.schedulingParams[a];h?this._handlePageChange(a,b):gb.utils.isWatchedDealsTab(a)?(this._overrideSchedulingParamsFromFilters(c,a,g),gb.metadata.refreshWatchedDeals(a)):
(n.fetchSinglePage=!1,gb.widgetHelper&&gb.widgetHelper.callDataArray[a]&&(n.pageSize=gb.widgetHelper.callDataArray[a][0].dealsPerPage),this._overrideSchedulingParamsFromFilters(c,a,g),delete gb.metadata.sortedDealIDs[a],b={dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[a].pageSize},gb.service.fetchDealWithData(a,b,function(a){l._updateWidgetGroup(gb.widgets[a].widgetGroupID)}))},_scrollToTopOfWidget:function(a,b){var c=gb.widgets[a];
gb.configManager.getWidgetViewConfig(a).disableNavigationToTop||b.disableNavigationToTop||(a=c.skinDomElement.position().top,l.scrollTo(0,a))},_fetchSelectedFilterParams:function(a,b,f){var g=gb.widgets[a].isEventsWidget();a=gb.controller.schedulingParams[a];b=b.getSelectedFilters(g);g=c.clone(b);f&&1<b[gb.enums.BinningParams.PAGE.key]&&(g.dealsPerPage=a.pageSize);return g},_fetchUpdatedUrl:function(a,b,c,g,h){var n=b.redirectURL||l.location.href,n=gb.utils.setUrlParam(n,"gb_f_"+b.widgetGroupID,this._toURL(c));
g.updateTitleOnTargetedWidget&&(n=this._fetchUrlUpdatedWithTitleChanges(n,a,b));n=this.filterMetrics.appendFilterMetricParams(n,a,h.context,h.data);return n=gb.utils.enforceUTFEncodingInUrl(n)},_fetchUrlUpdatedWithTitleChanges:function(a,b,c){},_handlePageChange:function(a,b){var c=gb.controller.widgetCurrentPage[a],g=gb.controller.schedulingParams[a],h=gb.widgets[a];if(gb.metadata.isCurrentWindowFull(a,c,g.pageSize))this._updateWidgetGroup(b);else if(g.fetchSinglePage)gb.controller.fetchPage({page:c},
a,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)});else{b={page:c,dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,getDealsSize:g.pageSize};if(h.isLaunchCellPage&&g.pageSize){var l=g.widgetTabConfig[g.widgetCurrentTab],l=(l?l.launchCellIndex:0)%g.pageSize;b.getDealsSize>l&&(b.getDealsSize=l+1)}gb.controller.fetchPage(b,a,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)})}h=c<h.totalPages&&!gb.metadata.isCurrentWindowFull(a,c+1,g.pageSize);b=1<c&&
!gb.metadata.isCurrentWindowFull(a,c-1,g.pageSize);g.fetchSinglePage?(h&&gb.controller.fetchPage({page:c+1},a),b&&gb.controller.fetchPage({page:c-1},a)):b||(c=(c-2)*g.pageSize,g=gb.metadata.sortedDealIDs[a].slice(c,c+g.pageSize),g.length&&gb.service.fetchDeals(g,a))},onFilterMerge:function(a){c.each(this.widgetGroups[a.widgetGroupID],function(a){a.renderContent(!0)})},_updateWidgetGroup:function(a){c.each(this.widgetGroups[a],function(a){gb.controller.trigger("WidgetPageUpdate",a.widgetID,!0)})},
_overrideSchedulingParamsFromFilters:function(a,b,f){var g=this.models[gb.widgets[b].widgetGroupID],h=gb.controller.schedulingParams[b];c.each(g.attributesList,function(b){var e=null,l=gb.enums.BinningKeyToDCSQueryParamMap[b];if(f)l&&!c.contains(gb.enums.excludeBinningParamsForEvents,b)?h[l]=a[l]:h.extendedFilters[b]=a[b];else{g.filterConfigValuesHash[b]&&!c.contains(g.attributesWithDisabledValues,b)&&(e=g.filterConfigValuesHash[b]);if(b===gb.enums.BinningParams.DISCOUNT.key)l=gb.enums.DCSQueryParams.DISCOUNT_RANGE;
else if(b===gb.enums.BinningParams.PRICE.key)l=gb.enums.DCSQueryParams.PRICE_RANGE;else if(b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||b===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY)h.extendedFilters[gb.enums.IncludedDealTargetsSupported.MARKETING_ID]=a[gb.enums.IncludedDealTargetsSupported.MARKETING_ID];l&&(h[l]=a[l]||e)}})},_isDefaultValue:function(a,b){return a===gb.enums.DCSQueryParams.PAGE&&1===b||a===gb.enums.DCSQueryParams.SORT_ORDER&&b===gb.enums.SortOrders.BY_RELEVANCE||
!b&&(a===gb.enums.DCSQueryParams.GLOBAL_ELIGIBLE_ONLY||a===gb.enums.DCSQueryParams.PRIME_ELIGIBLE_ONLY)},_toURL:function(a){var b=this;a=c.map(a,function(a,d){a&&d===gb.enums.BinningParams.NEW_RELEASES.key&&(a="Y");if(b._isDefaultValue(d,a))return null;if(c.isArray(a)){if(c.isEmpty(a))return null;a=c.map(a,encodeURIComponent).join(",")}return d+":"+encodeURIComponent(encodeURIComponent(a))});return c.compact(a).join(",")},_postWidgetLoaded:function(){var a=this;c.each(c.keys(this.models),function(b){b=
a.models[b];b.setupWidgetFilterConnections();b.saveTargetedWidgetInfo()})}})});n.when("A","GoldboxMobile3PAssets","gb-filter-controller").register("gb-faceout-filter-controller",function(h,l,g){return g.extend({init:function(){this._super()},_fetchUrlUpdatedWithTitleChanges:function(b,a,c){var d=c.widgetGroupID;c.targetedWidget.title?(c=c.targetedWidget.title,gb.controller.schedulingParams[a].title=c,c=encodeURIComponent(encodeURIComponent(c)),b=gb.utils.setUrlParam(b,"gb_ttl_"+d,c)):c.targetedWidget.clearTitle&&
(b=gb.utils.clearUrlParam(b,"gb_ttl_"+d),gb.controller.schedulingParams[a].title=c.targetedWidget.savedTitle);return b}})});n.when("A","GoldboxMobile3PAssets","gb-filter-controller","gb-faceout-filter-controller").register("gb-filter-controller-factory",function(h,l,g,b){var a=l._;h={controllers:{},getFilterController:function(a){var d;try{gb.enums.WidgetNames.PC_FACEOUT===a?(this.controllers.faceout=this.controllers.faceout||new b,d=this.controllers.faceout):(this.controllers.generic=this.controllers.generic||
new g,d=this.controllers.generic)}catch(e){n.log("GBFaceout widget is not supported on non Desktop platforms!","ERROR","GoldboxMobileAssets")}return d},getAllControllers:function(){var b=this;return a.map(Object.keys(this.controllers),function(a){return b.controllers[a]})}};h.controllers.generic=new g;"undefined"!==typeof b&&(h.controllers.faceout=new b);return h});n.when("A","gb-event-emitter").register("gb-accessibility",function(h,l){var g={"GB-TAB-SUPPLE":{AVAILABLE:{imageHolder:{selector:".dealImage img",
idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"}},UPCOMING:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",
idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"}},EXPIRED:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",
idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealEndText",idSufix:"_Timer"}},SOLDOUT:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",
idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealSoldText",idSufix:"_Timer"}},COMINGSOON:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealTimer:{selector:".dealComingText",idSufix:"_Timer"}}},"GB-TAB-HERO":{AVAILABLE:{imageHolder:{selector:".dealImage img",
idSufix:"_imgHolder"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"}},UPCOMING:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealTimer:{selector:".dealViewTimer",
idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"},watchDeal:{selector:".watchBtnContainer",idSufix:"_WatchDeal"}},EXPIRED:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealTimer:{selector:".dealClaimInfo",idSufix:"_Timer"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"}},SOLDOUT:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},
dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"}},COMINGSOON:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTitle:{selector:".titleContainer",idSufix:"_title"}}}};return l.extend({init:function(){this._super();this.on("AccessibilityAction",this.actionHandler)},generateDealViewAccessibilityFlow:function(b,a){var c=
b.widgetView.widgetName,d=b.deal.dealState;b=gb.utils.getDealViewID(b.widgetView.widgetID,b.position);var e,f=[];g[c]&&(e=g[c][d]);if(e){var k=h.$(a),l;for(l in e)e[e]&&(d=e[l],c=k.find(d.selector),c.length&&(c.attr("id",b+d.idSufix),f.push(b+d.idSufix)));if(f.length)return k.attr("aria-flowto",f.join(" ")),h.$("\x3cdiv/\x3e").append(k).html()}return a},actionHandler:function(b,a){if(b)switch(b){case "subnavChange":this.subnavChange(a.subnavObject,a.newPageNumber);break;case "updateHeroTimer":this.updateHeroTimer(a.viewElement,
a.spanID,a.timerInfo);break;case "updateRefineView":this.updateTabHeroRefineView(a.filterEl);break;case "focusListItem":this.focusBottomSheetItem(a.bottomSheetObject)}},subnavChange:function(b,a){h.$(b.SubnavIDs.SubnavTab+b.currentPageNumber).attr("aria-selected","false");h.$(b.SubnavIDs.SubnavPage+b.currentPageNumber).attr("aria-hidden","true");h.$(b.SubnavIDs.SubnavTab+a).attr("aria-selected","true");h.$(b.SubnavIDs.SubnavPage+a).attr("aria-hidden","false")},updateHeroTimer:function(b,a,c){c=gb.resources.getString("gb_expand_time",
{hours:c.hours,minutes:c.minutes,seconds:c.seconds});h.$(b).find("#"+a).attr("aria-label",c);h.$(b).find("#"+a).attr("role","heading")},updateTabHeroRefineView:function(b){b.find("#statusFilter").bind("click",function(a){"block"!==h.$("#availabilityExpander").css("display")&&h.$("#availabilityContent").find("[role\x3d'listitem']").eq(0).focus()});b.find("#departmentFilter").bind("click",function(a){"block"!==h.$("#categoryRefineExpander").css("display")&&h.$("#categoryRefineContent").find("[role\x3d'listitem']").eq(0).focus()})},
focusBottomSheetItem:function(b){b.els.contents.find("[role\x3d'listitem']").eq(0).focus()}})});n.when("A","jQuery","load").execute(function(h,n){n(l).resize(function(){function g(b){if(n(b).length){var a=n(l).width(),c=n(".gbox-short-ad").width(),d=Math.floor(a/c),a=n(b+" .scheduled-ad").length,e=a*c;a>d&&(e=d*c);n(b).css("width",e);var f=!1;n(b+" .scheduled-ad").each(function(a){a>=d?n(this).hide():(n(this).show(),f=!0)});b=n(b).parent();f?1===b.children().length&&b.append("\x3chr style\x3d'border-top:1px solid #DDDDDD;margin-top:10px;width:95%'\x3e"):
1<b.children().length&&b.children().last().remove()}}g("#gbox-ad-row-1\\.0");g("#gbox-ad-row-2\\.0")});n(l).resize()});l.gb=l.gb||{};n.when("jQuery").execute(function(h){gb.$=h;n.declare("GoldboxMobile3PAssets",{_:_.noConflict()})})});